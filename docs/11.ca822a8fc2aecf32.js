"use strict";(self.webpackChunkemporium=self.webpackChunkemporium||[]).push([[11],{2011:(Y,g,o)=>{o.r(g),o.d(g,{SignInModule:()=>i,routes:()=>I});var c=o(6895),d=o(9132),t=o(4006),S=o(589),A=o(5861),h=o(8955),p=o(3071),f=o(2340),M=o(5783),e=o(4650),L=o(7009),Z=o(5298),F=o(7465),T=o(2854),v=o(3081),u=o(1576),U=o(4859),E=o(3546),x=o(7392),C=o(4144),m=o(9549);function O(n,r){1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"HTML.USERNAMEREQ")))}function w(n,r){1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"MESSAGE.MinLength")))}function N(n,r){1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"HTML.PasswordREQ")))}function y(n,r){1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"MESSAGE.MinLength6")))}class a{constructor(r,s,l,b,G,P,R,B){this.formBuilder=r,this.router=s,this.snackBar=l,this.localStore=b,this.userService=G,this.global=P,this.staff=R,this.translateService=B,this.curCOMId=f.N.comid,this.curBraId=f.N.braid,this.account=new M.n}ngOnInit(){this.loginForm=this.formBuilder.group({username:["",t.kI.compose([t.kI.required,t.kI.minLength(3)])],password:["",t.kI.compose([t.kI.required,t.kI.minLength(6)])]}),this.registerForm=this.formBuilder.group({username:["",t.kI.compose([t.kI.required,t.kI.minLength(3)])],first_name:["",t.kI.compose([t.kI.required,t.kI.minLength(3)])],email:["",t.kI.compose([t.kI.required,h.L])],password:["",t.kI.required],confirmPassword:["",t.kI.required]},{validator:(0,h.z)("password","confirmPassword")}),this.prepareMsgLanguage(),this.setInitialValues()}prepareMsgLanguage(){this.translateService.get("MESSAGE.LOGGEDIN").subscribe(r=>{this.loggedInMsg=r}),this.translateService.get("MESSAGE.NOTLOGGEDIN").subscribe(r=>{this.notLoggedInMsg=r}),this.translateService.get("MESSAGE.REGISTERD").subscribe(r=>{this.registeredMsg=r}),this.translateService.get("MESSAGE.NOTREGISTERD").subscribe(r=>{this.notRegisteredMsg=r})}getOneUser(r){console.log("**** sign-in.component line 103 *****getOneUser::: "+r),this.staff.getOneUserbyId(r).subscribe(s=>{this.global.me=s,console.log(s.userPicture)})}onLoginFormSubmit(r){this.loginForm.valid&&this.userService.login(this.loginForm).subscribe(s=>{this.localStore.setItem("token",s.token),this.global.me=s.user,this.global.userLoggedIn=!0,this.userService.getUserPermission(s.user.id).subscribe(l=>{this.localStore.setItem("permissions",JSON.stringify(l.user_permissions))}),this.snackBar.open(this.loggedInMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.waitAndNavigate()},s=>{this.global.userLoggedIn=!1,this.snackBar.open(this.notLoggedInMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}),this.router.navigate(["/"]).then(()=>{window.location.reload()})})}delay(r){return new Promise(s=>setTimeout(s,r))}waitAndNavigate(){var r=this;return(0,A.Z)(function*(){yield r.delay(2e3),r.router.navigate(["/"]).then(()=>{window.location.reload()})})()}onRegisterFormSubmit(r){console.log("************************************************"),console.log("=====values[username]"+r.username),console.log("=====values[email]"+r.email),this.registerForm.valid?this.userService.registerUser(this.registerForm).subscribe(s=>{this.snackBar.open(this.registeredMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.router.navigate(["/units/unit"])},s=>{console.log("error",s),this.snackBar.open(this.notRegisteredMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):(console.log("this.registerForm not valid"),this.snackBar.open(this.notRegisteredMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}))}setInitialValues(){this.newUser={id:null,username:"",UserCode:null,first_name:"",last_name:"",UserBirthDate:null,EntryDate:null,joinedDate:null,UserMobile:"",email:"",is_superuser:!1,is_staff:!1,is_active:!0,is_employee:"T",periorty:0,COMId:this.curCOMId,branch_KeyField:null,customer_KeyField:null,userPicture:null,gender:"",password:"",repassword:"",is_teacher:"F",RowDelete:0,LoginFrom:"N",userJobName:"",userFacebook:"",userTwitter:"",userGoogle:"",userAddress:""}}mapRegisterFormTo_UserClass(){this.newUser.username=this.registerForm.value.username,this.newUser.email=this.registerForm.value.email,this.newUser.password=this.registerForm.value.password,this.newUser.repassword=this.registerForm.value.confirmPassword}mapToOneUser(){this.oneuser.username=this.registerForm.value.username,this.oneuser.email=this.registerForm.value.email}}a.\u0275fac=function(r){return new(r||a)(e.Y36(t.QS),e.Y36(d.F0),e.Y36(L.ux),e.Y36(Z.C),e.Y36(p.K),e.Y36(F.U),e.Y36(T.x),e.Y36(v.sK))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-sign-in"]],features:[e._Bn([p.K])],decls:33,vars:23,consts:[[1,"p-4"],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-sm","50",1,"p-3"],[1,"text-muted","text-center","mb-3"],[3,"formGroup"],["appearance","outline",1,"w-100","mt-2"],["matInput","","formControlName","username","required","",3,"placeholder"],[4,"ngIf"],["appearance","outline",1,"w-100","mt-1"],["matInput","","formControlName","password","type","password","required","",3,"placeholder"],[1,"text-center","mt-2"],["mat-fab","","color","primary",1,"mat-elevation-z6",3,"click"],["fxLayout","row","fxLayoutAlign","space-between center",1,"mt-3"],[1,"divider","w-100"],[1,"text-muted","auth"]],template:function(r,s){1&r&&(e.TgZ(0,"mat-card",0)(1,"div",1)(2,"div",2)(3,"h2",3),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"form",4)(7,"mat-form-field",5)(8,"mat-label"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._UZ(11,"input",6),e.ALo(12,"translate"),e.YNc(13,O,3,3,"mat-error",7),e.YNc(14,w,3,3,"mat-error",7),e.qZA(),e.TgZ(15,"mat-form-field",8)(16,"mat-label"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e._UZ(19,"input",9),e.ALo(20,"translate"),e.YNc(21,N,3,3,"mat-error",7),e.YNc(22,y,3,3,"mat-error",7),e.qZA(),e.TgZ(23,"div",10)(24,"button",11),e.NdJ("click",function(){return s.onLoginFormSubmit(s.loginForm.value)}),e.TgZ(25,"mat-icon"),e._uU(26,"exit_to_app"),e.qZA()()(),e.TgZ(27,"div",12),e._UZ(28,"div",13),e.TgZ(29,"h3",14),e._uU(30),e.ALo(31,"translate"),e.qZA(),e._UZ(32,"div",13),e.qZA()()()()()),2&r&&(e.xp6(4),e.Oqu(e.lcZ(5,11,"HTML.SIGNIN")),e.xp6(2),e.Q6J("formGroup",s.loginForm),e.xp6(3),e.Oqu(e.lcZ(10,13,"HTML.USERNAME")),e.xp6(2),e.s9C("placeholder",e.lcZ(12,15,"HTML.USERNAME")),e.xp6(2),e.Q6J("ngIf",null==s.loginForm.controls.username.errors?null:s.loginForm.controls.username.errors.required),e.xp6(1),e.Q6J("ngIf",s.loginForm.controls.username.hasError("minlength")),e.xp6(3),e.Oqu(e.lcZ(18,17,"HTML.PASSWORD")),e.xp6(2),e.s9C("placeholder",e.lcZ(20,19,"HTML.PASSWORD")),e.xp6(2),e.Q6J("ngIf",null==s.loginForm.controls.password.errors?null:s.loginForm.controls.password.errors.required),e.xp6(1),e.Q6J("ngIf",s.loginForm.controls.password.hasError("minlength")),e.xp6(8),e.Oqu(e.lcZ(31,21,"COMPANY.NAME")))},dependencies:[c.O5,t._Y,t.Fj,t.JJ,t.JL,t.Q7,t.sg,t.u,u.xw,u.Wh,u.yH,U.cs,E.a8,x.Hw,C.Nt,m.KE,m.hX,m.TO,v.X$],styles:[".auth[_ngcontent-%COMP%]{white-space:nowrap;padding:7px 14px;font-weight:500}"]});const I=[{path:"",component:a,pathMatch:"full"}];class i{}i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[c.ez,d.Bz.forChild(I),t.UX,S.m]})}}]);