"use strict";(self.webpackChunkemporium=self.webpackChunkemporium||[]).push([[505],{7505:(ei,_e,u)=>{u.r(_e),u.d(_e,{InvoiceModule:()=>J,routes:()=>Te});var p=u(6895),b=u(9132),oe=u(529),c=u(4006),w=u(4333),Ce=u(4508),Ne=u(9045),H=u(5783),Z=u(1008),ae=u(2887),d=u(4459),v=u(5412);class re{}var e=u(4650),se=u(6002),le=u(3705),ce=u(6838),ue=u(8959),de=u(5726),x=u(3081),fe=u(4165),M=u(7009),I=u(1576),z=u(3238),y=u(4859),A=u(9602),S=u(4144),T=u(9549),ee=u(4385),D=u(8796);function xe(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BRAArbName," ")}}function be(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BUIName," ")}}function ye(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.UNTUnitNumber," ")}}function Ae(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.OWNName," ")}}function Ze(o,t){if(1&o&&(e.TgZ(0,"ng-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.CUSName,"")}}function Ve(o,t){if(1&o&&(e.TgZ(0,"a",48),e._uU(1,"\u0627\u0644\u0645\u0644\u0641"),e.qZA()),2&o){const i=e.oxw();e.s9C("href",i.fileToUpload,e.LSH)}}function we(o,t){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.SAVE")))}function Se(o,t){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.EDIT")))}function Fe(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",49),e.NdJ("click",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.onPreSave())}),e.YNc(1,we,3,3,"span",50),e.YNc(2,Se,3,3,"span",50),e.qZA()}if(2&o){const i=e.oxw();e.xp6(1),e.Q6J("ngIf",!i.data.invoiceRow),e.xp6(1),e.Q6J("ngIf",i.data.invoiceRow)}}class F{constructor(t,i,n,a,r,l,h,g,s,m,C,f,N){this.dialogRef=t,this.data=i,this.atlasService=n,this.unitsService=a,this._codesService=r,this.contractService=l,this.tenantsService=h,this.translateService=g,this.settingService=s,this.invoiceService=m,this.snackBar=C,this.dialog=f,this.fb=N,this.sellInvoice_CTT=(new d.I).SellInvoice,this.requestInvoice_CTT=(new d.I).RequestInvoice,this.fileToUpload=null,this.savePressed="F",this.AllBranches=[],this.AllBuilding=[],this.AllUnitsForBuilding=[],this.AllOwners=[],this.AllTenants=[],this.expensesInvoiceCTT=(new d.I).ExpensesInvoice,this.sellInvoiceCTT=(new d.I).SellInvoice,this.addAlarmCTT=(new d.I).AddAlarm,this.discountAlarmCTT=(new d.I).DiscountAlarm,this.requestInvoiceCTT=(new d.I).RequestInvoice}ngOnInit(){this.closeForm=!1,this.form=this.fb.group({id:null,BRAKeyField:null,build_KeyField:null,unit_KeyField:null,owner_KeyField:null,INVPdf:null,INVType_CTTKeyField:null,CUSKeyField:null,contract_KeyField:null,user_KeyField:null,INVPayType:"E",INVCode:null,INVNumber:null,INVYear:null,INVMonth:null,INVSerial:null,INVDate:null,INVFromDate:null,INVToDate:null,INVTotalValue:0,INVNetValue:0,INVPayedValue:0,INVStatus:"N",INVExpenses:0,INVCost:0,INVTax:15,INVTaxValue:0,RowConfirm:0,RowDelete:0,RowStatus:0}),this.getCodeTableTreePerCode(this.data.COMId,this.data.periorty),this.data.curUserData.is_superuser?this.getAllBranches(this.data.COMId,this.data.periorty):"T"==this.data.curUserData.is_employee?this.getEmpBranches(this.data.COMId,this.data.periorty,this.data.curUserData.id,this.data.curUserData.branch_KeyField??0):"T"==this.data.curUserData.is_owner&&this.getOwnerBranches(this.data.COMId,this.data.periorty,this.data.curUserData.owner_KeyField,this.data.curUserData.branch_KeyField??0),this.getAllOwnerss(this.data.COMId,this.data.periorty),this.getTenants(),this.prepareMsgLanguage(),this.data.invoiceRow?(this.action="Patch",this.invoiceForDisplay=this.data.invoiceRow,this.fillForm(this.data.invoiceRow)):(this.action="Post",this.invoiceForDisplay=new re,this.curDate=new Date,this.yearValue=this.curDate.getFullYear().toString(),this.monthValue=(this.curDate.getMonth()+1).toString(),this.form.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue,INVDate:this.curDate}))}handleFileInput(t){t&&t.length&&(this.fileToUpload=t.item(0))}fillForm(t){null!=t.BRAKeyField&&this.getBuildingPerBranch_onFillForm(this.data.COMId,this.data.periorty,t.BRAKeyField),null!=t.build_KeyField&&this.getUnitsPerBuilding(this.data.COMId,this.data.periorty,t.build_KeyField,"A")}mapFormvalue_to_InvoiceClass(){this.form.enable();const t=new p.uU("en-GB").transform(this.form.value.INVDate,"dd/MM/yyyy"),i=new p.uU("en-GB").transform(this.form.value.INVFromDate,"dd/MM/yyyy"),n=new p.uU("en-GB").transform(this.form.value.INVToDate,"dd/MM/yyyy");null!=this.form.value.INVDate&&(this.invoiceForDisplay.INVDate=t),null!=this.form.value.INVFromDate&&(this.invoiceForDisplay.INVFromDate=i),null!=this.form.value.INVToDate&&(this.invoiceForDisplay.INVToDate=n),this.form.value.BRAKeyField&&(this.invoiceForDisplay.BRAKeyField=this.form.value.BRAKeyField.toString()),this.form.value.build_KeyField&&(this.invoiceForDisplay.build_KeyField=this.form.value.build_KeyField.toString()),this.form.value.unit_KeyField&&(this.invoiceForDisplay.unit_KeyField=this.form.value.unit_KeyField.toString()),this.form.value.CUSKeyField&&(this.invoiceForDisplay.CUSKeyField=this.form.value.CUSKeyField.toString()),this.form.value.owner_KeyField&&(this.invoiceForDisplay.owner_KeyField=this.form.value.owner_KeyField.toString()),this.form.value.contract_KeyField&&(this.invoiceForDisplay.contract_KeyField=this.form.value.contract_KeyField.toString()),this.form.value.INVType_CTTKeyField&&(this.invoiceForDisplay.INVType_CTTKeyField=this.form.value.INVType_CTTKeyField.toString()),this.form.value.INVNumber&&(this.invoiceForDisplay.INVNumber=this.form.value.INVNumber.toString()),this.form.value.INVYear&&(this.invoiceForDisplay.INVYear=this.form.value.INVYear.toString()),this.form.value.INVMonth&&(this.invoiceForDisplay.INVMonth=this.form.value.INVMonth.toString()),this.form.value.INVSerial&&(this.invoiceForDisplay.INVSerial=this.form.value.INVSerial.toString()),this.form.value.INVTotalValue&&(this.invoiceForDisplay.INVTotalValue=this.form.value.INVTotalValue.toString()),this.form.value.INVNetValue&&(this.invoiceForDisplay.INVNetValue=this.form.value.INVNetValue.toString()),this.form.value.INVTax&&(this.invoiceForDisplay.INVTax=this.form.value.INVTax.toString()),this.form.value.INVTaxValue&&(this.invoiceForDisplay.INVTaxValue=this.form.value.INVTaxValue.toString()),this.onSave()}readUnit(t){t.value&&this.unitsService.getOneUnit(t.value).subscribe(i=>{this.form.patchValue({CUSKeyField:i.customer_KeyField})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0648\u062d\u062f\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onPreSave(){event.stopPropagation(),this.data.invCTT==this.sellInvoice_CTT?this.createDocumentNumber("S"):this.data.invCTT==this.requestInvoice_CTT&&this.createDocumentNumber("R")}onSave(){console.log("----this.action:: "+this.action),this.form.valid&&(this.savePressed="T","Post"==this.action?this.invoiceService.addInvoiceFieldsWithFile(this.invoiceForDisplay,this.fileToUpload).subscribe(t=>{this.snackBar.open("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.dialogRef.close({event:this.action})},t=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):"Patch"==this.action&&this.invoiceService.editInvoiceFieldsWithFile(this.invoiceForDisplay,this.invoiceForDisplay.id,this.fileToUpload).subscribe(t=>{this.snackBar.open("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.dialogRef.close({event:this.action})},t=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}))}onclose(){this.action="Cancel",this.dialogRef.close({event:this.action,changestartus:this.savePressed})}can(t){return!(!this.data.curUserData.is_superuser&&!this.data.userPerm.includes(t))}getAllBranches(t,i){this.atlasService.getAllBranch(t,i).subscribe(n=>{this.AllBranches=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getEmpBranches(t,i,n,a){this.atlasService.getBranchPerEmp(t,i,n).subscribe(r=>{this.AllBranches=r,this.AllBranches.length>0||this.atlasService.getOneBranch(a).subscribe(l=>{this.AllBranches=l},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getOwnerBranches(t,i,n,a){this.atlasService.getBranchPerOwner(t,i,n).subscribe(r=>{this.AllBranches=r,this.AllBranches.length>0||this.atlasService.getOneBranch(a).subscribe(l=>{this.AllBranches=l},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getBuildings(t){this.getBuildingPerBranch(this.data.COMId,this.data.periorty,t.value)}getBuildingPerBranch(t,i,n){this.unitsService.getBuildingsPerBranch(t,i,n).subscribe(a=>{this.AllBuilding=a},a=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0639\u0642\u0627\u0631\u0627\u062a \u0644\u0644\u0641\u0631\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onEdit(){this.form.patchValue({BRAKeyField:this.data.invoiceRow.BRAKeyField,build_KeyField:this.data.invoiceRow.build_KeyField,unit_KeyField:this.data.invoiceRow.unit_KeyField})}getBuildingPerBranch_onFillForm(t,i,n){new FileReader,this.fileToUpload=this.data.invoiceRow.INVPdf,this.unitsService.getBuildingsPerBranch(t,i,n).subscribe(r=>{this.AllBuilding=r,this.form.patchValue({id:this.data.invoiceRow.id,BRAKeyField:this.data.invoiceRow.BRAKeyField,build_KeyField:this.data.invoiceRow.build_KeyField,unit_KeyField:this.data.invoiceRow.unit_KeyField,owner_KeyField:this.data.invoiceRow.owner_KeyField,INVType_CTTKeyField:this.data.invoiceRow.INVType_CTTKeyField,CUSKeyField:this.data.invoiceRow.CUSKeyField,contract_KeyField:this.data.invoiceRow.contract_KeyField,user_KeyField:this.data.invoiceRow.user_KeyField,INVPayType:this.data.invoiceRow.INVPayType,INVCode:this.data.invoiceRow.INVCode,INVNumber:this.data.invoiceRow.INVNumber,INVYear:this.data.invoiceRow.INVYear,INVMonth:this.data.invoiceRow.INVMonth,INVSerial:this.data.invoiceRow.INVSerial,INVDate:this.data.invoiceRow.INVDate,INVFromDate:this.data.invoiceRow.INVFromDate,INVToDate:this.data.invoiceRow.INVToDate,INVTotalValue:this.data.invoiceRow.INVTotalValue,INVNetValue:this.data.invoiceRow.INVNetValue,INVPayedValue:this.data.invoiceRow.INVPayedValue,INVStatus:this.data.invoiceRow.INVStatus,INVExpenses:this.data.invoiceRow.INVExpenses,INVCost:this.data.invoiceRow.INVCost,INVTax:this.data.invoiceRow.INVTax,INVTaxValue:this.data.invoiceRow.INVTaxValue,RowConfirm:this.data.invoiceRow.RowConfirm,RowDelete:this.data.invoiceRow.RowDelete,RowStatus:this.data.invoiceRow.RowStatus,INVPdf:this.data.invoiceRow.INVPdf})},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0639\u0642\u0627\u0631\u0627\u062a \u0644\u0644\u0641\u0631\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onChangeDate(t){let i=t.value;this.yearValue=i.getFullYear().toString(),this.monthValue=(i.getMonth()+1).toString(),this.form.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue})}readBuilding(t){this.unitsService.getOneBuilding(t.value).subscribe(i=>{this.curOwnerId=i.owner_KeyField,this.form.patchValue({owner_KeyField:this.curOwnerId})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}),this.getUnitsPerBuilding(this.data.COMId,this.data.periorty,t.value,"A")}getUnitsPerBuilding(t,i,n,a){this.unitsService.getAllUnitsPerBuilding(t,i,n,a).subscribe(r=>{this.AllUnitsForBuilding=r},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0648\u062d\u062f\u0627\u062a \u0644\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getAllOwnerss(t,i){this.contractService.getAllOwners(t,i).subscribe(n=>{this.AllOwners=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0645\u0644\u0627\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getTenants(){this.AllTenants=null,this.tenantsService.getCustomersConfirmed(this.data.COMId,this.data.periorty).subscribe(t=>{this.AllTenants=t})}readCustumer(t){this.tenantsService.getOneCustomer(t).subscribe(i=>{},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0623\u062c\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getCodeTableTreePerCode(t,i){this._codesService.getRowPerCode(t,i,this.data.invCTT).subscribe(n=>{this.cttID=n[0].id,console.log("---this.cttID:: "+this.cttID),this.form.patchValue({INVType_CTTKeyField:this.cttID})},n=>{this.snackBar.open("\u0644\u0645 \u0646\u062a\u0645\u0643\u0646 \u0645\u0646 \u0627\u062d\u0636\u0627\u0631 \u0645\u0641\u062a\u0627\u062d \u0646\u0648\u0639 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}searchByCode(t){this.tenantsService.getCustomerPerCode(this.data.COMId,this.data.periorty,+t).subscribe(i=>{i.length>0?(this.form.patchValue({CUSKeyField:i[0].id}),this.readCustumer(i[0].id)):(console.log("---Not---"),this.form.patchValue({CUSKeyField:null}))},i=>{console.log("----not found tenant----")})}pad(t,i){let n=t+"";for(;n.length<i;)n="0"+n;return n}onChangeTotal(t){let i=t.target.value,a=i*this.form.value.INVTax/100;this.form.patchValue({INVTaxValue:a,INVNetValue:+i+ +a})}createDocumentNumber(t){let i=this.form.value.BRAKeyField,n=this.form.value.owner_KeyField,a=this.form.value.build_KeyField,r=this.form.value.unit_KeyField,l=this.form.value.CUSKeyField,h=this.form.value.user_KeyField,g=this.form.value.contract_KeyField;var s,m;switch(t){case"X":this.curDocUsed=this.expensesInvoiceCTT;break;case"S":default:this.curDocUsed=this.sellInvoiceCTT;break;case"A":this.curDocUsed=this.addAlarmCTT;break;case"D":this.curDocUsed=this.discountAlarmCTT;break;case"R":this.curDocUsed=this.requestInvoiceCTT}this.filterString="M="+this.data.COMId+"&C="+this.data.periorty+"&usr=all&invtype="+this.curDocUsed,console.log("---createDocumentNumber this.filterString:: "+this.filterString),this.invoiceNumber="",this.settingService.getSerialsPerType(this.data.COMId,this.data.periorty,this.curDocUsed).subscribe(C=>{this.docserialType=C[0].DOSDocSerialType,console.log("---this.docserialType:: "+this.docserialType),"P"==this.docserialType?this.settingService.getAllDetaisForSerial(this.data.COMId,this.data.periorty,C[0].id).subscribe(f=>{for(let N=0;N<f.length;N++)if(this.partType=f[N].DSDPartType,this.partDigitNo=f[N].DSDNoOfDigits,this.partStartWith=f[N].DSDPartStartWith??"",this.partStartWith.length==+this.partDigitNo)this.invoiceNumber+=this.partStartWith;else if(this.partStartWith.length>+this.partDigitNo)this.invoiceNumber+=this.partStartWith.substring(0,+this.partDigitNo-1);else if(this.partStartWith.length<+this.partDigitNo)switch(this.invoiceNumber+=this.partStartWith,this.remainderLength=+this.partDigitNo-this.partStartWith.length,this.partType){case"Y":s=(new Date).getFullYear().toString(),m=s,s=s.substring(s.length-+this.remainderLength),this.invoiceNumber+=s,this.filterString+="&year="+m;break;case"M":m=((new Date).getMonth()+1).toString(),s="0"+m.slice(-2),this.invoiceNumber+=s,this.filterString+="&month="+m;break;case"B":s=i.length>=+this.remainderLength?i.toString().slice(-this.remainderLength):this.pad(i,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&branch="+i;break;case"O":s=n.length>=+this.remainderLength?n.toString().slice(-this.remainderLength):this.pad(n,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&owner="+n;break;case"P":s=a.length>=+this.remainderLength?a.toString().slice(-this.remainderLength):this.pad(a,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&building="+a;break;case"U":s=r.length>=+this.remainderLength?r.toString().slice(-this.remainderLength):this.pad(r,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&unit="+r;break;case"T":s=l.length>=+this.remainderLength?l.toString().slice(-this.remainderLength):this.pad(l,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&customer="+l;break;case"C":s=g.length>=+this.remainderLength?g.toString().slice(-this.remainderLength):this.pad(g,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&contract="+g;break;case"E":s=h.length>=+this.remainderLength?h.toString().slice(-this.remainderLength):this.pad(h,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&user="+h;break;case"F":this.invoiceNumber+=s=this.partStartWith;break;case"S":console.log("----++++++++++-------"),console.log("this.filterString:: "+this.filterString),console.log("----++++++++++-------"),this.invoiceService.getInvoicesPerSpecOneString(this.filterString).subscribe(V=>{console.log("----++++++++++-------"),console.log("responseInvoice.length:: "+V.length),console.log("----++++++++++-------"),V.length>0?(this.maxSerial=V[0].INVSerial??0,this.maxSerial+=1,(m=this.maxSerial.toString()).length>=this.partDigitNo?this.invoiceNumber+=s=m:(s=this.pad(m.toString(),this.partDigitNo),this.invoiceNumber+=s),this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=P*after Serial*****---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------"),console.log("------before mapFormvalue_to_InvoiceClass--------"),this.mapFormvalue_to_InvoiceClass(),console.log("------after mapFormvalue_to_InvoiceClass--------")):(this.maxSerial=1,console.log("new maxSerial:: "+this.maxSerial),this.partDigitNo>1?(s=this.pad(1,this.partDigitNo),this.invoiceNumber+=s):this.invoiceNumber+="1",this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=P*after Serial new rows*****---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------"),console.log("------before mapFormvalue_to_InvoiceClass--------"),this.mapFormvalue_to_InvoiceClass(),console.log("------after mapFormvalue_to_InvoiceClass--------"))})}}):(console.log("---Now Here DocPartType not equal P--------"),this.contractService.getMaxInvoiceCodePerType(this.data.COMId,this.data.periorty,this.curDocUsed).subscribe(f=>{this.maxSerial=f.max,this.invoiceNumber=this.maxSerial.toString(),this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=G******---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------"),console.log("------before mapFormvalue_to_InvoiceClass--------"),this.mapFormvalue_to_InvoiceClass(),console.log("------after mapFormvalue_to_InvoiceClass--------")}))})}prepareMsgLanguage(){this.data.invCTT==this.sellInvoice_CTT?this.translateService.get("ADMIN_NAV.TaxInvoice").subscribe(t=>{this.titleMsg=t}):this.data.invCTT==this.requestInvoice_CTT&&this.translateService.get("ADMIN_NAV.RequestInvoice").subscribe(t=>{this.titleMsg=t})}}F.\u0275fac=function(t){return new(t||F)(e.Y36(v.so),e.Y36(v.WI),e.Y36(se.Z),e.Y36(le.X),e.Y36(ce.d),e.Y36(ue.W),e.Y36(de.v),e.Y36(x.sK),e.Y36(fe.g),e.Y36(Z.q),e.Y36(M.ux),e.Y36(v.uw),e.Y36(c.QS))},F.\u0275cmp=e.Xpm({type:F,selectors:[["app-invoice-dialog"]],decls:149,vars:84,consts:[["mat-dialog-title",""],["autocomplete","off",3,"formGroup"],["mat-dialog-content",""],["fxLayout","row wrap"],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["fxFlex","100","fxFlex.gt-sm","49.8",1,"px-1"],["appearance","outline",1,"w-100"],["formControlName","BRAKeyField","id","branchaOpSel",3,"placeholder","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-sm","29.8",1,"px-1"],["matInput","","formControlName","INVDate",3,"matDatepicker","dateChange"],["matSuffix","",3,"for"],["invDate",""],["fxFlex","100","fxFlex.gt-sm","10",1,"px-1"],["matInput","","formControlName","INVYear"],["matInput","","formControlName","INVMonth"],["fxFlex","100","fxFlex.gt-sm","50.0",1,"px-1"],["formControlName","build_KeyField",3,"placeholder","selectionChange"],["fxFlex","100","fxFlex.gt-sm","19.9",1,"px-1"],["formControlName","unit_KeyField","id","unitOneOpSel",3,"placeholder","selectionChange"],["fxFlex","100","fxFlex.gt-sm","30.0",1,"px-1"],["formControlName","owner_KeyField","id","oneOwnerOpSel",3,"placeholder"],["fxFlex","100","fxFlex.gt-sm","14.9",1,"px-1"],["matInput","",3,"keyup.enter"],["tenCode",""],["appearance","outline","formControlName","CUSKeyField","id","oneCustomOpSel",1,"w-100",3,"placeholder","change"],["fxFlex","100","fxFlex.gt-sm","20",1,"px-1"],["matInput","","formControlName","INVNumber"],["matInput","","formControlName","INVSerial"],["fxFlex","100","fxFlex.gt-sm","27.0",1,"px-1"],["matInput","","formControlName","INVTotalValue",3,"change"],["fxFlex","100","fxFlex.gt-sm","20.0",1,"px-1"],["matInput","","formControlName","INVTax"],["fxFlex","100","fxFlex.gt-sm","25.0",1,"px-1"],["matInput","","formControlName","INVTaxValue"],["matInput","","formControlName","INVNetValue"],["fxFlex","100","fxFlex.gt-sm","15.0",1,"px-1"],["fxFlex","100","fxFlex.gt-sm","35.0",1,"px-1"],["matInput","","formControlName","INVFromDate",3,"matDatepicker"],["invfromDate",""],["matInput","","formControlName","INVToDate",3,"matDatepicker"],["invtoDate",""],["target","_blank",3,"href",4,"ngIf"],["formControlName","INVPdf","type","file","id","file",3,"change"],["mat-dialog-actions",""],["mat-raised-button","","type","button","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","type","button","color","warn",3,"click"],["target","_blank",3,"href"],["mat-raised-button","","type","button","color","primary",3,"click"],[4,"ngIf"]],template:function(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"h1",0),e._uU(1),e.qZA(),e.TgZ(2,"form",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"mat-select",7),e.NdJ("selectionChange",function(r){return i.getBuildings(r)}),e.ALo(12,"translate"),e.TgZ(13,"mat-option",8),e._uU(14,"-"),e.qZA(),e.YNc(15,xe,2,2,"mat-option",9),e.qZA()()(),e.TgZ(16,"div",10)(17,"mat-form-field",6)(18,"mat-label"),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"input",11),e.NdJ("dateChange",function(r){return i.onChangeDate(r)}),e.qZA(),e._UZ(22,"mat-datepicker-toggle",12)(23,"mat-datepicker",null,13),e.qZA()(),e.TgZ(25,"div",14)(26,"mat-form-field",6)(27,"mat-label"),e._uU(28),e.ALo(29,"translate"),e.qZA(),e._UZ(30,"input",15),e.qZA()(),e.TgZ(31,"div",14)(32,"mat-form-field",6)(33,"mat-label"),e._uU(34),e.ALo(35,"translate"),e.qZA(),e._UZ(36,"input",16),e.qZA()()(),e.TgZ(37,"div",4)(38,"div",17)(39,"mat-form-field",6)(40,"mat-label"),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.TgZ(43,"mat-select",18),e.NdJ("selectionChange",function(r){return i.readBuilding(r)}),e.ALo(44,"translate"),e.TgZ(45,"mat-option",8),e._uU(46,"-"),e.qZA(),e.YNc(47,be,2,2,"mat-option",9),e.qZA()()(),e.TgZ(48,"div",19)(49,"mat-form-field",6)(50,"mat-label"),e._uU(51),e.ALo(52,"translate"),e.qZA(),e.TgZ(53,"mat-select",20),e.NdJ("selectionChange",function(r){return i.readUnit(r)}),e.ALo(54,"translate"),e.TgZ(55,"mat-option",8),e._uU(56,"-"),e.qZA(),e.YNc(57,ye,2,2,"mat-option",9),e.qZA()()(),e.TgZ(58,"div",21)(59,"mat-form-field",6)(60,"mat-label"),e._uU(61),e.ALo(62,"translate"),e.qZA(),e.TgZ(63,"mat-select",22),e.ALo(64,"translate"),e.TgZ(65,"mat-option",8),e._uU(66,"-"),e.qZA(),e.YNc(67,Ae,2,2,"mat-option",9),e.qZA()()()(),e.TgZ(68,"div",4)(69,"div",23)(70,"mat-form-field",6)(71,"mat-label"),e._uU(72),e.ALo(73,"translate"),e.qZA(),e.TgZ(74,"input",24,25),e.NdJ("keyup.enter",function(){e.CHM(n);const r=e.MAs(75);return e.KtG(i.searchByCode(r.value))}),e.qZA()()(),e.TgZ(76,"div",17)(77,"ng-select",26),e.NdJ("change",function(r){return i.readCustumer(r)}),e.ALo(78,"translate"),e.YNc(79,Ze,2,2,"ng-option",9),e.qZA()(),e.TgZ(80,"div",27)(81,"mat-form-field",6)(82,"mat-label"),e._uU(83),e.ALo(84,"translate"),e.qZA(),e._UZ(85,"input",28),e.qZA()(),e.TgZ(86,"div",23)(87,"mat-form-field",6)(88,"mat-label"),e._uU(89),e.ALo(90,"translate"),e.qZA(),e._UZ(91,"input",29),e.qZA()()(),e.TgZ(92,"div",4)(93,"div",30)(94,"mat-form-field",6)(95,"mat-label"),e._uU(96),e.ALo(97,"translate"),e.qZA(),e.TgZ(98,"input",31),e.NdJ("change",function(r){return i.onChangeTotal(r)}),e.qZA()()(),e.TgZ(99,"div",32)(100,"mat-form-field",6)(101,"mat-label"),e._uU(102),e.ALo(103,"translate"),e.qZA(),e._UZ(104,"input",33),e.qZA()(),e.TgZ(105,"div",34)(106,"mat-form-field",6)(107,"mat-label"),e._uU(108),e.ALo(109,"translate"),e.qZA(),e._UZ(110,"input",35),e.qZA()(),e.TgZ(111,"div",30)(112,"mat-form-field",6)(113,"mat-label"),e._uU(114),e.ALo(115,"translate"),e.qZA(),e._UZ(116,"input",36),e.qZA()()(),e.TgZ(117,"div",4)(118,"div",37)(119,"mat-label"),e._uU(120),e.ALo(121,"translate"),e.qZA()(),e.TgZ(122,"div",38)(123,"mat-form-field",6)(124,"mat-label"),e._uU(125),e.ALo(126,"translate"),e.qZA(),e._UZ(127,"input",39)(128,"mat-datepicker-toggle",12)(129,"mat-datepicker",null,40),e.qZA()(),e.TgZ(131,"div",38)(132,"mat-form-field",6)(133,"mat-label"),e._uU(134),e.ALo(135,"translate"),e.qZA(),e._UZ(136,"input",41)(137,"mat-datepicker-toggle",12)(138,"mat-datepicker",null,42),e.qZA()()()(),e.TgZ(140,"div"),e.YNc(141,Ve,2,1,"a",43),e.TgZ(142,"input",44),e.NdJ("change",function(r){return i.handleFileInput(r.target.files)}),e.qZA()()(),e.TgZ(143,"div",45)(144,"div",4),e.YNc(145,Fe,3,2,"button",46),e.TgZ(146,"button",47),e.NdJ("click",function(){return i.onclose()}),e._uU(147),e.ALo(148,"translate"),e.qZA()()()()}if(2&t){const n=e.MAs(24),a=e.MAs(130),r=e.MAs(139);e.xp6(1),e.Oqu(i.titleMsg),e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(7),e.hij(" ",e.lcZ(10,38,"HTML.BRANCH"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(12,40,"HTML.BRANCH")),e.xp6(4),e.Q6J("ngForOf",i.AllBranches),e.xp6(4),e.Oqu(e.lcZ(20,42,"HTML.InvoiceDate")),e.xp6(2),e.Q6J("matDatepicker",n),e.xp6(1),e.Q6J("for",n),e.xp6(6),e.hij(" ",e.lcZ(29,44,"OPTIONS.Year"),""),e.xp6(6),e.hij(" ",e.lcZ(35,46,"OPTIONS.Month"),""),e.xp6(7),e.hij(" ",e.lcZ(42,48,"HTML.BUILDING"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(44,50,"HTML.BUILDING")),e.xp6(4),e.Q6J("ngForOf",i.AllBuilding),e.xp6(4),e.hij(" ",e.lcZ(52,52,"HTML.UNIT"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(54,54,"HTML.UNIT")),e.xp6(4),e.Q6J("ngForOf",i.AllUnitsForBuilding),e.xp6(4),e.hij(" ",e.lcZ(62,56,"HTML.OWNER"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(64,58,"HTML.OWNER")),e.xp6(4),e.Q6J("ngForOf",i.AllOwners),e.xp6(5),e.Oqu(e.lcZ(73,60,"HTML.CODE_TENANT")),e.xp6(5),e.s9C("placeholder",e.lcZ(78,62,"HTML.TENANT")),e.xp6(2),e.Q6J("ngForOf",i.AllTenants),e.xp6(4),e.hij(" ",e.lcZ(84,64,"HTML.DOC_NUMBER"),""),e.xp6(6),e.hij(" ",e.lcZ(90,66,"HTML.Serial"),""),e.xp6(7),e.hij(" ",e.lcZ(97,68,"HTML.TotalValueWithoutTax"),""),e.xp6(6),e.hij(" ",e.lcZ(103,70,"HTML.TaxPercent"),""),e.xp6(6),e.hij(" ",e.lcZ(109,72,"HTML.TaxValue"),""),e.xp6(6),e.hij(" ",e.lcZ(115,74,"HTML.NetValueWithTax"),""),e.xp6(6),e.Oqu(e.lcZ(121,76,"HTML.EjarPeriod")),e.xp6(5),e.Oqu(e.lcZ(126,78,"HTML.FromDate")),e.xp6(2),e.Q6J("matDatepicker",a),e.xp6(1),e.Q6J("for",a),e.xp6(6),e.Oqu(e.lcZ(135,80,"HTML.ToDate")),e.xp6(2),e.Q6J("matDatepicker",r),e.xp6(1),e.Q6J("for",r),e.xp6(4),e.Q6J("ngIf",i.fileToUpload),e.xp6(4),e.Q6J("ngIf",i.data.invoiceRow&&i.can("change_taxinvoice")||!i.data.invoiceRow&&i.can("add_taxinvoice")),e.xp6(2),e.Oqu(e.lcZ(148,82,"BTN.CANCEL"))}},dependencies:[p.sg,p.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,I.xw,I.Wh,I.yH,z.ey,y.lW,A.Mq,A.hl,A.nW,v.uh,v.xY,v.H8,S.Nt,T.KE,T.hX,T.R9,ee.gD,D.w9,D.jq,x.X$]});var he=u(7298),me=u(5346),te=u(1182),U=u(7465),Q=u(5298),L=u(811),P=u(3546),q=u(7392),pe=u(4850),ge=u(1572),ie=u(266),ve=u(1419);function Me(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"mat-button-toggle",21),e.NdJ("click",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.gotoNewInvoice(null))}),e.TgZ(1,"mat-icon"),e._uU(2,"note_add"),e.qZA()()}}function De(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(i);const a=e.oxw().$implicit,r=e.oxw();return e.KtG(r.gotoNewInvoice(a))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"visibility"),e.qZA()()}2&o&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.VIEW"))}function Pe(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(i);const a=e.oxw().$implicit,r=e.oxw();return e.KtG(r.printEInvoice(a))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"print"),e.qZA()()}2&o&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.TaxInvoice"))}function Oe(o,t){if(1&o&&(e.TgZ(0,"div",22)(1,"div",23),e._uU(2),e._UZ(3,"br"),e._uU(4),e.qZA(),e.TgZ(5,"div",23),e._uU(6),e.qZA(),e.TgZ(7,"div",23),e._uU(8),e.qZA(),e.TgZ(9,"div",23),e._uU(10),e.qZA(),e.TgZ(11,"div",23),e._uU(12),e.qZA(),e.TgZ(13,"div",23),e._uU(14),e.qZA(),e.TgZ(15,"div",23),e._uU(16),e.qZA(),e.TgZ(17,"div",23)(18,"div",24),e.YNc(19,De,4,3,"button",25),e.YNc(20,Pe,4,3,"button",25),e.qZA()()()),2&o){const i=t.$implicit,n=e.oxw();e.Tol(n.statusColor[i.INVPayType]),e.xp6(2),e.Oqu(i.build_Name),e.xp6(2),e.Oqu(i.branch_ArbName),e.xp6(2),e.Oqu(i.unit_UnitNumber),e.xp6(2),e.hij(" ",i.CUSKeyField_CUSName," "),e.xp6(2),e.hij(" ",i.INVDate," "),e.xp6(2),e.hij(" ",i.INVNumber," "),e.xp6(2),e.hij(" ",i.INVNetValue," "),e.xp6(2),e.hij(" ",i.owner_FullName," "),e.xp6(3),e.Q6J("ngIf",n.can("view_onetaxinvoice")),e.xp6(1),e.Q6J("ngIf",("P"==i.customer_EInvoiceType||"B"==i.customer_EInvoiceType)&&n.can("print_taxinvoice"))}}function Ue(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"div",27)(1,"div",28)(2,"mat-card",29)(3,"pagination-controls",30),e.NdJ("pageChange",function(a){e.CHM(i);const r=e.oxw();return e.KtG(r.onPageChanged(a))}),e.qZA()()()()}}function Le(o,t){1&o&&(e.TgZ(0,"div",31),e._UZ(1,"mat-spinner",32),e.qZA())}const qe=function(o,t){return{itemsPerPage:o,currentPage:t}};class B{constructor(t,i,n,a,r,l,h,g,s,m,C){this.transferService=t,this.dataService=i,this.appSettings=n,this.activatedRoute=a,this.dialog=r,this.invService=l,this.router=h,this.global=g,this.localStore=s,this.translateService=m,this.snackBar=C,this.statusColor={C:"make-white",B:"make-gold",E:"make-yellowgreen",T:"make-yellow"},this.expensesInvoiceCTT=(new d.I).ExpensesInvoice,this.sellInvoiceCTT=(new d.I).SellInvoice,this.addAlarmCTT=(new d.I).AddAlarm,this.discountAlarmCTT=(new d.I).DiscountAlarm,this.requestInvoiceCTT=(new d.I).RequestInvoice,this.account=new H.n,this.count=8,this.userPerm=[],this.settings=this.appSettings.settings}ngOnDestroy(){this.userSUb&&this.userSUb.unsubscribe()}ngOnInit(){if(this.securityForApp=(new d.$).getSecurityType(),this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curCOMId=this.curUserData.COMId,this.appSetup=JSON.parse(this.localStore.getItem("appsetup")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.contForTenant=this.activatedRoute.params.subscribe(t=>{t.tenantid?(this.idForTenant=+t.tenantid,console.log("params['tenantid']:: "+this.idForTenant)):this.idForTenant=0}),console.log("line 93 this.idForTenant:: "+this.idForTenant),this.invFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty+"&usr=all&invtype="+this.sellInvoiceCTT,this.prepareMsgLanguage(),this.getInvoices()}}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getInvoices(){this.invoiceAll=null,this.curUserData.is_superuser?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString).subscribe(t=>this.invoiceAll=t):"T"==this.curUserData.is_owner?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&owner="+this.curUserData.owner_KeyField).subscribe(t=>this.invoiceAll=t):"T"==this.curUserData.is_employee?("N"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&branch="+this.account.branch_KeyField).subscribe(t=>this.invoiceAll=t)),"D"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&user="+this.account.id).subscribe(t=>this.invoiceAll=t))):0==this.curUserData.periorty&&(this.curCustomerID=this.account.customer_KeyField??0,this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.curCustomerID).subscribe(t=>this.invoiceAll=t))}removeInvoice(t){this.dialog.open(ae.$,{maxWidth:"400px",data:{title:this.deletedTitleMsg,message:this.askToDeletedMsg}}).afterClosed().subscribe(n=>{n&&this.invService.deleteInvoice(t).subscribe(a=>this.getInvoices())})}openDialog(){}onPageChanged(t){this.page=t,this.getInvoices(),window.scrollTo(0,0)}printEInvoice(t){switch(this.invtype_CTTCode=t.InvType_CTTCode,this.invtype_CTTCode){case this.expensesInvoiceCTT:this.invtype_Char="X";break;case this.sellInvoiceCTT:this.invtype_Char="S";break;case this.requestInvoiceCTT:this.invtype_Char="R";break;case this.addAlarmCTT:this.invtype_Char="A";break;case this.discountAlarmCTT:this.invtype_Char="D";break;default:this.invtype_Char="S"}this.transferService.setMessage({customer_EInvoiceType:t.customer_EInvoiceType,invId:t.id,invType:this.invtype_Char,invDate:t.INVDate,invDateString:t.INVDateString,invFrom:t.INVFromDate,invTo:t.INVToDate,ownerID:t.owner_KeyField,tenantID:t.CUSKeyField,ownerTaxNumber:t.owner_TaxNumber,ownerName:t.owner_FullName,ownerAddress:t.owner_Address,ownerCommRegister:t.owner_CommercialRegister,tenantCommRegister:t.customer_CommercialRegister,ownerBankName:t.owner_BankName,ownerBankAccountNumber:t.owner_BankAccountNumber,accountOwnerName:t.owner_BankAccountOwnerName,tenantName:t.CUSKeyField_CUSName,tenantAddress:t.customer_Address,tenantTaxNumber:t.customer_TaxNumber,invoiceValue:t.INVTotalValue,invoiceNumber:t.INVNumber,intervalStartDate:t.INVFromDate,intervalEndDate:t.INVToDate,ownerLogo:t.owner_LogoPic,ownerLogoBase64:t.owner_LogoBase64}),this.router.navigate(["/contracts/print-einvoice/"])}gotoNewInvoice(t){this.dialog.open(F,{data:{invoiceRow:t,periorty:this.account.periorty,curUserData:this.curUserData,userPerm:this.userPerm,COMId:this.curCOMId,invCTT:this.sellInvoiceCTT},panelClass:["theme-dialog"],autoFocus:!1,direction:this.settings.rtl?"rtl":"ltr"}).afterClosed().subscribe(n=>{"Cancel"==n?.event?"T"==n.changestartus&&console.log("--After Cancel getInvoices"):"Patch"==n?.event?(console.log("---Patch----"),this.getInvoices()):"Post"==n.event&&(console.log("-------POOOOOOSSSSST"),this.getInvoices())})}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(t=>{this.deletedTitleMsg=t})}}B.\u0275fac=function(t){return new(t||B)(e.Y36(he.y),e.Y36(me.n),e.Y36(te.d),e.Y36(b.gz),e.Y36(v.uw),e.Y36(Z.q),e.Y36(b.F0),e.Y36(U.U),e.Y36(Q.C),e.Y36(x.sK),e.Y36(M.ux))},B.\u0275cmp=e.Xpm({type:B,selectors:[["app-invoice-list"]],features:[e._Bn([Z.q])],decls:64,vars:43,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"p-2"],["fxLayout","row"],["appearance","legacy"],["controls","matButtonToggleGroup"],["value","add",3,"click",4,"ngIf"],["value","search"],[1,"user-search"],[1,"user-search-input"],["matInput","","name","search","autocomplete","off",3,"placeholder","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-between center"],["appearance","legacy","value","list"],["viewType","matButtonToggleGroup"],["value","list"],["value","grid"],["fxLayout","row wrap","fxLayoutAlign","space-between center",1,"w-100","p-3"],[1,"mat-mdc-table","admin-table"],[1,"mat-mdc-header-row"],[1,"mat-mdc-header-cell"],["class","mat-mdc-row",3,"class",4,"ngFor","ngForOf"],["fxLayout","row wrap",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","user-spinner",4,"ngIf"],["value","add",3,"click"],[1,"mat-mdc-row"],[1,"mat-mdc-cell"],[1,"p-2","actions"],["mat-mini-fab","","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"matTooltip","click"],["fxLayout","row wrap"],["fxFlex","100",1,"p-2"],[1,"text-center"],["autoHide","true","maxSize","5",1,"product-pagination",3,"pageChange"],["fxLayout","column","fxLayoutAlign","center center",1,"user-spinner"],["color","primary"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-button-toggle-group",2,3),e.YNc(4,Me,3,0,"mat-button-toggle",4),e.TgZ(5,"mat-button-toggle",5)(6,"mat-icon"),e._uU(7,"search"),e.qZA()()()(),e.TgZ(8,"form",6)(9,"mat-form-field",7)(10,"input",8),e.NdJ("ngModelChange",function(a){return i.searchText=a}),e.ALo(11,"translate"),e.qZA()()(),e.TgZ(12,"div",9)(13,"mat-button-toggle-group",10,11)(15,"mat-button-toggle",12)(16,"mat-icon"),e._uU(17,"view_list"),e.qZA()(),e.TgZ(18,"mat-button-toggle",13)(19,"mat-icon"),e._uU(20,"view_module"),e.qZA()()()()(),e._UZ(21,"mat-divider"),e.TgZ(22,"mat-card")(23,"div",14)(24,"h2"),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e._UZ(27,"mat-divider"),e.TgZ(28,"div",15)(29,"div",16)(30,"div",17)(31,"h3"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div",17)(35,"h3"),e._uU(36),e.ALo(37,"translate"),e.qZA()(),e.TgZ(38,"div",17)(39,"h3"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"div",17)(43,"h3"),e._uU(44),e.ALo(45,"translate"),e.qZA()(),e.TgZ(46,"div",17)(47,"h3"),e._uU(48),e.ALo(49,"translate"),e.qZA()(),e.TgZ(50,"div",17)(51,"h3"),e._uU(52),e.ALo(53,"translate"),e.qZA()(),e.TgZ(54,"div",17)(55,"h3"),e._uU(56),e.ALo(57,"translate"),e.qZA()(),e._UZ(58,"div",17),e.qZA(),e.YNc(59,Oe,21,12,"div",18),e.ALo(60,"paginate"),e.ALo(61,"InvoiceSearchPipe"),e.qZA()(),e.YNc(62,Ue,4,0,"div",19),e.YNc(63,Le,2,0,"div",20)),2&t){const n=e.MAs(3);e.xp6(4),e.Q6J("ngIf",i.can("add_taxinvoice")),e.xp6(4),e.ekj("show","search"==n.value),e.xp6(2),e.s9C("placeholder",e.lcZ(11,16,"HTML.SEARCH_INVOICE")),e.Q6J("ngModel",i.searchText),e.xp6(15),e.Oqu(e.lcZ(26,18,"HTML.Invoice_List")),e.xp6(7),e.hij(" ",e.lcZ(33,20,"HTML.BUILDING")," "),e.xp6(4),e.hij(" ",e.lcZ(37,22,"HTML.UnitNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(41,24,"HTML.TENANT")," "),e.xp6(4),e.hij(" ",e.lcZ(45,26,"HTML.Date")," "),e.xp6(4),e.hij(" ",e.lcZ(49,28,"HTML.INVNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(53,30,"HTML.NetValueWithTax")," "),e.xp6(4),e.hij(" ",e.lcZ(57,32,"HTML.OWNER")," "),e.xp6(3),e.Q6J("ngForOf",e.xi3(60,34,e.xi3(61,37,i.invoiceAll,i.searchText),e.WLB(40,qe,i.count,i.page))),e.xp6(3),e.Q6J("ngIf",i.invoiceAll),e.xp6(1),e.Q6J("ngIf",!i.invoiceAll)}},dependencies:[p.sg,p.O5,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F,w.LS,I.xw,I.Wh,I.yH,y.nh,L.A9,L.Yi,P.a8,q.Hw,S.Nt,T.KE,pe.d,ge.Ou,ie.gM,w._s,ve.s4,x.X$],styles:[".user-name{padding:0 12px;font-weight:400}.user-content{padding:10px}.user-content .user-img{position:relative}.user-content .user-img img{border-radius:50%;width:80px;height:80px}.user-content .user-img img.blocked{opacity:.5}.user-content .user-img .mat-icon{position:absolute;top:-8px;left:-8px;font-size:96px;height:96px;width:96px}.user-content .mat-mdc-slide-toggle{margin-top:15px}.user-content .user-details span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-content .user-details .mat-icon{padding:2px 10px}.user-content .user-details.blocked{opacity:.5}.user-search{width:0;overflow:hidden;transition:.3s}.user-search .mat-mdc-form-field{width:100%!important;text-align:center!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-infix{min-height:36px;padding:8px 0!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.user-search .mat-mdc-input-element{text-align:center}.user-search.show{width:100%;overflow:visible}.user-spinner{position:absolute;inset:0}.mat-mdc-card{overflow:hidden}table{width:100%}.make-gold{background-color:#fbea96}.make-yellow{background-color:#ff4500}.make-yellowgreen{background-color:#ad7020}.make-white{background-color:#fff}\n"],encapsulation:2});class k{}function Be(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"mat-button-toggle",21),e.NdJ("click",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.gotoNewInvoice(null))}),e.TgZ(1,"mat-icon"),e._uU(2,"note_add"),e.qZA()()}}function ke(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(i);const a=e.oxw().$implicit,r=e.oxw();return e.KtG(r.gotoNewInvoice(a))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"visibility"),e.qZA()()}2&o&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.VIEW"))}function Re(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(i);const a=e.oxw().$implicit,r=e.oxw();return e.KtG(r.printEInvoice(a))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"print"),e.qZA()()}2&o&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.TaxRequest"))}function Ke(o,t){if(1&o&&(e.TgZ(0,"div",22)(1,"div",23),e._uU(2),e._UZ(3,"br"),e._uU(4),e.qZA(),e.TgZ(5,"div",23),e._uU(6),e.qZA(),e.TgZ(7,"div",23),e._uU(8),e.qZA(),e.TgZ(9,"div",23),e._uU(10),e.qZA(),e.TgZ(11,"div",23),e._uU(12),e.qZA(),e.TgZ(13,"div",23),e._uU(14),e.qZA(),e.TgZ(15,"div",23),e._uU(16),e.qZA(),e.TgZ(17,"div",23),e._uU(18),e.qZA(),e.TgZ(19,"div",23)(20,"div",24),e.YNc(21,ke,4,3,"button",25),e.YNc(22,Re,4,3,"button",25),e.qZA()()()),2&o){const i=t.$implicit,n=e.oxw();e.Tol(n.statusColor[i.INVPayType]),e.xp6(2),e.Oqu(i.build_Name),e.xp6(2),e.Oqu(i.branch_ArbName),e.xp6(2),e.Oqu(i.unit_UnitNumber),e.xp6(2),e.hij(" ",i.CUSKeyField_CUSName," "),e.xp6(2),e.hij(" ",i.CUSKeyField_CUSMobile," "),e.xp6(2),e.hij(" ",i.INVDate," "),e.xp6(2),e.hij(" ",i.INVNumber," "),e.xp6(2),e.hij(" ",i.INVNetValue," "),e.xp6(2),e.hij(" ",i.owner_FullName," "),e.xp6(3),e.Q6J("ngIf",n.can("view_onerentrequest")),e.xp6(1),e.Q6J("ngIf",("P"==i.customer_EInvoiceType||"B"==i.customer_EInvoiceType)&&n.can("print_rentrequest"))}}function Ee(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"div",27)(1,"div",28)(2,"mat-card",29)(3,"pagination-controls",30),e.NdJ("pageChange",function(a){e.CHM(i);const r=e.oxw();return e.KtG(r.onPageChanged(a))}),e.qZA()()()()}}function Ye(o,t){1&o&&(e.TgZ(0,"div",31),e._UZ(1,"mat-spinner",32),e.qZA())}k.\u0275fac=function(t){return new(t||k)},k.\u0275cmp=e.Xpm({type:k,selectors:[["app-invoice-details"]],decls:2,vars:0,template:function(t,i){1&t&&(e.TgZ(0,"p"),e._uU(1,"invoice-details works!"),e.qZA())}});const Je=function(o,t){return{itemsPerPage:o,currentPage:t}};class j{constructor(t,i,n,a,r,l,h,g,s,m,C){this.transferService=t,this.dataService=i,this.appSettings=n,this.activatedRoute=a,this.dialog=r,this.invService=l,this.router=h,this.global=g,this.localStore=s,this.translateService=m,this.snackBar=C,this.statusColor={C:"make-white",B:"make-gold",E:"make-yellowgreen",T:"make-yellow"},this.expensesInvoiceCTT=(new d.I).ExpensesInvoice,this.sellInvoiceCTT=(new d.I).SellInvoice,this.addAlarmCTT=(new d.I).AddAlarm,this.discountAlarmCTT=(new d.I).DiscountAlarm,this.requestInvoiceCTT=(new d.I).RequestInvoice,this.account=new H.n,this.count=8,this.userPerm=[],this.settings=this.appSettings.settings}ngOnDestroy(){this.userSUb&&this.userSUb.unsubscribe()}ngOnInit(){if(this.securityForApp=(new d.$).getSecurityType(),this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curCOMId=this.curUserData.COMId,this.appSetup=JSON.parse(this.localStore.getItem("appsetup")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.contForTenant=this.activatedRoute.params.subscribe(t=>{t.tenantid?(this.idForTenant=+t.tenantid,console.log("params['tenantid']:: "+this.idForTenant)):this.idForTenant=0}),console.log("line 104 this.idForTenant:: "+this.idForTenant),this.invFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty+"&usr=all&invtype="+this.requestInvoiceCTT,console.log("line 108 this.invFilterString:: "+this.invFilterString),this.prepareMsgLanguage(),this.getInvoices()}}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getInvoices(){this.invoiceAll=null,this.curUserData.is_superuser?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString).subscribe(t=>this.invoiceAll=t):"T"==this.curUserData.is_owner?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&owner="+this.curUserData.owner_KeyField).subscribe(t=>this.invoiceAll=t):"T"==this.curUserData.is_employee?("N"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&branch="+this.account.branch_KeyField).subscribe(t=>this.invoiceAll=t)),"D"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&user="+this.account.id).subscribe(t=>this.invoiceAll=t))):0==this.curUserData.periorty&&(this.curCustomerID=this.account.customer_KeyField??0,this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.curCustomerID).subscribe(t=>this.invoiceAll=t))}removeInvoice(t){this.dialog.open(ae.$,{maxWidth:"400px",data:{title:this.deletedTitleMsg,message:this.askToDeletedMsg}}).afterClosed().subscribe(n=>{n&&this.invService.deleteInvoice(t).subscribe(a=>this.getInvoices())})}openDialog(){}onPageChanged(t){this.page=t,this.getInvoices(),window.scrollTo(0,0)}printEInvoice(t){switch(this.invtype_CTTCode=t.InvType_CTTCode,this.invtype_CTTCode){case this.expensesInvoiceCTT:this.invtype_Char="X";break;case this.sellInvoiceCTT:this.invtype_Char="S";break;case this.requestInvoiceCTT:this.invtype_Char="R";break;case this.addAlarmCTT:this.invtype_Char="A";break;case this.discountAlarmCTT:this.invtype_Char="D";break;default:this.invtype_Char="S"}this.transferService.setMessage({comid:this.curCOMId,customer_EInvoiceType:t.customer_EInvoiceType,invId:t.id,invType:this.invtype_Char,invDate:t.INVDate,invDateString:t.INVDateString,invFrom:t.INVFromDate,invTo:t.INVToDate,ownerID:t.owner_KeyField,tenantID:t.CUSKeyField,ownerTaxNumber:t.owner_TaxNumber,ownerName:t.owner_FullName,ownerAddress:t.owner_Address,ownerCommRegister:t.owner_CommercialRegister,tenantCommRegister:t.customer_CommercialRegister,ownerBankName:t.owner_BankName,ownerBankAccountNumber:t.owner_BankAccountNumber,accountOwnerName:t.owner_BankAccountOwnerName,tenantName:t.CUSKeyField_CUSName,tenantAddress:t.customer_Address,tenantTaxNumber:t.customer_TaxNumber,invoiceValue:t.INVTotalValue,invoiceNumber:t.INVNumber,intervalStartDate:t.INVFromDate,intervalEndDate:t.INVToDate,ownerLogo:t.owner_LogoPic,ownerLogoBase64:t.owner_LogoBase64}),this.router.navigate(["/contracts/print-einvoice/"])}gotoNewInvoice(t){this.dialog.open(F,{data:{invoiceRow:t,periorty:this.account.periorty,curUserData:this.curUserData,userPerm:this.userPerm,COMId:this.curCOMId,invCTT:this.requestInvoiceCTT},panelClass:["theme-dialog"],autoFocus:!1,direction:this.settings.rtl?"rtl":"ltr"}).afterClosed().subscribe(n=>{"Cancel"==n.event?"T"==n.changestartus&&console.log("--After Cancel getInvoices"):"Patch"==n.event?(console.log("---Patch----"),this.getInvoices()):"Post"==n.event&&(console.log("-------POOOOOOSSSSST"),this.getInvoices())})}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(t=>{this.deletedTitleMsg=t})}}j.\u0275fac=function(t){return new(t||j)(e.Y36(he.y),e.Y36(me.n),e.Y36(te.d),e.Y36(b.gz),e.Y36(v.uw),e.Y36(Z.q),e.Y36(b.F0),e.Y36(U.U),e.Y36(Q.C),e.Y36(x.sK),e.Y36(M.ux))},j.\u0275cmp=e.Xpm({type:j,selectors:[["app-request-list"]],features:[e._Bn([Z.q])],decls:68,vars:46,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"p-2"],["fxLayout","row"],["appearance","legacy"],["controls","matButtonToggleGroup"],["value","add",3,"click",4,"ngIf"],["value","search"],[1,"user-search"],[1,"user-search-input"],["matInput","","name","search","autocomplete","off",3,"placeholder","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-between center"],["appearance","legacy","value","list"],["viewType","matButtonToggleGroup"],["value","list"],["value","grid"],["fxLayout","row wrap","fxLayoutAlign","space-between center",1,"w-100","p-3"],[1,"mat-mdc-table","admin-table"],[1,"mat-mdc-header-row"],[1,"mat-mdc-header-cell"],["class","mat-mdc-row",3,"class",4,"ngFor","ngForOf"],["fxLayout","row wrap",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","user-spinner",4,"ngIf"],["value","add",3,"click"],[1,"mat-mdc-row"],[1,"mat-mdc-cell"],[1,"p-2","actions"],["mat-mini-fab","","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"matTooltip","click"],["fxLayout","row wrap"],["fxFlex","100",1,"p-2"],[1,"text-center"],["autoHide","true","maxSize","5",1,"product-pagination",3,"pageChange"],["fxLayout","column","fxLayoutAlign","center center",1,"user-spinner"],["color","primary"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-button-toggle-group",2,3),e.YNc(4,Be,3,0,"mat-button-toggle",4),e.TgZ(5,"mat-button-toggle",5)(6,"mat-icon"),e._uU(7,"search"),e.qZA()()()(),e.TgZ(8,"form",6)(9,"mat-form-field",7)(10,"input",8),e.NdJ("ngModelChange",function(a){return i.searchText=a}),e.ALo(11,"translate"),e.qZA()()(),e.TgZ(12,"div",9)(13,"mat-button-toggle-group",10,11)(15,"mat-button-toggle",12)(16,"mat-icon"),e._uU(17,"view_list"),e.qZA()(),e.TgZ(18,"mat-button-toggle",13)(19,"mat-icon"),e._uU(20,"view_module"),e.qZA()()()()(),e._UZ(21,"mat-divider"),e.TgZ(22,"mat-card")(23,"div",14)(24,"h2"),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e._UZ(27,"mat-divider"),e.TgZ(28,"div",15)(29,"div",16)(30,"div",17)(31,"h3"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div",17)(35,"h3"),e._uU(36),e.ALo(37,"translate"),e.qZA()(),e.TgZ(38,"div",17)(39,"h3"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"div",17)(43,"h3"),e._uU(44),e.ALo(45,"translate"),e.qZA()(),e.TgZ(46,"div",17)(47,"h3"),e._uU(48),e.ALo(49,"translate"),e.qZA()(),e.TgZ(50,"div",17)(51,"h3"),e._uU(52),e.ALo(53,"translate"),e.qZA()(),e.TgZ(54,"div",17)(55,"h3"),e._uU(56),e.ALo(57,"translate"),e.qZA()(),e.TgZ(58,"div",17)(59,"h3"),e._uU(60),e.ALo(61,"translate"),e.qZA()(),e._UZ(62,"div",17),e.qZA(),e.YNc(63,Ke,23,13,"div",18),e.ALo(64,"paginate"),e.ALo(65,"InvoiceSearchPipe"),e.qZA()(),e.YNc(66,Ee,4,0,"div",19),e.YNc(67,Ye,2,0,"div",20)),2&t){const n=e.MAs(3);e.xp6(4),e.Q6J("ngIf",i.can("add_rentrequest")),e.xp6(4),e.ekj("show","search"==n.value),e.xp6(2),e.s9C("placeholder",e.lcZ(11,17,"HTML.SEARCH_REQUEST")),e.Q6J("ngModel",i.searchText),e.xp6(15),e.Oqu(e.lcZ(26,19,"HTML.Request_List")),e.xp6(7),e.hij(" ",e.lcZ(33,21,"HTML.BUILDING")," "),e.xp6(4),e.hij(" ",e.lcZ(37,23,"HTML.UnitNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(41,25,"HTML.TENANT")," "),e.xp6(4),e.hij(" ",e.lcZ(45,27,"HTML.MOBILE")," "),e.xp6(4),e.hij(" ",e.lcZ(49,29,"HTML.Date")," "),e.xp6(4),e.hij(" ",e.lcZ(53,31,"HTML.INVNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(57,33,"HTML.NetValueWithTax")," "),e.xp6(4),e.hij(" ",e.lcZ(61,35,"HTML.OWNER")," "),e.xp6(3),e.Q6J("ngForOf",e.xi3(64,37,e.xi3(65,40,i.invoiceAll,i.searchText),e.WLB(43,Je,i.count,i.page))),e.xp6(3),e.Q6J("ngIf",i.invoiceAll),e.xp6(1),e.Q6J("ngIf",!i.invoiceAll)}},dependencies:[p.sg,p.O5,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F,w.LS,I.xw,I.Wh,I.yH,y.nh,L.A9,L.Yi,P.a8,q.Hw,S.Nt,T.KE,pe.d,ge.Ou,ie.gM,w._s,ve.s4,x.X$],styles:[".user-name{padding:0 12px;font-weight:400}.user-content{padding:10px}.user-content .user-img{position:relative}.user-content .user-img img{border-radius:50%;width:80px;height:80px}.user-content .user-img img.blocked{opacity:.5}.user-content .user-img .mat-icon{position:absolute;top:-8px;left:-8px;font-size:96px;height:96px;width:96px}.user-content .mat-mdc-slide-toggle{margin-top:15px}.user-content .user-details span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-content .user-details .mat-icon{padding:2px 10px}.user-content .user-details.blocked{opacity:.5}.user-search{width:0;overflow:hidden;transition:.3s}.user-search .mat-mdc-form-field{width:100%!important;text-align:center!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-infix{min-height:36px;padding:8px 0!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.user-search .mat-mdc-input-element{text-align:center}.user-search.show{width:100%;overflow:visible}.user-spinner{position:absolute;inset:0}.mat-mdc-card{overflow:hidden}table{width:100%}.make-gold{background-color:#fbea96}.make-yellow{background-color:#ff4500}.make-yellowgreen{background-color:#ad7020}.make-white{background-color:#fff}\n"],encapsulation:2});class G{}function He(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BRAArbName," ")}}function Qe(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BUIName," ")}}function je(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.UNTUnitNumber," ")}}function Ge(o,t){if(1&o&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.OWNName," ")}}function We(o,t){if(1&o&&(e.TgZ(0,"ng-option",8),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.CUSName,"")}}function $e(o,t){if(1&o&&(e.TgZ(0,"tr",46)(1,"td",32),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"input",47),e.qZA(),e.TgZ(5,"td",33),e._UZ(6,"input",48),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"input",49),e.qZA(),e.TgZ(9,"td"),e._UZ(10,"input",50),e.qZA(),e.TgZ(11,"td"),e._UZ(12,"input",51),e.qZA(),e.TgZ(13,"td")(14,"a",52),e._uU(15,"Remove"),e.qZA()()()),2&o){const i=t.index;e.Q6J("formGroupName",i),e.xp6(2),e.hij(" ",i+1," ")}}function Xe(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.addNewProduct())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.ADD")))}function ze(o,t){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.SAVE")))}function et(o,t){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.EDIT")))}function tt(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.onPreSave())}),e.YNc(1,ze,3,3,"span",54),e.YNc(2,et,3,3,"span",54),e.qZA()}if(2&o){const i=e.oxw();e.xp6(1),e.Q6J("ngIf",!i.data.invoiceRow),e.xp6(1),e.Q6J("ngIf",i.data.invoiceRow)}}G.\u0275fac=function(t){return new(t||G)},G.\u0275cmp=e.Xpm({type:G,selectors:[["app-request-dialog"]],decls:2,vars:0,template:function(t,i){1&t&&(e.TgZ(0,"p"),e._uU(1,"request-dialog works!"),e.qZA())}});class W{constructor(t,i,n,a,r,l,h,g,s,m,C,f,N){this.dialogRef=t,this.data=i,this.atlasService=n,this.unitsService=a,this._codesService=r,this.contractService=l,this.tenantsService=h,this.translateService=g,this.settingService=s,this.invoiceService=m,this.snackBar=C,this.dialog=f,this.fb=N,this.sellInvoice_CTT=(new d.I).SellInvoice,this.requestInvoice_CTT=(new d.I).RequestInvoice,this.expenseInvoice_CTT=(new d.I).ExpensesInvoice,this.savePressed="F",this.AllBranches=[],this.AllBuilding=[],this.AllUnitsForBuilding=[],this.AllOwners=[],this.AllTenants=[],this.expensesInvoiceCTT=(new d.I).ExpensesInvoice,this.sellInvoiceCTT=(new d.I).SellInvoice,this.addAlarmCTT=(new d.I).AddAlarm,this.discountAlarmCTT=(new d.I).DiscountAlarm,this.requestInvoiceCTT=(new d.I).RequestInvoice}ngOnInit(){this.closeForm=!1,this.form=this.fb.group({id:null,BRAKeyField:null,build_KeyField:null,unit_KeyField:null,owner_KeyField:null,INVType_CTTKeyField:null,CUSKeyField:null,contract_KeyField:null,user_KeyField:null,INVPayType:"E",INVCode:null,INVNumber:null,INVYear:null,INVMonth:null,INVSerial:null,INVDate:null,INVFromDate:null,INVToDate:null,INVTotalValue:0,INVNetValue:0,INVPayedValue:0,INVStatus:"N",INVExpenses:0,INVCost:0,INVTax:15,INVTaxValue:0,RowConfirm:0,RowDelete:0,RowStatus:0,items:this.fb.array([])}),this.getCodeTableTreePerCode(this.data.COMId,this.data.periorty),this.data.curUserData.is_superuser?this.getAllBranches(this.data.COMId,this.data.periorty):"T"==this.data.curUserData.is_employee?this.getEmpBranches(this.data.COMId,this.data.periorty,this.data.curUserData.id,this.data.curUserData.branch_KeyField??0):"T"==this.data.curUserData.is_owner&&this.getOwnerBranches(this.data.COMId,this.data.periorty,this.data.curUserData.owner_KeyField,this.data.curUserData.branch_KeyField??0),this.getAllOwnerss(this.data.COMId,this.data.periorty),this.getTenants(),this.prepareMsgLanguage(),this.data.invoiceRow?(this.action="Patch",this.invoiceForDisplay=this.data.invoiceRow,this.fillForm(this.data.invoiceRow)):(this.action="Post",this.invoiceForDisplay=new re,this.curDate=new Date,this.yearValue=this.curDate.getFullYear().toString(),this.monthValue=(this.curDate.getMonth()+1).toString(),this.form.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue,INVDate:this.curDate}))}fillForm(t){null!=t.BRAKeyField&&this.getBuildingPerBranch_onFillForm(this.data.COMId,this.data.periorty,t.BRAKeyField),null!=t.build_KeyField&&this.getUnitsPerBuilding(this.data.COMId,this.data.periorty,t.build_KeyField,"A")}addNewProduct(){this.invoiceDetail=this.form.get("items"),this.invoiceDetail.push(this.generateRow())}get invProducts(){return this.form.get("items")}generateRow(){return this.fb.group({INVKeyField:this.fb.control(""),ITMKeyField:this.fb.control(""),INVDQty:this.fb.control(1),INVDPrice:this.fb.control(0),INVDTaxValue:this.fb.control({value:0,disabled:!0})})}mapFormvalue_to_InvoiceClass(){this.form.enable();const t=new p.uU("en-GB").transform(this.form.value.INVDate,"dd/MM/yyyy"),i=new p.uU("en-GB").transform(this.form.value.INVFromDate,"dd/MM/yyyy"),n=new p.uU("en-GB").transform(this.form.value.INVToDate,"dd/MM/yyyy");null!=this.form.value.INVDate&&(this.invoiceForDisplay.INVDate=t),null!=this.form.value.INVFromDate&&(this.invoiceForDisplay.INVFromDate=i),null!=this.form.value.INVToDate&&(this.invoiceForDisplay.INVToDate=n),this.form.value.BRAKeyField&&(this.invoiceForDisplay.BRAKeyField=this.form.value.BRAKeyField.toString()),this.form.value.build_KeyField&&(this.invoiceForDisplay.build_KeyField=this.form.value.build_KeyField.toString()),this.form.value.unit_KeyField&&(this.invoiceForDisplay.unit_KeyField=this.form.value.unit_KeyField.toString()),this.form.value.CUSKeyField&&(this.invoiceForDisplay.CUSKeyField=this.form.value.CUSKeyField.toString()),this.form.value.owner_KeyField&&(this.invoiceForDisplay.owner_KeyField=this.form.value.owner_KeyField.toString()),this.form.value.contract_KeyField&&(this.invoiceForDisplay.contract_KeyField=this.form.value.contract_KeyField.toString()),this.form.value.INVType_CTTKeyField&&(this.invoiceForDisplay.INVType_CTTKeyField=this.form.value.INVType_CTTKeyField.toString()),this.form.value.INVNumber&&(this.invoiceForDisplay.INVNumber=this.form.value.INVNumber.toString()),this.form.value.INVYear&&(this.invoiceForDisplay.INVYear=this.form.value.INVYear.toString()),this.form.value.INVMonth&&(this.invoiceForDisplay.INVMonth=this.form.value.INVMonth.toString()),this.form.value.INVSerial&&(this.invoiceForDisplay.INVSerial=this.form.value.INVSerial.toString()),this.form.value.INVTotalValue&&(this.invoiceForDisplay.INVTotalValue=this.form.value.INVTotalValue.toString()),this.form.value.INVNetValue&&(this.invoiceForDisplay.INVNetValue=this.form.value.INVNetValue.toString()),this.form.value.INVTax&&(this.invoiceForDisplay.INVTax=this.form.value.INVTax.toString()),this.form.value.INVTaxValue&&(this.invoiceForDisplay.INVTaxValue=this.form.value.INVTaxValue.toString()),this.onSave()}readUnit(t){t.value&&this.unitsService.getOneUnit(t.value).subscribe(i=>{this.form.patchValue({CUSKeyField:i.customer_KeyField})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0648\u062d\u062f\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onPreSave(){event.stopPropagation(),this.data.invCTT==this.sellInvoice_CTT?this.createDocumentNumber("S"):this.data.invCTT==this.requestInvoice_CTT?this.createDocumentNumber("R"):this.data.invCTT==this.expenseInvoice_CTT&&this.createDocumentNumber("X")}onSave(){console.log("----this.action:: "+this.action),this.form.valid&&(this.savePressed="T","Post"==this.action?this.invoiceService.addInvoiceFields(this.invoiceForDisplay).subscribe(t=>{this.snackBar.open("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.dialogRef.close({event:this.action})},t=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):"Patch"==this.action&&this.invoiceService.editInvoice(this.invoiceForDisplay,this.invoiceForDisplay.id).subscribe(t=>{this.snackBar.open("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.dialogRef.close({event:this.action})},t=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}))}onclose(){this.action="Cancel",this.dialogRef.close({event:this.action,changestartus:this.savePressed})}can(t){return!(!this.data.curUserData.is_superuser&&!this.data.userPerm.includes(t))}getAllBranches(t,i){this.atlasService.getAllBranch(t,i).subscribe(n=>{this.AllBranches=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getEmpBranches(t,i,n,a){this.atlasService.getBranchPerEmp(t,i,n).subscribe(r=>{this.AllBranches=r,this.AllBranches.length>0||this.atlasService.getOneBranch(a).subscribe(l=>{this.AllBranches=l},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getOwnerBranches(t,i,n,a){this.atlasService.getBranchPerOwner(t,i,n).subscribe(r=>{this.AllBranches=r,this.AllBranches.length>0||this.atlasService.getOneBranch(a).subscribe(l=>{this.AllBranches=l},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getBuildings(t){this.getBuildingPerBranch(this.data.COMId,this.data.periorty,t.value)}getBuildingPerBranch(t,i,n){this.unitsService.getBuildingsPerBranch(t,i,n).subscribe(a=>{this.AllBuilding=a},a=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0639\u0642\u0627\u0631\u0627\u062a \u0644\u0644\u0641\u0631\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onEdit(){this.form.patchValue({BRAKeyField:this.data.invoiceRow.BRAKeyField,build_KeyField:this.data.invoiceRow.build_KeyField,unit_KeyField:this.data.invoiceRow.unit_KeyField})}getBuildingPerBranch_onFillForm(t,i,n){this.unitsService.getBuildingsPerBranch(t,i,n).subscribe(a=>{this.AllBuilding=a,this.form.patchValue({id:this.data.invoiceRow.id,BRAKeyField:this.data.invoiceRow.BRAKeyField,build_KeyField:this.data.invoiceRow.build_KeyField,unit_KeyField:this.data.invoiceRow.unit_KeyField,owner_KeyField:this.data.invoiceRow.owner_KeyField,INVType_CTTKeyField:this.data.invoiceRow.INVType_CTTKeyField,CUSKeyField:this.data.invoiceRow.CUSKeyField,contract_KeyField:this.data.invoiceRow.contract_KeyField,user_KeyField:this.data.invoiceRow.user_KeyField,INVPayType:this.data.invoiceRow.INVPayType,INVCode:this.data.invoiceRow.INVCode,INVNumber:this.data.invoiceRow.INVNumber,INVYear:this.data.invoiceRow.INVYear,INVMonth:this.data.invoiceRow.INVMonth,INVSerial:this.data.invoiceRow.INVSerial,INVDate:this.data.invoiceRow.INVDate,INVFromDate:this.data.invoiceRow.INVFromDate,INVToDate:this.data.invoiceRow.INVToDate,INVTotalValue:this.data.invoiceRow.INVTotalValue,INVNetValue:this.data.invoiceRow.INVNetValue,INVPayedValue:this.data.invoiceRow.INVPayedValue,INVStatus:this.data.invoiceRow.INVStatus,INVExpenses:this.data.invoiceRow.INVExpenses,INVCost:this.data.invoiceRow.INVCost,INVTax:this.data.invoiceRow.INVTax,INVTaxValue:this.data.invoiceRow.INVTaxValue,RowConfirm:this.data.invoiceRow.RowConfirm,RowDelete:this.data.invoiceRow.RowDelete,RowStatus:this.data.invoiceRow.RowStatus})},a=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0639\u0642\u0627\u0631\u0627\u062a \u0644\u0644\u0641\u0631\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onChangeDate(t){let i=t.value;this.yearValue=i.getFullYear().toString(),this.monthValue=(i.getMonth()+1).toString(),this.form.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue})}readBuilding(t){this.unitsService.getOneBuilding(t.value).subscribe(i=>{this.curOwnerId=i.owner_KeyField,this.form.patchValue({owner_KeyField:this.curOwnerId})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}),this.getUnitsPerBuilding(this.data.COMId,this.data.periorty,t.value,"A")}getUnitsPerBuilding(t,i,n,a){this.unitsService.getAllUnitsPerBuilding(t,i,n,a).subscribe(r=>{this.AllUnitsForBuilding=r},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0648\u062d\u062f\u0627\u062a \u0644\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getAllOwnerss(t,i){this.contractService.getAllOwners(t,i).subscribe(n=>{this.AllOwners=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0645\u0644\u0627\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getTenants(){this.AllTenants=null,this.tenantsService.getCustomersConfirmed(this.data.COMId,this.data.periorty).subscribe(t=>{this.AllTenants=t})}readCustumer(t){this.tenantsService.getOneCustomer(t).subscribe(i=>{},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0623\u062c\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getCodeTableTreePerCode(t,i){this._codesService.getRowPerCode(t,i,this.data.invCTT).subscribe(n=>{this.cttID=n[0].id,console.log("---this.cttID:: "+this.cttID),this.form.patchValue({INVType_CTTKeyField:this.cttID})},n=>{this.snackBar.open("\u0644\u0645 \u0646\u062a\u0645\u0643\u0646 \u0645\u0646 \u0627\u062d\u0636\u0627\u0631 \u0645\u0641\u062a\u0627\u062d \u0646\u0648\u0639 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}searchByCode(t){this.tenantsService.getCustomerPerCode(this.data.COMId,this.data.periorty,+t).subscribe(i=>{i.length>0?(this.form.patchValue({CUSKeyField:i[0].id}),this.readCustumer(i[0].id)):(console.log("---Not---"),this.form.patchValue({CUSKeyField:null}))},i=>{console.log("----not found tenant----")})}pad(t,i){let n=t+"";for(;n.length<i;)n="0"+n;return n}onChangeTotal(t){let i=t.target.value,a=i*this.form.value.INVTax/100;this.form.patchValue({INVTaxValue:a,INVNetValue:+i+ +a})}createDocumentNumber(t){let i=this.form.value.BRAKeyField,n=this.form.value.owner_KeyField,a=this.form.value.build_KeyField,r=this.form.value.unit_KeyField,l=this.form.value.CUSKeyField,h=this.form.value.user_KeyField,g=this.form.value.contract_KeyField;var s,m;switch(t){case"X":this.curDocUsed=this.expensesInvoiceCTT;break;case"S":default:this.curDocUsed=this.sellInvoiceCTT;break;case"A":this.curDocUsed=this.addAlarmCTT;break;case"D":this.curDocUsed=this.discountAlarmCTT;break;case"R":this.curDocUsed=this.requestInvoiceCTT}this.filterString="M="+this.data.COMId+"&C="+this.data.periorty+"&usr=all&invtype="+this.curDocUsed,console.log("---createDocumentNumber this.filterString:: "+this.filterString),this.invoiceNumber="",this.settingService.getSerialsPerType(this.data.COMId,this.data.periorty,this.curDocUsed).subscribe(C=>{this.docserialType=C[0].DOSDocSerialType,console.log("---this.docserialType:: "+this.docserialType),"P"==this.docserialType?this.settingService.getAllDetaisForSerial(this.data.COMId,this.data.periorty,C[0].id).subscribe(f=>{for(let N=0;N<f.length;N++)if(this.partType=f[N].DSDPartType,this.partDigitNo=f[N].DSDNoOfDigits,this.partStartWith=f[N].DSDPartStartWith??"",this.partStartWith.length==+this.partDigitNo)this.invoiceNumber+=this.partStartWith;else if(this.partStartWith.length>+this.partDigitNo)this.invoiceNumber+=this.partStartWith.substring(0,+this.partDigitNo-1);else if(this.partStartWith.length<+this.partDigitNo)switch(this.invoiceNumber+=this.partStartWith,this.remainderLength=+this.partDigitNo-this.partStartWith.length,this.partType){case"Y":s=(new Date).getFullYear().toString(),m=s,s=s.substring(s.length-+this.remainderLength),this.invoiceNumber+=s,this.filterString+="&year="+m;break;case"M":m=((new Date).getMonth()+1).toString(),s="0"+m.slice(-2),this.invoiceNumber+=s,this.filterString+="&month="+m;break;case"B":s=i.length>=+this.remainderLength?i.toString().slice(-this.remainderLength):this.pad(i,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&branch="+i;break;case"O":s=n.length>=+this.remainderLength?n.toString().slice(-this.remainderLength):this.pad(n,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&owner="+n;break;case"P":s=a.length>=+this.remainderLength?a.toString().slice(-this.remainderLength):this.pad(a,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&building="+a;break;case"U":s=r.length>=+this.remainderLength?r.toString().slice(-this.remainderLength):this.pad(r,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&unit="+r;break;case"T":s=l.length>=+this.remainderLength?l.toString().slice(-this.remainderLength):this.pad(l,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&customer="+l;break;case"C":s=g.length>=+this.remainderLength?g.toString().slice(-this.remainderLength):this.pad(g,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&contract="+g;break;case"E":s=h.length>=+this.remainderLength?h.toString().slice(-this.remainderLength):this.pad(h,this.remainderLength),this.invoiceNumber+=s,this.filterString+="&user="+h;break;case"F":this.invoiceNumber+=s=this.partStartWith;break;case"S":console.log("----++++++++++-------"),console.log("this.filterString:: "+this.filterString),console.log("----++++++++++-------"),this.invoiceService.getInvoicesPerSpecOneString(this.filterString).subscribe(V=>{console.log("----++++++++++-------"),console.log("responseInvoice.length:: "+V.length),console.log("----++++++++++-------"),V.length>0?(this.maxSerial=V[0].INVSerial??0,this.maxSerial+=1,(m=this.maxSerial.toString()).length>=this.partDigitNo?this.invoiceNumber+=s=m:(s=this.pad(m.toString(),this.partDigitNo),this.invoiceNumber+=s),this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=P*after Serial*****---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------"),console.log("------before mapFormvalue_to_InvoiceClass--------"),this.mapFormvalue_to_InvoiceClass(),console.log("------after mapFormvalue_to_InvoiceClass--------")):(this.maxSerial=1,console.log("new maxSerial:: "+this.maxSerial),this.partDigitNo>1?(s=this.pad(1,this.partDigitNo),this.invoiceNumber+=s):this.invoiceNumber+="1",this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=P*after Serial new rows*****---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------"),console.log("------before mapFormvalue_to_InvoiceClass--------"),this.mapFormvalue_to_InvoiceClass(),console.log("------after mapFormvalue_to_InvoiceClass--------"))})}}):(console.log("---Now Here DocPartType not equal P--------"),this.contractService.getMaxInvoiceCodePerType(this.data.COMId,this.data.periorty,this.curDocUsed).subscribe(f=>{this.maxSerial=f.max,this.invoiceNumber=this.maxSerial.toString(),this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=G******---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------"),console.log("------before mapFormvalue_to_InvoiceClass--------"),this.mapFormvalue_to_InvoiceClass(),console.log("------after mapFormvalue_to_InvoiceClass--------")}))})}prepareMsgLanguage(){this.data.invCTT==this.sellInvoice_CTT?this.translateService.get("ADMIN_NAV.TaxInvoice").subscribe(t=>{this.titleMsg=t}):this.data.invCTT==this.requestInvoice_CTT?this.translateService.get("ADMIN_NAV.RequestInvoice").subscribe(t=>{this.titleMsg=t}):this.data.invCTT==this.expenseInvoice_CTT&&this.translateService.get("ADMIN_NAV.ExpensesInv").subscribe(t=>{this.titleMsg=t})}}function it(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"mat-button-toggle",21),e.NdJ("click",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.addNewInvoice())}),e.TgZ(1,"mat-icon"),e._uU(2,"note_add"),e.qZA()()}}W.\u0275fac=function(t){return new(t||W)(e.Y36(v.so),e.Y36(v.WI),e.Y36(se.Z),e.Y36(le.X),e.Y36(ce.d),e.Y36(ue.W),e.Y36(de.v),e.Y36(x.sK),e.Y36(fe.g),e.Y36(Z.q),e.Y36(M.ux),e.Y36(v.uw),e.Y36(c.QS))},W.\u0275cmp=e.Xpm({type:W,selectors:[["app-expenses-inv-dialog"]],decls:147,vars:72,consts:[["mat-dialog-title",""],["autocomplete","off",3,"formGroup"],["mat-dialog-content",""],["fxLayout","row wrap"],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["fxFlex","100","fxFlex.gt-sm","49.8",1,"px-1"],["appearance","outline",1,"w-100"],["formControlName","BRAKeyField","id","branchaOpSel",3,"placeholder","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-sm","29.8",1,"px-1"],["matInput","","formControlName","INVDate",3,"matDatepicker","dateChange"],["matSuffix","",3,"for"],["invDate",""],["fxFlex","100","fxFlex.gt-sm","10",1,"px-1"],["matInput","","formControlName","INVYear"],["matInput","","formControlName","INVMonth"],["fxFlex","100","fxFlex.gt-sm","50.0",1,"px-1"],["formControlName","build_KeyField",3,"placeholder","selectionChange"],["fxFlex","100","fxFlex.gt-sm","19.9",1,"px-1"],["formControlName","unit_KeyField","id","unitOneOpSel",3,"placeholder","selectionChange"],["fxFlex","100","fxFlex.gt-sm","30.0",1,"px-1"],["formControlName","owner_KeyField","id","oneOwnerOpSel",3,"placeholder"],["fxFlex","100","fxFlex.gt-sm","14.9",1,"px-1"],["matInput","",3,"keyup.enter"],["tenCode",""],["appearance","outline","formControlName","CUSKeyField","id","oneCustomOpSel",1,"w-100",3,"placeholder","change"],["fxFlex","100","fxFlex.gt-sm","20",1,"px-1"],["matInput","","formControlName","INVNumber"],["matInput","","formControlName","INVSerial"],["formArrayName","items",1,"table","table-bordered"],[1,"bg-primary","text-white"],[2,"width","5%"],[2,"width","30%"],[3,"formGroupName",4,"ngFor","ngForOf"],["colspan","6"],["mat-raised-button","","type","button","color","primary",3,"click",4,"ngIf"],["fxFlex","100","fxFlex.gt-sm","27.0",1,"px-1"],["matInput","","formControlName","INVTotalValue",3,"change"],["fxFlex","100","fxFlex.gt-sm","20.0",1,"px-1"],["matInput","","formControlName","INVTax"],["fxFlex","100","fxFlex.gt-sm","25.0",1,"px-1"],["matInput","","formControlName","INVTaxValue"],["matInput","","formControlName","INVNetValue"],["mat-dialog-actions",""],["mat-raised-button","","type","button","color","warn",3,"click"],[3,"formGroupName"],["formControlName","INVKeyField",1,"form-control"],["formControlName","ITMKeyField",1,"form-control"],["formControlName","INVDQty",1,"form-control"],["formControlName","INVDPrice",1,"form-control"],["formControlName","INVDTaxValue",1,"form-control"],[1,"btn","btn-remove"],["mat-raised-button","","type","button","color","primary",3,"click"],[4,"ngIf"]],template:function(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"h1",0),e._uU(1),e.qZA(),e.TgZ(2,"form",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"mat-select",7),e.NdJ("selectionChange",function(r){return i.getBuildings(r)}),e.ALo(12,"translate"),e.TgZ(13,"mat-option",8),e._uU(14,"-"),e.qZA(),e.YNc(15,He,2,2,"mat-option",9),e.qZA()()(),e.TgZ(16,"div",10)(17,"mat-form-field",6)(18,"mat-label"),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"input",11),e.NdJ("dateChange",function(r){return i.onChangeDate(r)}),e.qZA(),e._UZ(22,"mat-datepicker-toggle",12)(23,"mat-datepicker",null,13),e.qZA()(),e.TgZ(25,"div",14)(26,"mat-form-field",6)(27,"mat-label"),e._uU(28),e.ALo(29,"translate"),e.qZA(),e._UZ(30,"input",15),e.qZA()(),e.TgZ(31,"div",14)(32,"mat-form-field",6)(33,"mat-label"),e._uU(34),e.ALo(35,"translate"),e.qZA(),e._UZ(36,"input",16),e.qZA()()(),e.TgZ(37,"div",4)(38,"div",17)(39,"mat-form-field",6)(40,"mat-label"),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.TgZ(43,"mat-select",18),e.NdJ("selectionChange",function(r){return i.readBuilding(r)}),e.ALo(44,"translate"),e.TgZ(45,"mat-option",8),e._uU(46,"-"),e.qZA(),e.YNc(47,Qe,2,2,"mat-option",9),e.qZA()()(),e.TgZ(48,"div",19)(49,"mat-form-field",6)(50,"mat-label"),e._uU(51),e.ALo(52,"translate"),e.qZA(),e.TgZ(53,"mat-select",20),e.NdJ("selectionChange",function(r){return i.readUnit(r)}),e.ALo(54,"translate"),e.TgZ(55,"mat-option",8),e._uU(56,"-"),e.qZA(),e.YNc(57,je,2,2,"mat-option",9),e.qZA()()(),e.TgZ(58,"div",21)(59,"mat-form-field",6)(60,"mat-label"),e._uU(61),e.ALo(62,"translate"),e.qZA(),e.TgZ(63,"mat-select",22),e.ALo(64,"translate"),e.TgZ(65,"mat-option",8),e._uU(66,"-"),e.qZA(),e.YNc(67,Ge,2,2,"mat-option",9),e.qZA()()()(),e.TgZ(68,"div",4)(69,"div",23)(70,"mat-form-field",6)(71,"mat-label"),e._uU(72),e.ALo(73,"translate"),e.qZA(),e.TgZ(74,"input",24,25),e.NdJ("keyup.enter",function(){e.CHM(n);const r=e.MAs(75);return e.KtG(i.searchByCode(r.value))}),e.qZA()()(),e.TgZ(76,"div",17)(77,"ng-select",26),e.NdJ("change",function(r){return i.readCustumer(r)}),e.ALo(78,"translate"),e.YNc(79,We,2,2,"ng-option",9),e.qZA()(),e.TgZ(80,"div",27)(81,"mat-form-field",6)(82,"mat-label"),e._uU(83),e.ALo(84,"translate"),e.qZA(),e._UZ(85,"input",28),e.qZA()(),e.TgZ(86,"div",23)(87,"mat-form-field",6)(88,"mat-label"),e._uU(89),e.ALo(90,"translate"),e.qZA(),e._UZ(91,"input",29),e.qZA()()(),e.TgZ(92,"div",4)(93,"table",30)(94,"thead",31)(95,"tr")(96,"td",32),e._uU(97,"Serial"),e.qZA(),e.TgZ(98,"td"),e._uU(99,"Invoice"),e.qZA(),e.TgZ(100,"td",33),e._uU(101,"Product"),e.qZA(),e.TgZ(102,"td"),e._uU(103,"Qty"),e.qZA(),e.TgZ(104,"td"),e._uU(105,"Price"),e.qZA(),e.TgZ(106,"td"),e._uU(107,"Tax"),e.qZA(),e.TgZ(108,"td"),e._uU(109,"Actions"),e.qZA()()(),e.TgZ(110,"tbody"),e.YNc(111,$e,16,2,"tr",34),e.qZA(),e.TgZ(112,"tfoot")(113,"tr")(114,"td",35),e.YNc(115,Xe,3,3,"button",36),e.qZA()()()()(),e.TgZ(116,"div",4)(117,"div",37)(118,"mat-form-field",6)(119,"mat-label"),e._uU(120),e.ALo(121,"translate"),e.qZA(),e.TgZ(122,"input",38),e.NdJ("change",function(r){return i.onChangeTotal(r)}),e.qZA()()(),e.TgZ(123,"div",39)(124,"mat-form-field",6)(125,"mat-label"),e._uU(126),e.ALo(127,"translate"),e.qZA(),e._UZ(128,"input",40),e.qZA()(),e.TgZ(129,"div",41)(130,"mat-form-field",6)(131,"mat-label"),e._uU(132),e.ALo(133,"translate"),e.qZA(),e._UZ(134,"input",42),e.qZA()(),e.TgZ(135,"div",37)(136,"mat-form-field",6)(137,"mat-label"),e._uU(138),e.ALo(139,"translate"),e.qZA(),e._UZ(140,"input",43),e.qZA()()()()(),e.TgZ(141,"div",44)(142,"div",4)(143,"button",45),e.NdJ("click",function(){return i.onclose()}),e._uU(144),e.ALo(145,"translate"),e.qZA(),e.YNc(146,tt,3,2,"button",36),e.qZA()()()}if(2&t){const n=e.MAs(24);e.xp6(1),e.Oqu(i.titleMsg),e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(7),e.hij(" ",e.lcZ(10,32,"HTML.BRANCH"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(12,34,"HTML.BRANCH")),e.xp6(4),e.Q6J("ngForOf",i.AllBranches),e.xp6(4),e.Oqu(e.lcZ(20,36,"HTML.InvoiceDate")),e.xp6(2),e.Q6J("matDatepicker",n),e.xp6(1),e.Q6J("for",n),e.xp6(6),e.hij(" ",e.lcZ(29,38,"OPTIONS.Year"),""),e.xp6(6),e.hij(" ",e.lcZ(35,40,"OPTIONS.Month"),""),e.xp6(7),e.hij(" ",e.lcZ(42,42,"HTML.BUILDING"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(44,44,"HTML.BUILDING")),e.xp6(4),e.Q6J("ngForOf",i.AllBuilding),e.xp6(4),e.hij(" ",e.lcZ(52,46,"HTML.UNIT"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(54,48,"HTML.UNIT")),e.xp6(4),e.Q6J("ngForOf",i.AllUnitsForBuilding),e.xp6(4),e.hij(" ",e.lcZ(62,50,"HTML.OWNER"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(64,52,"HTML.OWNER")),e.xp6(4),e.Q6J("ngForOf",i.AllOwners),e.xp6(5),e.Oqu(e.lcZ(73,54,"HTML.CODE_TENANT")),e.xp6(5),e.s9C("placeholder",e.lcZ(78,56,"HTML.TENANT")),e.xp6(2),e.Q6J("ngForOf",i.AllTenants),e.xp6(4),e.hij(" ",e.lcZ(84,58,"HTML.DOC_NUMBER"),""),e.xp6(6),e.hij(" ",e.lcZ(90,60,"HTML.Serial"),""),e.xp6(22),e.Q6J("ngForOf",i.invProducts.controls),e.xp6(4),e.Q6J("ngIf",i.can("change_taxinvoice")),e.xp6(5),e.hij(" ",e.lcZ(121,62,"HTML.TotalValueWithoutTax"),""),e.xp6(6),e.hij(" ",e.lcZ(127,64,"HTML.TaxPercent"),""),e.xp6(6),e.hij(" ",e.lcZ(133,66,"HTML.TaxValue"),""),e.xp6(6),e.hij(" ",e.lcZ(139,68,"HTML.NetValueWithTax"),""),e.xp6(6),e.Oqu(e.lcZ(145,70,"BTN.CANCEL")),e.xp6(2),e.Q6J("ngIf",i.data.invoiceRow&&i.can("change_taxinvoice")||!i.data.invoiceRow&&i.can("add_taxinvoice"))}},dependencies:[p.sg,p.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,I.xw,I.Wh,I.yH,z.ey,y.lW,A.Mq,A.hl,A.nW,v.uh,v.xY,v.H8,S.Nt,T.KE,T.hX,T.R9,ee.gD,D.w9,D.jq,x.X$],styles:["a[_ngcontent-%COMP%]{color:red!important;padding:1%}footer[_ngcontent-%COMP%]{margin-top:8px;display:flex;align-items:center;line-height:20px}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center}"]});const nt=function(o){return["/invoice/expensesinv-add/",o]};function ot(o,t){if(1&o&&(e.TgZ(0,"a",31),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"edit"),e.qZA()()),2&o){const i=e.oxw().$implicit;e.s9C("matTooltip",e.lcZ(1,2,"BTN.EDIT")),e.Q6J("routerLink",e.VKq(4,nt,i.id))}}function at(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(i);const a=e.oxw().$implicit,r=e.oxw();return e.KtG(r.gotoNewInvoice(a))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"visibility"),e.qZA()()}2&o&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.VIEW"))}function rt(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){e.CHM(i);const a=e.oxw().$implicit,r=e.oxw();return e.KtG(r.removeInvoice(a.id))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"delete"),e.qZA()()}2&o&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.REMOVE"))}function st(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(i);const a=e.oxw().$implicit,r=e.oxw();return e.KtG(r.printEInvoice(a))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"print"),e.qZA()()}2&o&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.ExpenseInv"))}function lt(o,t){if(1&o&&(e.TgZ(0,"div",22)(1,"div",23),e._uU(2),e._UZ(3,"br"),e._uU(4),e._UZ(5,"br"),e._uU(6),e.qZA(),e.TgZ(7,"div",23),e._uU(8),e.qZA(),e.TgZ(9,"div",23),e._uU(10),e.qZA(),e.TgZ(11,"div",23),e._uU(12),e.qZA(),e.TgZ(13,"div",23),e._uU(14),e.qZA(),e.TgZ(15,"div",24),e._uU(16),e.qZA(),e.TgZ(17,"div",25),e._uU(18),e.qZA(),e.TgZ(19,"div",26)(20,"div",27),e.YNc(21,ot,4,6,"a",28),e.YNc(22,at,4,3,"button",29),e.YNc(23,rt,4,3,"button",30),e.YNc(24,st,4,3,"button",29),e.qZA()()()),2&o){const i=t.$implicit,n=e.oxw();e.Tol(n.statusColor[i.INVPayType]),e.xp6(2),e.Oqu(i.unit_UnitNumber),e.xp6(2),e.Oqu(i.build_Name),e.xp6(2),e.Oqu(i.branch_ArbName),e.xp6(2),e.hij(" ",i.CUSKeyField_CUSName," "),e.xp6(2),e.hij(" ",i.CUSKeyField_CUSMobile," "),e.xp6(2),e.hij(" ",i.INVDate," "),e.xp6(2),e.hij(" ",i.INVNumber," "),e.xp6(2),e.hij(" ",i.INVNetValue," "),e.xp6(2),e.hij(" ",i.owner_FullName," "),e.xp6(3),e.Q6J("ngIf",n.can("view_oneexpensesinv")),e.xp6(1),e.Q6J("ngIf",n.can("view_oneexpensesinv")),e.xp6(1),e.Q6J("ngIf",n.can("delete_expensesinv")),e.xp6(1),e.Q6J("ngIf",n.can("print_expensesinv"))}}function ct(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"div",34)(1,"div",35)(2,"mat-card",36)(3,"pagination-controls",37),e.NdJ("pageChange",function(a){e.CHM(i);const r=e.oxw();return e.KtG(r.onPageChanged(a))}),e.qZA()()()()}}function ut(o,t){1&o&&(e.TgZ(0,"div",38),e._UZ(1,"mat-spinner",39),e.qZA())}const dt=function(o,t){return{itemsPerPage:o,currentPage:t}};class R{constructor(t,i,n,a,r,l,h,g,s,m,C){this.transferService=t,this.dataService=i,this.appSettings=n,this.activatedRoute=a,this.dialog=r,this.invService=l,this.router=h,this.global=g,this.localStore=s,this.translateService=m,this.snackBar=C,this.statusColor={C:"make-white",B:"make-gold",E:"make-yellowgreen",T:"make-yellow"},this.expensesInvoiceCTT=(new d.I).ExpensesInvoice,this.sellInvoiceCTT=(new d.I).SellInvoice,this.addAlarmCTT=(new d.I).AddAlarm,this.discountAlarmCTT=(new d.I).DiscountAlarm,this.requestInvoiceCTT=(new d.I).RequestInvoice,this.account=new H.n,this.count=8,this.userPerm=[],this.settings=this.appSettings.settings}ngOnDestroy(){this.userSUb&&this.userSUb.unsubscribe()}ngOnInit(){if(this.securityForApp=(new d.$).getSecurityType(),this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curCOMId=this.curUserData.COMId,this.appSetup=JSON.parse(this.localStore.getItem("appsetup")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;switch(this.contForTenant=this.activatedRoute.params.subscribe(t=>{t.tenantid?(this.idForTenant=+t.tenantid,console.log("params['tenantid']:: "+this.idForTenant)):this.idForTenant=0}),console.log("line 104 this.idForTenant:: "+this.idForTenant),this.activatedRoute.data.subscribe(t=>{this.invTypeSent=t.invType}),console.log("ngOnInit for Invoices Type:: "+this.invTypeSent),this.invTypeSent){case"X":this.currentInvoiceCTT=this.expensesInvoiceCTT;break;case"S":default:this.currentInvoiceCTT=this.sellInvoiceCTT;break;case"R":this.currentInvoiceCTT=this.requestInvoiceCTT;break;case"A":this.currentInvoiceCTT=this.addAlarmCTT;break;case"D":this.currentInvoiceCTT=this.discountAlarmCTT}this.invFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty+"&usr=all&invtype="+this.currentInvoiceCTT,console.log("line 108 this.invFilterString:: "+this.invFilterString),this.prepareMsgLanguage(),this.getInvoices()}}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getInvoices(){console.log("getInvoices for type:: "+this.invTypeSent),this.invoiceAll=null,this.curUserData.is_superuser?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString).subscribe(t=>this.invoiceAll=t):"T"==this.curUserData.is_owner?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&owner="+this.curUserData.owner_KeyField).subscribe(t=>this.invoiceAll=t):"T"==this.curUserData.is_employee?("N"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&branch="+this.account.branch_KeyField).subscribe(t=>this.invoiceAll=t)),"D"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.invoiceAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&user="+this.account.id).subscribe(t=>this.invoiceAll=t))):0==this.curUserData.periorty&&(this.curCustomerID=this.account.customer_KeyField??0,this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.curCustomerID).subscribe(t=>this.invoiceAll=t))}removeInvoice(t){this.dialog.open(ae.$,{maxWidth:"400px",data:{title:this.deletedTitleMsg,message:this.askToDeletedMsg}}).afterClosed().subscribe(n=>{n&&this.invService.deleteInvoice(t).subscribe(a=>this.getInvoices())})}openDialog(){}onPageChanged(t){this.page=t,this.getInvoices(),window.scrollTo(0,0)}printEInvoice(t){this.invtype_CTTCode=t.InvType_CTTCode,this.invtype_Char=this.currentInvoiceCTT,this.transferService.setMessage({customer_EInvoiceType:t.customer_EInvoiceType,invId:t.id,invType:this.invtype_Char,invDate:t.INVDate,invDateString:t.INVDateString,invFrom:t.INVFromDate,invTo:t.INVToDate,ownerID:t.owner_KeyField,tenantID:t.CUSKeyField,ownerTaxNumber:t.owner_TaxNumber,ownerName:t.owner_FullName,ownerAddress:t.owner_Address,ownerCommRegister:t.owner_CommercialRegister,tenantCommRegister:t.customer_CommercialRegister,ownerBankName:t.owner_BankName,ownerBankAccountNumber:t.owner_BankAccountNumber,accountOwnerName:t.owner_BankAccountOwnerName,tenantName:t.CUSKeyField_CUSName,tenantAddress:t.customer_Address,tenantTaxNumber:t.customer_TaxNumber,invoiceValue:t.INVTotalValue,invoiceNumber:t.INVNumber,intervalStartDate:t.INVFromDate,intervalEndDate:t.INVToDate,ownerLogo:t.owner_LogoPic,ownerLogoBase64:t.owner_LogoBase64}),this.router.navigate(["/contracts/print-einvoice/"])}addNewInvoice(){this.router.navigate(["/invoice/expensesinv-add/"])}gotoNewInvoice(t){this.dialog.open(W,{data:{invoiceRow:t,periorty:this.account.periorty,curUserData:this.curUserData,userPerm:this.userPerm,COMId:this.curCOMId,invCTT:this.currentInvoiceCTT},panelClass:["theme-dialog"],autoFocus:!1,direction:this.settings.rtl?"rtl":"ltr"}).afterClosed().subscribe(n=>{"Cancel"==n?.event?"T"==n.changestartus&&console.log("--After Cancel getInvoices"):"Patch"==n?.event?(console.log("---Patch----"),this.getInvoices()):"Post"==n.event&&(console.log("-------POOOOOOSSSSST"),this.getInvoices())})}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(t=>{this.deletedTitleMsg=t})}}R.\u0275fac=function(t){return new(t||R)(e.Y36(he.y),e.Y36(me.n),e.Y36(te.d),e.Y36(b.gz),e.Y36(v.uw),e.Y36(Z.q),e.Y36(b.F0),e.Y36(U.U),e.Y36(Q.C),e.Y36(x.sK),e.Y36(M.ux))},R.\u0275cmp=e.Xpm({type:R,selectors:[["app-expenses-inv-list"]],features:[e._Bn([Z.q])],decls:64,vars:43,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"p-2"],["fxLayout","row"],["appearance","legacy"],["controls","matButtonToggleGroup"],["value","add",3,"click",4,"ngIf"],["value","search"],[1,"user-search"],[1,"user-search-input"],["matInput","","name","search","autocomplete","off",3,"placeholder","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-between center"],["appearance","legacy","value","list"],["viewType","matButtonToggleGroup"],["value","list"],["value","grid"],["fxLayout","row wrap","fxLayoutAlign","space-between center",1,"w-100","p-3"],[1,"mat-mdc-table","admin-table"],[1,"mat-mdc-header-row"],[1,"mat-mdc-header-cell"],["class","mat-mdc-row",3,"class",4,"ngFor","ngForOf"],["fxLayout","row wrap",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","user-spinner",4,"ngIf"],["value","add",3,"click"],[1,"mat-mdc-row"],[1,"mat-mdc-cell"],[1,"mat-column-total"],[1,"mat-column-ownerName"],[1,"mat-column-action"],[1,"p-2","actions"],["mat-mini-fab","","color","primary",3,"routerLink","matTooltip",4,"ngIf"],["mat-mini-fab","","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"routerLink","matTooltip"],["mat-mini-fab","","color","primary",3,"matTooltip","click"],["mat-mini-fab","","color","warn",3,"matTooltip","click"],["fxLayout","row wrap"],["fxFlex","100",1,"p-2"],[1,"text-center"],["autoHide","true","maxSize","5",1,"product-pagination",3,"pageChange"],["fxLayout","column","fxLayoutAlign","center center",1,"user-spinner"],["color","primary"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-button-toggle-group",2,3),e.YNc(4,it,3,0,"mat-button-toggle",4),e.TgZ(5,"mat-button-toggle",5)(6,"mat-icon"),e._uU(7,"search"),e.qZA()()()(),e.TgZ(8,"form",6)(9,"mat-form-field",7)(10,"input",8),e.NdJ("ngModelChange",function(a){return i.searchText=a}),e.ALo(11,"translate"),e.qZA()()(),e.TgZ(12,"div",9)(13,"mat-button-toggle-group",10,11)(15,"mat-button-toggle",12)(16,"mat-icon"),e._uU(17,"view_list"),e.qZA()(),e.TgZ(18,"mat-button-toggle",13)(19,"mat-icon"),e._uU(20,"view_module"),e.qZA()()()()(),e._UZ(21,"mat-divider"),e.TgZ(22,"mat-card")(23,"div",14)(24,"h2"),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e._UZ(27,"mat-divider"),e.TgZ(28,"div",15)(29,"div",16)(30,"div",17)(31,"h3"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div",17)(35,"h3"),e._uU(36),e.ALo(37,"translate"),e.qZA()(),e.TgZ(38,"div",17)(39,"h3"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"div",17)(43,"h3"),e._uU(44),e.ALo(45,"translate"),e.qZA()(),e.TgZ(46,"div",17)(47,"h3"),e._uU(48),e.ALo(49,"translate"),e.qZA()(),e.TgZ(50,"div",17)(51,"h3"),e._uU(52),e.ALo(53,"translate"),e.qZA()(),e.TgZ(54,"div",17)(55,"h3"),e._uU(56),e.ALo(57,"translate"),e.qZA()(),e._UZ(58,"div",17),e.qZA(),e.YNc(59,lt,25,15,"div",18),e.ALo(60,"paginate"),e.ALo(61,"InvoiceSearchPipe"),e.qZA()(),e.YNc(62,ct,4,0,"div",19),e.YNc(63,ut,2,0,"div",20)),2&t){const n=e.MAs(3);e.xp6(4),e.Q6J("ngIf",i.can("add_expensesinv")),e.xp6(4),e.ekj("show","search"==n.value),e.xp6(2),e.s9C("placeholder",e.lcZ(11,16,"HTML.SEARCH_INVOICE")),e.Q6J("ngModel",i.searchText),e.xp6(15),e.Oqu(e.lcZ(26,18,"HTML.Invoice_List")),e.xp6(7),e.hij(" ",e.lcZ(33,20,"HTML.UnitNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(37,22,"HTML.TENANT")," "),e.xp6(4),e.hij(" ",e.lcZ(41,24,"HTML.MOBILE")," "),e.xp6(4),e.hij(" ",e.lcZ(45,26,"HTML.Date")," "),e.xp6(4),e.hij(" ",e.lcZ(49,28,"HTML.INVNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(53,30,"HTML.NetValueWithTax")," "),e.xp6(4),e.hij(" ",e.lcZ(57,32,"HTML.OWNER")," "),e.xp6(3),e.Q6J("ngForOf",e.xi3(60,34,e.xi3(61,37,i.invoiceAll,i.searchText),e.WLB(40,dt,i.count,i.page))),e.xp6(3),e.Q6J("ngIf",i.invoiceAll),e.xp6(1),e.Q6J("ngIf",!i.invoiceAll)}},dependencies:[p.sg,p.O5,b.rH,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F,w.LS,I.xw,I.Wh,I.yH,y.Tq,y.nh,L.A9,L.Yi,P.a8,q.Hw,S.Nt,T.KE,pe.d,ge.Ou,ie.gM,w._s,ve.s4,x.X$],styles:[".user-name{padding:0 12px;font-weight:400}.user-content{padding:10px}.user-content .user-img{position:relative}.user-content .user-img img{border-radius:50%;width:80px;height:80px}.user-content .user-img img.blocked{opacity:.5}.user-content .user-img .mat-icon{position:absolute;top:-8px;left:-8px;font-size:96px;height:96px;width:96px}.user-content .mat-mdc-slide-toggle{margin-top:15px}.user-content .user-details span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-content .user-details .mat-icon{padding:2px 10px}.user-content .user-details.blocked{opacity:.5}.user-search{width:0;overflow:hidden;transition:.3s}.user-search .mat-mdc-form-field{width:100%!important;text-align:center!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-infix{min-height:36px;padding:8px 0!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.user-search .mat-mdc-input-element{text-align:center}.user-search.show{width:100%;overflow:visible}.user-spinner{position:absolute;inset:0}.mat-mdc-card{overflow:hidden}table{width:100%}.make-gold{background-color:#fbea96}.make-yellow{background-color:#ff4500}.make-yellowgreen{background-color:#ad7020}.make-white{background-color:#fff}.demo-table{width:100%}.mat-mdc-row:hover .mat-mdc-cell{border-color:currentColor}.row-is-clicked{font-weight:700}.mat-column-action{word-wrap:break-word!important;white-space:unset!important;flex:0 0 18%!important;width:18%!important;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;-webkit-hyphens:auto;hyphens:auto}.mat-column-total{word-wrap:break-word!important;white-space:unset!important;flex:0 0 7%!important;width:7%!important;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;-webkit-hyphens:auto;hyphens:auto}.mat-column-ownerName{word-wrap:break-word!important;white-space:unset!important;flex:0 0 15%!important;width:15%!important;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;-webkit-hyphens:auto;hyphens:auto}\n"],encapsulation:2});var ht=u(4401);function mt(o,t){if(1&o&&(e.TgZ(0,"mat-option",7),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BRAArbName," ")}}function pt(o,t){if(1&o&&(e.TgZ(0,"mat-option",7),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BUIName," ")}}function gt(o,t){if(1&o&&(e.TgZ(0,"mat-option",7),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.UNTUnitNumber," ")}}function vt(o,t){if(1&o&&(e.TgZ(0,"mat-option",7),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.OWNName," ")}}function _t(o,t){if(1&o&&(e.TgZ(0,"ng-option",7),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.CUSName,"")}}function ft(o,t){if(1&o&&(e.TgZ(0,"option",7),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.Oqu(i.ITMAraName)}}function It(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"div",52)(1,"div",53)(2,"input",54),e.NdJ("change",function(a){const l=e.CHM(i).index,h=e.oxw();return e.KtG(h.SearchByBarcode(a,l))}),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",38)(5,"select",55),e.NdJ("change",function(a){const l=e.CHM(i).index,h=e.oxw();return e.KtG(h.GetProductPrice(a,l))}),e.YNc(6,ft,2,2,"option",8),e.qZA()(),e.TgZ(7,"div",39)(8,"input",56),e.NdJ("change",function(a){const l=e.CHM(i).index,h=e.oxw();return e.KtG(h.CalculatePrice(a,l))}),e.ALo(9,"translate"),e.qZA()(),e.TgZ(10,"div",40),e._UZ(11,"input",57),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"div",41),e._UZ(14,"input",58),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"div",42),e._UZ(17,"input",59),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"div",43),e._UZ(20,"input",60),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"div",44)(23,"a",61),e.NdJ("click",function(){const r=e.CHM(i).index,l=e.oxw();return e.KtG(l.deleteItem(r))}),e.ALo(24,"translate"),e.TgZ(25,"mat-icon",62),e._uU(26,"delete"),e.qZA()()()()}if(2&o){const i=t.index,n=e.oxw();e.Q6J("formGroupName",i),e.xp6(1),e.MGl("id","search",i,""),e.xp6(1),e.s9C("placeholder",e.lcZ(3,10,"HTML.Barcode")),e.xp6(4),e.Q6J("ngForOf",n.products),e.xp6(2),e.s9C("placeholder",e.lcZ(9,12,"HTML.QTY")),e.xp6(3),e.s9C("placeholder",e.lcZ(12,14,"HTML.Price")),e.xp6(3),e.s9C("placeholder",e.lcZ(15,16,"HTML.TotalValueWithoutTax")),e.xp6(3),e.s9C("placeholder",e.lcZ(18,18,"HTML.TaxValue")),e.xp6(3),e.s9C("placeholder",e.lcZ(21,20,"HTML.NetValue")),e.xp6(3),e.s9C("matTooltip",e.lcZ(24,22,"BTN.REMOVE"))}}const Tt=function(){return["/invoice/expensesinv-list/"]};class K{constructor(t,i,n,a,r,l,h,g,s,m,C,f,N,V){this.fb=t,this.ProductService=i,this.invoiceServices=n,this.global=a,this.localStore=r,this.translateService=l,this.snackBar=h,this.activatedRoute=g,this._codesService=s,this.atlasService=m,this.unitsService=C,this.contractService=f,this.tenantsService=N,this.router=V,this.Invoice={},this.products=[],this.message="",this.Success="",this.price=0,this.pricesRow=[],this.ErrorNotFound="",this.account=new H.n,this.expensesInvoiceCTT=(new d.I).ExpensesInvoice,this.userPerm=[],this.AllBranches=[],this.AllBuilding=[],this.AllUnitsForBuilding=[],this.AllOwners=[],this.AllTenants=[],this.myForm=this.fb.group({items:this.fb.array([])}),this.AddInvoiceForm=t.group({id:null,BRAKeyField:null,build_KeyField:null,unit_KeyField:null,owner_KeyField:null,INVType_CTTKeyField:null,CUSKeyField:null,contract_KeyField:null,user_KeyField:null,INVPayType:"C",INVCode:null,INVNumber:null,INVYear:null,INVMonth:null,INVSerial:null,INVDate:null,INVFromDate:null,INVToDate:null,INVTotalValue:0,INVShippingValue:0,INVNetValue:0,INVDiscount:0,INVDIscountType:null,INVPayedValue:0,INVStatus:"N",INVExpenses:0,INVCost:0,INVTax:15,INVTaxValue:0,INVDueDate:null,RowConfirm:0,RowDelete:0,RowStatus:0})}ngOnDestroy(){this.userSUb&&this.userSUb.unsubscribe()}ngOnInit(){if(this.securityForApp=(new d.$).getSecurityType(),this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curCOMId=this.curUserData.COMId,this.appSetup=JSON.parse(this.localStore.getItem("appsetup")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.prepareMsgLanguage(),this.getItems(),this.curUserData.is_superuser?this.getAllBranches(this.curCOMId,this.curUserData.periorty):"T"==this.curUserData.is_employee?this.getEmpBranches(this.curCOMId,this.curUserData.periorty,this.curUserData.id,this.curUserData.branch_KeyField??0):"T"==this.curUserData.is_owner&&this.getOwnerBranches(this.curCOMId,this.curUserData.periorty,this.curUserData.owner_KeyField,this.curUserData.branch_KeyField??0),this.getCodeTableTreePerCode(this.curCOMId,this.curUserData.periorty),this.getAllOwnerss(this.curCOMId,this.curUserData.periorty),this.getTenants(),this.curDate=new Date,this.yearValue=this.curDate.getFullYear().toString(),this.monthValue=(this.curDate.getMonth()+1).toString(),this.AddInvoiceForm.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue,INVDate:this.curDate}),this.sub=this.activatedRoute.params.subscribe(t=>{t.id?(this.id=+t.id,console.log("params['id']:: "+this.id),this.getInvoiceById(this.id),console.log(this.id),this.getInvoiceDetiles(this.id)):this.Invoice=new re})}}getInvoiceById(t){this.invoiceServices.getOneInvoice(t).subscribe(i=>{this.fillForm(i),this.Invoice=i})}getInvoiceDetiles(t){this.invoiceServices.GetDateilesToInvoice(t,this.curUserData.COMId).subscribe({next:i=>{console.log(i),i&&i.forEach((n,a)=>{let r=this.fb.group(n);this.items.push(r),this.SetPrices(a,n.INVDPrice,"items")})},error:i=>{console.log(i)}})}SetPrices(t,i,n){this.pricesRow.push({key:t,value:i,ArrayName:n})}fillForm(t){null!=t.BRAKeyField&&this.getBuildingPerBranch(this.curCOMId,this.account.periorty,t.BRAKeyField),null!=t.build_KeyField&&this.getUnitsPerBuilding(this.curCOMId,this.account.periorty,t.build_KeyField,""),this.AddInvoiceForm.patchValue({id:t.id,INVType_CTTKeyField:t.INVType_CTTKeyField,BRAKeyField:t.BRAKeyField,build_KeyField:t.build_KeyField,unit_KeyField:t.unit_KeyField,owner_KeyField:t.owner_KeyField,CUSKeyField:t.CUSKeyField,contract_KeyField:t.contract_KeyField,user_KeyField:t.user_KeyField,INVPayType:t.INVPayType,INVCode:t.INVCode,INVNumber:t.INVNumber,INVYear:t.INVYear,INVMonth:t.INVMonth,INVSerial:t.INVSerial,INVDate:t.INVDate,INVFromDate:t.INVFromDate,INVToDate:t.INVToDate,INVDateString:t.INVDateString,INVTotalValue:t.INVTotalValue,INVShippingValue:t.INVShippingValue,INVNetValue:t.INVNetValue,INVDiscount:t.INVDiscount,INVDIscountType:t.INVDIscountType,INVPayedValue:t.INVPayedValue,INVStatus:t.INVStatus,INVExpenses:t.INVExpenses,INVCost:t.INVCost,INVTax:t.INVTax,INVTaxValue:t.INVTaxValue,INVDueDate:t.INVDueDate,RCOTenantLeaveID:t.RCOTenantLeaveID})}getCodeTableTreePerCode(t,i){this._codesService.getRowPerCode(t,i,this.expensesInvoiceCTT).subscribe(n=>{this.cttID=n[0].id,console.log("---this.cttID:: "+this.cttID),this.AddInvoiceForm.patchValue({INVType_CTTKeyField:this.cttID})},n=>{this.snackBar.open("\u0644\u0645 \u0646\u062a\u0645\u0643\u0646 \u0645\u0646 \u0627\u062d\u0636\u0627\u0631 \u0645\u0641\u062a\u0627\u062d \u0646\u0648\u0639 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getItems(){this.productFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty+"&ejar=F&itemtype=P",this.products=null,this.ProductService.getProductsPerSpec(this.productFilterString).subscribe(t=>this.products=t)}getAllBranches(t,i){this.atlasService.getAllBranch(t,i).subscribe(n=>{this.AllBranches=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getEmpBranches(t,i,n,a){this.atlasService.getBranchPerEmp(t,i,n).subscribe(r=>{this.AllBranches=r,this.AllBranches.length>0||this.atlasService.getOneBranch(a).subscribe(l=>{this.AllBranches=l},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getOwnerBranches(t,i,n,a){this.atlasService.getBranchPerOwner(t,i,n).subscribe(r=>{this.AllBranches=r,this.AllBranches.length>0||this.atlasService.getOneBranch(a).subscribe(l=>{this.AllBranches=l},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onChangeDate(t){let i=t.value;this.yearValue=i.getFullYear().toString(),this.monthValue=(i.getMonth()+1).toString(),this.AddInvoiceForm.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue})}getBuildings(t){this.getBuildingPerBranch(this.curCOMId,this.curUserData.periorty,t.value)}getBuildingPerBranch(t,i,n){this.unitsService.getBuildingsPerBranch(t,i,n).subscribe(a=>{this.AllBuilding=a},a=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0639\u0642\u0627\u0631\u0627\u062a \u0644\u0644\u0641\u0631\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}readBuilding(t){this.unitsService.getOneBuilding(t.value).subscribe(i=>{this.curOwnerId=i.owner_KeyField,this.AddInvoiceForm.patchValue({owner_KeyField:this.curOwnerId})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}),this.getUnitsPerBuilding(this.curCOMId,this.curUserData.periorty,t.value,"A")}getUnitsPerBuilding(t,i,n,a){this.unitsService.getAllUnitsPerBuilding(t,i,n,a).subscribe(r=>{this.AllUnitsForBuilding=r},r=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0648\u062d\u062f\u0627\u062a \u0644\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}readUnit(t){t.value&&this.unitsService.getOneUnit(t.value).subscribe(i=>{this.AddInvoiceForm.patchValue({CUSKeyField:i.customer_KeyField})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0648\u062d\u062f\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getAllOwnerss(t,i){this.contractService.getAllOwners(t,i).subscribe(n=>{this.AllOwners=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0645\u0644\u0627\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}searchByCode(t){this.tenantsService.getCustomerPerCode(this.curCOMId,this.curUserData.periorty,+t).subscribe(i=>{i.length>0?(this.AddInvoiceForm.patchValue({CUSKeyField:i[0].id}),this.readCustumer(i[0].id)):(console.log("---Not---"),this.AddInvoiceForm.patchValue({CUSKeyField:null}))},i=>{console.log("----not found tenant----")})}readCustumer(t){this.tenantsService.getOneCustomer(t).subscribe(i=>{},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0623\u062c\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getTenants(){this.AllTenants=null,this.tenantsService.getCustomersConfirmed(this.curCOMId,this.curUserData.periorty).subscribe(t=>{this.AllTenants=t})}onChangeTotal(t){let i=t.target.value,a=i*this.AddInvoiceForm.value.INVTax/100;this.AddInvoiceForm.patchValue({INVTaxValue:a,INVNetValue:+i+ +a})}mapFormvalue_to_InvoiceClass(){this.AddInvoiceForm.enable();const t=new p.uU("en-GB").transform(this.AddInvoiceForm.value.INVDate,"dd/MM/yyyy"),i=new p.uU("en-GB").transform(this.AddInvoiceForm.value.INVFromDate,"dd/MM/yyyy"),n=new p.uU("en-GB").transform(this.AddInvoiceForm.value.INVToDate,"dd/MM/yyyy"),a=new p.uU("en-GB").transform(this.AddInvoiceForm.value.INVDueDate,"dd/MM/yyyy");this.Invoice.id=this.AddInvoiceForm.value.id,this.Invoice.BRAKeyField=this.AddInvoiceForm.value.BRAKeyField,this.Invoice.build_KeyField=this.AddInvoiceForm.value.build_KeyField,this.Invoice.unit_KeyField=this.AddInvoiceForm.value.unit_KeyField,this.Invoice.owner_KeyField=this.AddInvoiceForm.value.owner_KeyField,null!=this.AddInvoiceForm.value.INVDate&&(this.Invoice.INVDate=t),null!=this.AddInvoiceForm.value.INVFromDate&&(this.Invoice.INVFromDate=i),null!=this.AddInvoiceForm.value.INVToDate&&(this.Invoice.INVToDate=n),null!=this.AddInvoiceForm.value.INVDueDate&&(this.Invoice.INVDueDate=a),this.Invoice.CUSKeyField=this.AddInvoiceForm.value.CUSKeyField,this.Invoice.contract_KeyField=this.AddInvoiceForm.value.contract_KeyField,this.Invoice.user_KeyField=this.AddInvoiceForm.value.user_KeyField,this.AddInvoiceForm.value.INVType_CTTKeyField&&(this.Invoice.INVType_CTTKeyField=this.AddInvoiceForm.value.INVType_CTTKeyField),this.Invoice.INVPayType=this.AddInvoiceForm.value.INVPayType,this.Invoice.INVCode=this.AddInvoiceForm.value.INVCode,this.Invoice.INVNumber=this.AddInvoiceForm.value.INVNumber,this.Invoice.INVYear=this.AddInvoiceForm.value.INVYear,this.Invoice.INVMonth=this.AddInvoiceForm.value.INVMonth,this.Invoice.INVSerial=this.AddInvoiceForm.value.INVSerial,this.Invoice.INVDateString=this.AddInvoiceForm.value.INVDateString,this.Invoice.INVTotalValue=this.AddInvoiceForm.value.INVTotalValue,this.Invoice.INVShippingValue=this.AddInvoiceForm.value.INVShippingValue,this.Invoice.INVNetValue=this.AddInvoiceForm.value.INVNetValue,this.Invoice.INVDiscount=this.AddInvoiceForm.value.INVDiscount,this.Invoice.INVDIscountType=this.AddInvoiceForm.value.INVDIscountType,this.Invoice.INVPayedValue=this.AddInvoiceForm.value.INVPayedValue,this.Invoice.INVStatus=this.AddInvoiceForm.value.INVStatus,this.Invoice.INVExpenses=this.AddInvoiceForm.value.INVExpenses,this.Invoice.INVCost=this.AddInvoiceForm.value.INVCost,this.Invoice.INVTax=this.AddInvoiceForm.value.INVTax,this.Invoice.INVTaxValue=this.AddInvoiceForm.value.INVTaxValue,this.Invoice.RCOTenantLeaveID=this.AddInvoiceForm.value.RCOTenantLeaveID}SaveData(t){this.mapFormvalue_to_InvoiceClass(),t||this.invoiceServices.AddNewInvoice(this.Invoice).subscribe(i=>{this.Invoice=i,null!=i&&this.AddInvoiceDetails(i)})}AddInvoiceDetails(t){this.items.length>0?this.items.value.forEach((n,a)=>{parseFloat(n.INVDPrice)>0&&(n.INVKeyField=this.Invoice.id,n.INVDDate=t.INVDate,n.INVDCode=a+1,this.invoiceServices.AddDateilesToInvoice(n).subscribe(r=>{this.router.navigate(["/invoice/expensesinv-list"])}))}):this.router.navigate(["/invoice/expensesinv-list"])}get items(){return this.myForm.get("items")}GetProductPrice(t,i){let n=t.target.value;null!=n&&null!=i&&(this.productFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty+"&ejar=F&id="+n,console.log("productFilterString:: "+this.productFilterString),this.ProductService.getProductsPerSpec(this.productFilterString).subscribe(a=>{console.log(a),this.myForm.get("items").at(i).patchValue({INVDPrice:a[0].ITMPrice,line_total:a[0].ITMPrice,ITMKeyField:a[0].id,INVDQty:"1.00",ITMBarcode:a[0].ITMBarcode}),this.UpdateINVTotalValue(a[0].ITMPrice,i),this.CalcaluteRowNetValue(i,a[0].ITMPrice),this.addItem(i+1)}))}CalculatePrice(t,i){let n=parseInt(t.target.value);const r=this.myForm.get("items").at(i);this.price=parseFloat(r.get("INVDPrice")?.value),r.patchValue({line_total:n*this.price}),this.UpdateINVTotalValue(n*this.price,i),this.CalcaluteRowNetValue(i,n*this.price)}UpdateINVTotalValue(t,i){let n=-1;for(var a=0;a<this.pricesRow.length;a++)if(this.pricesRow[a].key===i){this.pricesRow[a].value=t,n=i;break}-1==n&&this.pricesRow.push({key:i,value:t}),this.CalcaluteINVTotalValue()}CalcaluteINVTotalValue(){let t=0;for(var i=0;i<this.pricesRow.length;i++)t+=parseFloat(this.pricesRow[i].value);this.AddInvoiceForm.patchValue({INVTotalValue:t}),this.CalcaluteINVTaxValue()}ReadyToAddRow(){const t=this.myForm.get("items"),i=t.length;return 0==i||t.at(i-1).get("ITMKeyField")?.value>0}addItem(t){const n=this.myForm.get("items").length;this.newrow=0==t?n+1:t+1,console.log("this.newrow:: "+this.newrow);const a=this.fb.group({id:null,COMId:this.curCOMId,BRAKeyField:null,ITMKeyField:null,INVDQty:"0.00",INVDPrice:"0.00",ITMBarcode:"",line_total:0,INVDDiscount:null,INVDDiscountType:null,INVType_CTTKeyField:null,INVDCode:this.newrow,INVDCost:null,INVDDate:null,EntryDate:new Date,EntryUser:null,RowConfirm:0,RowDelete:0,RowStatus:0,INVKeyField:null,INVDTax:["0.00"],INVDTaxValue:["0.00"],RowNetValue:["0.00"]});1==this.ReadyToAddRow()&&this.items.push(a),console.log("items ",this.items)}deleteItem(t){this.items.removeAt(t),this.FilterArray(t),this.CalcaluteINVTotalValue()}FilterArray(t){for(var i=0;i<this.pricesRow.length;i++)if(this.pricesRow[i].key==t){this.pricesRow=this.pricesRow.filter(n=>n.key!==t);break}}CalcaluteRowNetValue(t,i){const a=this.myForm.get("items").at(t);let r=parseFloat(a.get("INVDTax")?.value),l=parseFloat(a.get("INVDDiscount")?.value);r=Number.isNaN(r)?0:r,l=Number.isNaN(l)?0:l,a.patchValue({RowNetValue:i+r-l})}CalcaluteINVTaxValue(){let t=parseFloat(this.AddInvoiceForm.get("INVTax")?.value),n=parseFloat(this.AddInvoiceForm.get("INVTotalValue")?.value)/100*t;this.AddInvoiceForm.patchValue({INVTaxValue:n}),this.CalcaluteINVNetValue()}CalcaluteINVNetValue(){let t=parseFloat(this.AddInvoiceForm.get("INVTotalValue")?.value),n=parseFloat(this.AddInvoiceForm.get("INVTaxValue")?.value)+t;this.AddInvoiceForm.patchValue({INVNetValue:n})}SearchByBarcode(t,i){let n=t.target.value;this.productFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty+"&ejar=F&itemtype=P&barcode="+n,null!=n&&""!=n&&this.ProductService.getProductsPerSpec(this.productFilterString).subscribe(a=>{0!=a.length?(this.myForm.get("items").at(i).patchValue({INVDPrice:parseFloat(a[0].ITMPrice),line_total:parseFloat(a[0].ITMPrice),ITMKeyField:a[0].id,INVDQty:"1.00"}),this.UpdateINVTotalValue(parseFloat(a[0].ITMPrice),i),this.CalcaluteRowNetValue(i,parseFloat(a[0].ITMPrice)),this.addItem(i+1),this.DeleteWrongMessage(i)):this.AddWrongMessage(i)})}AddWrongMessage(t){var i=document.getElementById(`search${t}`),n=document.createElement("small");n.className="text-danger my-2",n.id="small",i?.appendChild(n),n.innerText="\u0644\u0627 \u064a\u0648\u062c\u062f \u0635\u0646\u0641 \u0628\u0647\u0630\u0627 \u0627\u0644\u0631\u0642\u0645"}DeleteWrongMessage(t){var i=document.getElementById(`search${t}`),n=document.getElementById("small");null!=n&&i?.removeChild(n)}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(t=>{this.deletedTitleMsg=t})}UpdateInvoice(){this.invoiceServices.editInvoice(this.AddInvoiceForm.value,this.id).subscribe(()=>{this.items.length>0?(console.log("update and add rows"),this.updateRows(),this.addRows(),this.router.navigate(["/invoice/expensesinv-list"])):this.items.length>0&&(console.log("update only"),this.updateRows(),this.router.navigate(["/invoice/expensesinv-list"]))})}updateRows(){}addRows(){}}function Ct(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"input",6),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.barcode=a)})("blur",function(){const r=e.CHM(i).$implicit,l=e.oxw();return e.KtG(l.onBarcodeChange(r,r.barcode))}),e.qZA()(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td")(6,"input",7),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.qty=a)})("change",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.calculateTotals())}),e.qZA()(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"currency"),e.qZA(),e.TgZ(10,"td")(11,"input",7),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.discount=a)})("change",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.calculateTotals())}),e.qZA()(),e.TgZ(12,"td")(13,"input",7),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.tax=a)})("change",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.calculateTotals())}),e.qZA()(),e.TgZ(14,"td"),e._uU(15),e.ALo(16,"currency"),e.qZA()()}if(2&o){const i=t.$implicit;e.xp6(2),e.Q6J("ngModel",i.barcode),e.xp6(2),e.Oqu(i.description),e.xp6(2),e.Q6J("ngModel",i.qty),e.xp6(2),e.Oqu(e.lcZ(9,7,i.price)),e.xp6(3),e.Q6J("ngModel",i.discount),e.xp6(2),e.Q6J("ngModel",i.tax),e.xp6(2),e.Oqu(e.lcZ(16,9,i.total))}}K.\u0275fac=function(t){return new(t||K)(e.Y36(c.qu),e.Y36(ht.s),e.Y36(Z.q),e.Y36(U.U),e.Y36(Q.C),e.Y36(x.sK),e.Y36(M.ux),e.Y36(b.gz),e.Y36(ce.d),e.Y36(se.Z),e.Y36(le.X),e.Y36(ue.W),e.Y36(de.v),e.Y36(b.F0))},K.\u0275cmp=e.Xpm({type:K,selectors:[["app-expenses-inv-details"]],decls:171,vars:105,consts:[[1,"p-2"],[1,"pt-3"],["autocomplete","off","fxLayout","row wrap",3,"formGroup"],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["fxFlex","100","fxFlex.gt-sm","34.95",1,"px-1"],["appearance","outline",1,"w-100"],["formControlName","BRAKeyField","id","branchaOpSel",3,"placeholder","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-sm","14.95",1,"px-1"],["matInput","","formControlName","INVNumber"],["matInput","","formControlName","INVSerial"],["matInput","","formControlName","INVDate",3,"matDatepicker","dateChange"],["matSuffix","",3,"for"],["invDate",""],["fxFlex","100","fxFlex.gt-sm","10",1,"px-1"],["matInput","","formControlName","INVYear"],["matInput","","formControlName","INVMonth"],["fxFlex","100","fxFlex.gt-sm","29.95",1,"px-1"],["formControlName","build_KeyField",3,"placeholder","selectionChange"],["formControlName","unit_KeyField","id","unitOneOpSel",3,"placeholder","selectionChange"],["fxFlex","100","fxFlex.gt-sm","19.95",1,"px-1"],["formControlName","owner_KeyField","id","oneOwnerOpSel",3,"placeholder"],["fxFlex","100","fxFlex.gt-sm","10.0",1,"px-1"],["matInput","",3,"keyup.enter"],["tenCode",""],["fxFlex","100","fxFlex.gt-sm","24.95",1,"px-1"],["appearance","outline","formControlName","CUSKeyField","id","oneCustomOpSel",1,"w-100",3,"placeholder","change"],["fxFlex","100","fxFlex.gt-sm","27.0",1,"px-1"],["matInput","","formControlName","INVTotalValue",3,"change"],["fxFlex","100","fxFlex.gt-sm","20.0",1,"px-1"],["matInput","","formControlName","INVTax"],["fxFlex","100","fxFlex.gt-sm","25.0",1,"px-1"],["matInput","","formControlName","INVTaxValue"],["matInput","","formControlName","INVNetValue"],[1,"items2"],[1,"header"],[1,"search"],[1,"product"],[1,"qty"],[1,"price"],[1,"linetotal"],[1,"tax"],[1,"net"],[1,"action"],[3,"formGroup"],["formArrayName","items"],[1,"body",2,"min-height","20px","max-height","160px"],["class","item",3,"formGroupName",4,"ngFor","ngForOf"],["mat-mini-fab","","color","primary",3,"matTooltip","click"],[1,"d-flex","justify-content-start","mt-4"],["mat-mini-fab","","color","warn",3,"routerLink","matTooltip"],[1,"item",3,"formGroupName"],[1,"search",3,"id"],["type","text","appAppFocus","","formControlName","ITMBarcode",1,"column",3,"placeholder","change"],["id","exampleFormControlSelect1","name","id","formControlName","ITMKeyField",3,"change"],["type","text","formControlName","INVDQty",3,"placeholder","change"],["type","text","formControlName","INVDPrice",3,"placeholder"],["type","text","formControlName","line_total",3,"placeholder"],["type","text","formControlName","INVDTax",3,"placeholder"],["type","text","formControlName","RowNetValue",3,"placeholder"],["color","primary",3,"matTooltip","click"],[1,"icon-display"]],template:function(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"h1"),e._uU(5),e.ALo(6,"translate"),e.qZA()()(),e.TgZ(7,"mat-card-content",1)(8,"form",2)(9,"div",3)(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"mat-select",6),e.NdJ("selectionChange",function(r){return i.getBuildings(r)}),e.ALo(16,"translate"),e.TgZ(17,"mat-option",7),e._uU(18,"-"),e.qZA(),e.YNc(19,mt,2,2,"mat-option",8),e.qZA()()(),e.TgZ(20,"div",9)(21,"mat-form-field",5)(22,"mat-label"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e._UZ(25,"input",10),e.qZA()(),e.TgZ(26,"div",9)(27,"mat-form-field",5)(28,"mat-label"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e._UZ(31,"input",11),e.qZA()(),e.TgZ(32,"div",9)(33,"mat-form-field",5)(34,"mat-label"),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"input",12),e.NdJ("dateChange",function(r){return i.onChangeDate(r)}),e.qZA(),e._UZ(38,"mat-datepicker-toggle",13)(39,"mat-datepicker",null,14),e.qZA()(),e.TgZ(41,"div",15)(42,"mat-form-field",5)(43,"mat-label"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e._UZ(46,"input",16),e.qZA()(),e.TgZ(47,"div",15)(48,"mat-form-field",5)(49,"mat-label"),e._uU(50),e.ALo(51,"translate"),e.qZA(),e._UZ(52,"input",17),e.qZA()()(),e.TgZ(53,"div",3)(54,"div",18)(55,"mat-form-field",5)(56,"mat-label"),e._uU(57),e.ALo(58,"translate"),e.qZA(),e.TgZ(59,"mat-select",19),e.NdJ("selectionChange",function(r){return i.readBuilding(r)}),e.ALo(60,"translate"),e.TgZ(61,"mat-option",7),e._uU(62,"-"),e.qZA(),e.YNc(63,pt,2,2,"mat-option",8),e.qZA()()(),e.TgZ(64,"div",9)(65,"mat-form-field",5)(66,"mat-label"),e._uU(67),e.ALo(68,"translate"),e.qZA(),e.TgZ(69,"mat-select",20),e.NdJ("selectionChange",function(r){return i.readUnit(r)}),e.ALo(70,"translate"),e.TgZ(71,"mat-option",7),e._uU(72,"-"),e.qZA(),e.YNc(73,gt,2,2,"mat-option",8),e.qZA()()(),e.TgZ(74,"div",21)(75,"mat-form-field",5)(76,"mat-label"),e._uU(77),e.ALo(78,"translate"),e.qZA(),e.TgZ(79,"mat-select",22),e.ALo(80,"translate"),e.TgZ(81,"mat-option",7),e._uU(82,"-"),e.qZA(),e.YNc(83,vt,2,2,"mat-option",8),e.qZA()()(),e.TgZ(84,"div",23)(85,"mat-form-field",5)(86,"mat-label"),e._uU(87),e.ALo(88,"translate"),e.qZA(),e.TgZ(89,"input",24,25),e.NdJ("keyup.enter",function(){e.CHM(n);const r=e.MAs(90);return e.KtG(i.searchByCode(r.value))}),e.qZA()()(),e.TgZ(91,"div",26)(92,"ng-select",27),e.NdJ("change",function(r){return i.readCustumer(r)}),e.ALo(93,"translate"),e.YNc(94,_t,2,2,"ng-option",8),e.qZA()()(),e.TgZ(95,"div",3)(96,"div",28)(97,"mat-form-field",5)(98,"mat-label"),e._uU(99),e.ALo(100,"translate"),e.qZA(),e.TgZ(101,"input",29),e.NdJ("change",function(r){return i.onChangeTotal(r)}),e.qZA()()(),e.TgZ(102,"div",30)(103,"mat-form-field",5)(104,"mat-label"),e._uU(105),e.ALo(106,"translate"),e.qZA(),e._UZ(107,"input",31),e.qZA()(),e.TgZ(108,"div",32)(109,"mat-form-field",5)(110,"mat-label"),e._uU(111),e.ALo(112,"translate"),e.qZA(),e._UZ(113,"input",33),e.qZA()(),e.TgZ(114,"div",28)(115,"mat-form-field",5)(116,"mat-label"),e._uU(117),e.ALo(118,"translate"),e.qZA(),e._UZ(119,"input",34),e.qZA()()(),e.TgZ(120,"div",35)(121,"div",36)(122,"div",37)(123,"h6"),e._uU(124),e.ALo(125,"translate"),e.qZA()(),e.TgZ(126,"div",38)(127,"h6"),e._uU(128),e.ALo(129,"translate"),e.qZA()(),e.TgZ(130,"div",39)(131,"h6"),e._uU(132),e.ALo(133,"translate"),e.qZA()(),e.TgZ(134,"div",40)(135,"h6"),e._uU(136),e.ALo(137,"translate"),e.qZA()(),e.TgZ(138,"div",41)(139,"h6"),e._uU(140),e.ALo(141,"translate"),e.qZA()(),e.TgZ(142,"div",42)(143,"h6"),e._uU(144),e.ALo(145,"translate"),e.qZA()(),e.TgZ(146,"div",43)(147,"h6"),e._uU(148),e.ALo(149,"translate"),e.qZA()(),e.TgZ(150,"div",44)(151,"h6"),e._uU(152),e.ALo(153,"translate"),e.qZA()()(),e.TgZ(154,"form",45),e.ynx(155,46),e.TgZ(156,"div",47),e.YNc(157,It,27,24,"div",48),e.qZA(),e.BQk(),e.TgZ(158,"button",49),e.NdJ("click",function(){return i.addItem(0)}),e.ALo(159,"translate"),e.TgZ(160,"mat-icon"),e._uU(161,"add"),e.qZA()()(),e.TgZ(162,"div",50)(163,"button",49),e.NdJ("click",function(){return i.SaveData(i.Invoice.id)}),e.ALo(164,"translate"),e.TgZ(165,"mat-icon"),e._uU(166,"save"),e.qZA()(),e.TgZ(167,"a",51),e.ALo(168,"translate"),e.TgZ(169,"mat-icon"),e._uU(170,"cancel"),e.qZA()()()()()()()()}if(2&t){const n=e.MAs(40);e.xp6(5),e.Oqu(e.lcZ(6,42,"HTML.ExpensesInvoice")),e.xp6(3),e.Q6J("formGroup",i.AddInvoiceForm),e.xp6(5),e.hij(" ",e.lcZ(14,44,"HTML.BRANCH"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(16,46,"HTML.BRANCH")),e.xp6(4),e.Q6J("ngForOf",i.AllBranches),e.xp6(4),e.hij(" ",e.lcZ(24,48,"HTML.DOC_NUMBER"),""),e.xp6(6),e.hij(" ",e.lcZ(30,50,"HTML.Serial"),""),e.xp6(6),e.Oqu(e.lcZ(36,52,"HTML.InvoiceDate")),e.xp6(2),e.Q6J("matDatepicker",n),e.xp6(1),e.Q6J("for",n),e.xp6(6),e.hij(" ",e.lcZ(45,54,"OPTIONS.Year"),""),e.xp6(6),e.hij(" ",e.lcZ(51,56,"OPTIONS.Month"),""),e.xp6(7),e.hij(" ",e.lcZ(58,58,"HTML.BUILDING"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(60,60,"HTML.BUILDING")),e.xp6(4),e.Q6J("ngForOf",i.AllBuilding),e.xp6(4),e.hij(" ",e.lcZ(68,62,"HTML.UNIT"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(70,64,"HTML.UNIT")),e.xp6(4),e.Q6J("ngForOf",i.AllUnitsForBuilding),e.xp6(4),e.hij(" ",e.lcZ(78,66,"HTML.OWNER"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(80,68,"HTML.OWNER")),e.xp6(4),e.Q6J("ngForOf",i.AllOwners),e.xp6(4),e.Oqu(e.lcZ(88,70,"HTML.CODE_TENANT")),e.xp6(5),e.s9C("placeholder",e.lcZ(93,72,"HTML.TENANT")),e.xp6(2),e.Q6J("ngForOf",i.AllTenants),e.xp6(5),e.hij(" ",e.lcZ(100,74,"HTML.TotalValueWithoutTax"),""),e.xp6(6),e.hij(" ",e.lcZ(106,76,"HTML.TaxPercent"),""),e.xp6(6),e.hij(" ",e.lcZ(112,78,"HTML.TaxValue"),""),e.xp6(6),e.hij(" ",e.lcZ(118,80,"HTML.NetValueWithTax"),""),e.xp6(7),e.Oqu(e.lcZ(125,82,"HTML.Barcode")),e.xp6(4),e.Oqu(e.lcZ(129,84,"HTML.ProductName")),e.xp6(4),e.Oqu(e.lcZ(133,86,"HTML.QTY")),e.xp6(4),e.Oqu(e.lcZ(137,88,"HTML.Price")),e.xp6(4),e.Oqu(e.lcZ(141,90,"HTML.TotalValueWithoutTax")),e.xp6(4),e.Oqu(e.lcZ(145,92,"HTML.TaxValue")),e.xp6(4),e.Oqu(e.lcZ(149,94,"HTML.NetValue")),e.xp6(4),e.Oqu(e.lcZ(153,96,"")),e.xp6(2),e.Q6J("formGroup",i.myForm),e.xp6(3),e.Q6J("ngForOf",i.items.controls),e.xp6(1),e.s9C("matTooltip",e.lcZ(159,98,"BTN.ADD")),e.xp6(5),e.s9C("matTooltip",e.lcZ(164,100,"BTN.SAVE")),e.xp6(4),e.s9C("matTooltip",e.lcZ(168,102,"BTN.CANCEL")),e.Q6J("routerLink",e.DdM(104,Tt))}},dependencies:[p.sg,b.rH,c._Y,c.YN,c.Kr,c.Fj,c.EJ,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,I.xw,I.Wh,I.yH,z.ey,y.Tq,y.nh,P.a8,P.dn,P.dk,P.n5,A.Mq,A.hl,A.nW,q.Hw,S.Nt,T.KE,T.hX,T.R9,ee.gD,ie.gM,D.w9,D.jq,x.X$],styles:[".items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:#00f;color:#fff;padding:5px;display:flex;border-radius:5px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:60px;text-align:center;padding-left:20px;font-weight:500;font-size:20px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .product[_ngcontent-%COMP%]{width:120px;text-align:center;padding-right:50px;padding-left:20px;font-weight:500;font-size:20px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{width:40px;text-align:center;padding-right:50px;padding-left:20px;font-weight:500;font-size:20px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{width:50px;text-align:center;padding-right:50px;padding-left:20px;font-weight:500;font-size:20px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .linetotal[_ngcontent-%COMP%]{width:60px;text-align:center;padding-right:50px;padding-left:20px;font-weight:500;font-size:20px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .tax[_ngcontent-%COMP%]{width:40px;text-align:center;padding-right:50px;padding-left:20px;font-weight:500;font-size:20px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .net[_ngcontent-%COMP%]{width:80px;text-align:center;padding-right:50px;padding-left:20px;font-weight:500;font-size:20px}.items2[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{width:60px;text-align:center;padding-right:50px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow-y:scroll;overflow-x:hidden;margin-bottom:10px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:60px;text-align:center;padding-left:20px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .product[_ngcontent-%COMP%]{width:120px;text-align:center;padding-right:50px;padding-left:20px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{width:40px;text-align:center;padding-right:50px;padding-left:20px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{width:50px;text-align:center;padding-right:50px;padding-left:20px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .linetotal[_ngcontent-%COMP%]{width:60px;text-align:center;padding-right:50px;padding-left:20px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .tax[_ngcontent-%COMP%]{width:40px;text-align:center;padding-right:50px;padding-left:20px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .net[_ngcontent-%COMP%]{width:80px;text-align:center;padding-right:50px;padding-left:20px}.items2[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .icon-display[_ngcontent-%COMP%]{transform:scale(1)}.items2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .items2[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:194px;padding:5px;border:2px solid #ddd;border-radius:5px}.btn[_ngcontent-%COMP%]{border-radius:5px;outline:none;border:none;margin-bottom:5px}.btn-del[_ngcontent-%COMP%]{background-color:red;color:#fff;margin-right:5px}.btn-add[_ngcontent-%COMP%]{background-color:#00f;color:#fff}.user-name[_ngcontent-%COMP%]{padding:0 12px;font-weight:400}.user-content[_ngcontent-%COMP%]{padding:10px}.user-content[_ngcontent-%COMP%]   .user-img[_ngcontent-%COMP%]{position:relative}.user-content[_ngcontent-%COMP%]   .user-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;width:80px;height:80px}.user-content[_ngcontent-%COMP%]   .user-img[_ngcontent-%COMP%]   img.blocked[_ngcontent-%COMP%]{opacity:.5}.user-content[_ngcontent-%COMP%]   .user-img[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{position:absolute;top:-8px;left:-8px;font-size:96px;height:96px;width:96px}.user-content[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-top:15px}.user-content[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-content[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{padding:2px 10px}.user-content[_ngcontent-%COMP%]   .user-details.blocked[_ngcontent-%COMP%]{opacity:.5}.user-search[_ngcontent-%COMP%]{width:0;overflow:hidden;transition:.3s}.user-search[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%!important;text-align:center!important}.user-search[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{min-height:36px;padding:8px 0!important}.user-search[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.user-search[_ngcontent-%COMP%]   .mat-mdc-input-element[_ngcontent-%COMP%]{text-align:center}.user-search.show[_ngcontent-%COMP%]{width:100%;overflow:visible}.user-spinner[_ngcontent-%COMP%]{position:absolute;inset:0}.mat-mdc-card[_ngcontent-%COMP%]{overflow:hidden}table[_ngcontent-%COMP%]{width:100%}.make-gold[_ngcontent-%COMP%]{background-color:#fbea96}.make-yellow[_ngcontent-%COMP%]{background-color:#ff4500}.make-yellowgreen[_ngcontent-%COMP%]{background-color:#ad7020}.make-white[_ngcontent-%COMP%]{background-color:#fff}.demo-table[_ngcontent-%COMP%]{width:100%}.mat-mdc-row[_ngcontent-%COMP%]:hover   .mat-mdc-cell[_ngcontent-%COMP%]{border-color:currentColor}.row-is-clicked[_ngcontent-%COMP%]{font-weight:700}.mat-column-action[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:unset!important;flex:0 0 18%!important;width:18%!important;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;-webkit-hyphens:auto;hyphens:auto}.mat-column-total[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:unset!important;flex:0 0 7%!important;width:7%!important;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;-webkit-hyphens:auto;hyphens:auto}.mat-column-ownerName[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:unset!important;flex:0 0 15%!important;width:15%!important;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;-webkit-hyphens:auto;hyphens:auto}.mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:-.75rem}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{padding-bottom:0}.mat-tab-body-content[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:.25rem}"]});class E{constructor(t,i){this.http=t,this.globalServ=i,this.companyInfo={name:"My Company",logo:"assets/logo.png",contact:"info@mycompany.com | +123456789"},this.invoiceNumber="INV-001",this.billTo={name:"AlSayed AbdElAzim",address:"Alexandria Miami"},this.rows=[],this.subtotal=0,this.vat=0,this.total=0}addRow(){this.rows.push({barcode:"",description:"",qty:1,price:0,discount:0,tax:0,total:0})}onBarcodeChange(t,i){this.http.get(`https://jeddahlake.com/realestate/api/v1/sell/item/${i}/`,this.globalServ.getAuthHeaders()).subscribe(n=>{t.description=n.ITMAraName,t.qty=n.ITMStandardSalesQty,t.price=n.ITMPrice,t.total=t.qty*t.price,this.calculateTotals()})}calculateTotals(){this.subtotal=this.rows.reduce((t,i)=>t+i.total,0),this.vat=.15*this.subtotal,this.total=this.subtotal+this.vat}saveInvoice(){const t={INVNumber:this.invoiceNumber,INVTotalValue:this.total,invoice_forinvdt:this.rows.map(i=>({INVDQty:i.qty,INVDPrice:i.price,INVDDiscount:i.discount,INVDTax:i.tax}))};this.http.post("https://jeddahlake.com/realestate/api/v1/sell/newinvoice/create/",t,this.globalServ.getAuthHeaders()).subscribe(i=>{console.log("Invoice saved:",i)})}}E.\u0275fac=function(t){return new(t||E)(e.Y36(oe.eN),e.Y36(U.U))},E.\u0275cmp=e.Xpm({type:E,selectors:[["app-invoice-master"]],decls:47,vars:15,consts:[[1,"invoice"],["alt","Logo","width","100",3,"src"],["placeholder","Customer Name",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["placeholder","Scan Barcode",3,"ngModel","ngModelChange","blur"],["type","number",3,"ngModel","ngModelChange","change"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"header"),e._UZ(2,"img",1),e.TgZ(3,"h1"),e._uU(4),e.qZA(),e.TgZ(5,"p"),e._uU(6),e.qZA()(),e.TgZ(7,"section")(8,"div")(9,"h3"),e._uU(10),e.qZA(),e.TgZ(11,"label"),e._uU(12,"Bill To: "),e.TgZ(13,"input",2),e.NdJ("ngModelChange",function(a){return i.billTo.name=a}),e.qZA()()()(),e.TgZ(14,"table")(15,"thead")(16,"tr")(17,"th"),e._uU(18,"Barcode"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Description"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Qty"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Price"),e.qZA(),e.TgZ(25,"th"),e._uU(26,"Discount"),e.qZA(),e.TgZ(27,"th"),e._uU(28,"Tax"),e.qZA(),e.TgZ(29,"th"),e._uU(30,"Total"),e.qZA()()(),e.TgZ(31,"tbody"),e.YNc(32,Ct,17,11,"tr",3),e.qZA()(),e.TgZ(33,"button",4),e.NdJ("click",function(){return i.addRow()}),e._uU(34,"Add Line"),e.qZA(),e._UZ(35,"hr"),e.TgZ(36,"p"),e._uU(37),e.ALo(38,"currency"),e.qZA(),e.TgZ(39,"p"),e._uU(40),e.ALo(41,"currency"),e.qZA(),e.TgZ(42,"h2"),e._uU(43),e.ALo(44,"currency"),e.qZA(),e.TgZ(45,"button",5),e.NdJ("click",function(){return i.saveInvoice()}),e._uU(46,"Save Invoice"),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("src",i.companyInfo.logo,e.LSH),e.xp6(2),e.Oqu(i.companyInfo.name),e.xp6(2),e.Oqu(i.companyInfo.contact),e.xp6(4),e.hij("Invoice #: ",i.invoiceNumber,""),e.xp6(3),e.Q6J("ngModel",i.billTo.name),e.xp6(19),e.Q6J("ngForOf",i.rows),e.xp6(5),e.hij("Subtotal: ",e.lcZ(38,9,i.subtotal),""),e.xp6(3),e.hij("VAT (15%): ",e.lcZ(41,11,i.vat),""),e.xp6(3),e.hij("Total: ",e.lcZ(44,13,i.total),""))},dependencies:[p.sg,c.Fj,c.wV,c.JJ,c.On,y.lW,p.H9],styles:["h1[_ngcontent-%COMP%]{margin-bottom:20px}mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.invoice[_ngcontent-%COMP%]{margin:20px;font-family:Arial,sans-serif}header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;text-align:center}thead[_ngcontent-%COMP%]{background-color:#f9f9f9}"]});class ${constructor(t,i){this.dialog=t,this.appSettings=i,this.tenants=[],this.settings=this.appSettings.settings}}$.\u0275fac=function(t){return new(t||$)(e.Y36(v.uw),e.Y36(te.d))},$.\u0275cmp=e.Xpm({type:$,selectors:[["app-invoices-md-list"]],decls:3,vars:0,template:function(t,i){1&t&&(e.TgZ(0,"p"),e._uU(1,"invoices-md-list works!"),e.qZA(),e._uU(2,"\nAlSayed 30-10-2024 "))}});var Nt=u(8675),xt=u(4004);class O{constructor(t){this.http=t,this.apiUrl="api/invoices/"}getInvoice(t){return this.http.get(`${this.apiUrl}${t}/`)}createInvoice(t){return this.http.post(this.apiUrl,t)}updateInvoice(t){return this.http.put(`${this.apiUrl}${t.id}/`,t)}getItems(t=""){return this.http.get(`${this.apiUrl}items/?search=${t}`)}}O.\u0275fac=function(t){return new(t||O)(e.LFG(oe.eN))},O.\u0275prov=e.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"});var _=u(671);function bt(o,t){1&o&&(e.TgZ(0,"th",18),e._uU(1,"Name"),e.qZA())}function yt(o,t){if(1&o&&(e.TgZ(0,"td",19),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.AsE(" ",i.ITMAraName||i.ITMEngName," ",e.lcZ(2,2,i.ITMPrice)," ")}}function At(o,t){1&o&&(e.TgZ(0,"th",18),e._uU(1,"Code"),e.qZA())}function Zt(o,t){if(1&o&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.hij("Code: ",i.ITMCode,"")}}function Vt(o,t){1&o&&(e.TgZ(0,"th",18),e._uU(1,"Barcode"),e.qZA())}function wt(o,t){if(1&o&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.hij("Barcode: ",i.ITMBarcode,"")}}function St(o,t){1&o&&(e.TgZ(0,"th",18),e._uU(1,"Actions"),e.qZA())}function Ft(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"td",19)(1,"button",20),e.NdJ("click",function(){const r=e.CHM(i).$implicit,l=e.oxw();return e.KtG(l.selectItem(r))}),e._uU(2," Select "),e.qZA()()}}function Mt(o,t){1&o&&e._UZ(0,"tr",21)}function Dt(o,t){1&o&&e._UZ(0,"tr",22)}const Ie=function(){return["name","code","barcode","actions"]};class X{constructor(t,i,n){this.dialogRef=t,this.data=i,this.invoiceService=n,this.searchControl=new c.NI,this.items=[]}ngOnInit(){this.loadItems(),this.filteredItems=this.searchControl.valueChanges.pipe((0,Nt.O)(""),(0,xt.U)(t=>this._filterItems(t)))}loadItems(){this.invoiceService.getItems().subscribe(t=>{this.items=t},t=>{})}_filterItems(t){const i=t.toLowerCase();return this.items.filter(n=>n.ITMAraName?.toLowerCase().includes(i)||n.ITMEngName?.toLowerCase().includes(i)||n.ITMBarcode?.toLowerCase().includes(i)||n.ITMCode?.toString().includes(i))}selectItem(t){this.selectedItem=t}onSelect(){this.selectedItem&&this.dialogRef.close(this.selectedItem)}onCancel(){this.dialogRef.close()}}function Pt(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Item Code"),e.qZA())}function Ot(o,t){if(1&o&&(e.TgZ(0,"td",53),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.Oqu(i.itemCode)}}function Ut(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Item Name"),e.qZA())}function Lt(o,t){if(1&o&&(e.TgZ(0,"td",53),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.Oqu(i.itemName)}}function qt(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Barcode"),e.qZA())}function Bt(o,t){if(1&o&&(e.TgZ(0,"td",53),e._uU(1),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.Oqu(i.barcode)}}function kt(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Qty"),e.qZA())}X.\u0275fac=function(t){return new(t||X)(e.Y36(v.so),e.Y36(v.WI),e.Y36(O))},X.\u0275cmp=e.Xpm({type:X,selectors:[["app-item-selector"]],decls:31,vars:9,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",1,"full-width"],["matInput","","placeholder","Search by name, code, or barcode...",3,"formControl"],["matSuffix",""],[1,"items-list"],["mat-table","",1,"mat-elevation-z2",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","barcode"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],["mat-header-cell",""],["mat-cell",""],["mat-raised-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,i){1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Select Item"),e.qZA(),e.TgZ(2,"div",1)(3,"mat-form-field",2)(4,"mat-label"),e._uU(5,"Search Items"),e.qZA(),e._UZ(6,"input",3),e.TgZ(7,"mat-icon",4),e._uU(8,"search"),e.qZA()(),e.TgZ(9,"div",5)(10,"table",6),e.ALo(11,"async"),e.ynx(12,7),e.YNc(13,bt,2,0,"th",8),e.YNc(14,yt,3,4,"td",9),e.BQk(),e.ynx(15,10),e.YNc(16,At,2,0,"th",8),e.YNc(17,Zt,2,1,"td",9),e.BQk(),e.ynx(18,11),e.YNc(19,Vt,2,0,"th",8),e.YNc(20,wt,2,1,"td",9),e.BQk(),e.ynx(21,12),e.YNc(22,St,2,0,"th",8),e.YNc(23,Ft,3,0,"td",9),e.BQk(),e.YNc(24,Mt,1,0,"tr",13),e.YNc(25,Dt,1,0,"tr",14),e.qZA()()(),e.TgZ(26,"div",15)(27,"button",16),e.NdJ("click",function(){return i.onCancel()}),e._uU(28,"Cancel"),e.qZA(),e.TgZ(29,"button",17),e.NdJ("click",function(){return i.onSelect()}),e._uU(30," Select Item "),e.qZA()()),2&t&&(e.xp6(6),e.Q6J("formControl",i.searchControl),e.xp6(4),e.Q6J("dataSource",e.lcZ(11,5,i.filteredItems)),e.xp6(14),e.Q6J("matHeaderRowDef",e.DdM(7,Ie)),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(8,Ie)),e.xp6(4),e.Q6J("disabled",!i.selectedItem))},dependencies:[c.Fj,c.JJ,c.oH,y.lW,v.uh,v.xY,v.H8,q.Hw,S.Nt,T.KE,T.hX,T.R9,_.BZ,_.fO,_.as,_.w1,_.Dz,_.nj,_.ge,_.ev,_.XQ,_.Gk,p.Ov,p.H9],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.items-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.items-list[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.items-list[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:500}.items-list[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 16px}"]});const ne=function(){return{standalone:!0}};function Rt(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"td",53)(1,"input",54),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.INVDQty=a)})("change",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.calculateTotals())}),e.qZA()()}if(2&o){const i=t.$implicit;e.xp6(1),e.Q6J("ngModel",i.INVDQty)("ngModelOptions",e.DdM(2,ne))}}function Kt(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Price"),e.qZA())}function Et(o,t){if(1&o&&(e.TgZ(0,"td",53),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,i.INVDPrice))}}function Yt(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Discount"),e.qZA())}function Jt(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"td",53)(1,"input",55),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.INVDDiscount=a)})("change",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.calculateTotals())}),e.qZA(),e.TgZ(2,"select",56),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.INVDDiscountType=a)})("change",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.calculateTotals())}),e.TgZ(3,"option",47),e._uU(4,"Fixed"),e.qZA(),e.TgZ(5,"option",19),e._uU(6,"%"),e.qZA()()()}if(2&o){const i=t.$implicit;e.xp6(1),e.Q6J("ngModel",i.INVDDiscount)("ngModelOptions",e.DdM(4,ne)),e.xp6(1),e.Q6J("ngModel",i.INVDDiscountType)("ngModelOptions",e.DdM(5,ne))}}function Ht(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Tax %"),e.qZA())}function Qt(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"td",53)(1,"input",55),e.NdJ("ngModelChange",function(a){const l=e.CHM(i).$implicit;return e.KtG(l.INVDTax=a)})("change",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.calculateTotals())}),e.qZA()()}if(2&o){const i=t.$implicit;e.xp6(1),e.Q6J("ngModel",i.INVDTax)("ngModelOptions",e.DdM(2,ne))}}function jt(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Line Total"),e.qZA())}function Gt(o,t){if(1&o&&(e.TgZ(0,"td",53),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const i=t.$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,i.lineTotal))}}function Wt(o,t){1&o&&(e.TgZ(0,"th",52),e._uU(1,"Actions"),e.qZA())}function $t(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"td",53)(1,"button",57),e.NdJ("click",function(){const r=e.CHM(i).index,l=e.oxw();return e.KtG(l.openItemSelection(r))}),e.TgZ(2,"mat-icon"),e._uU(3,"search"),e.qZA()(),e.TgZ(4,"button",58),e.NdJ("click",function(){const r=e.CHM(i).index,l=e.oxw();return e.KtG(l.removeItem(r))}),e.TgZ(5,"mat-icon"),e._uU(6,"delete"),e.qZA()()()}}function Xt(o,t){1&o&&e._UZ(0,"tr",59)}function zt(o,t){1&o&&e._UZ(0,"tr",60)}class Y{constructor(t,i,n,a,r,l,h,g){this.fb=t,this.invoiceService=i,this.dialog=n,this.global=a,this.localStore=r,this.translateService=l,this.snackBar=h,this.activatedRoute=g,this.invoice={INVCode:0,INVNumber:"",INVDate:new Date,INVDueDate:new Date,CUSKeyField:null,customerName:"",INVTotalValue:0,INVShippingValue:0,INVDiscount:0,INVDIscountType:"F",INVTax:15,INVTaxValue:0,INVNetValue:0,INVStatus:"D",INVDescription:"",details:[],COMId:null,BRAKeyField:null,branch_ArbName:"",build_KeyField:null,unit_KeyField:null,owner_KeyField:null,INVType_CTTKeyField:null,contract_KeyField:null,user_KeyField:null,INVYear:null,INVMonth:null,INVSerial:null,INVFromDate:null,INVToDate:null,INVPayedValue:0,INVExpenses:0,INVCost:0,INVDateString:"",RowConfirm:0,RowDelete:0,RowStatus:0,RCOTenantLeaveID:null,last_updated:""},this.displayedColumns=["itemCode","itemName","barcode","qty","price","discount","tax","lineTotal","actions"],this.dataSource=[],this.account=new H.n,this.createForm()}ngOnInit(){this.generateInvoiceNumber()}createForm(){this.invoiceForm=this.fb.group({INVNumber:[{value:"",disabled:!0},c.kI.required],INVDate:[new Date,c.kI.required],INVDueDate:["",c.kI.required],customerName:["",c.kI.required],INVStatus:["N"],INVDescription:[""],INVDiscount:[0],INVDIscountType:null,INVTax:[0],INVTotalValue:[{value:0,disabled:!0}],INVTaxValue:[{value:0,disabled:!0}],INVNetValue:[{value:0,disabled:!0}]})}generateInvoiceNumber(){const t=new Date,i=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),r=Math.floor(1e4*Math.random());this.invoice.INVNumber=`INV-${i}${n}${a}-${r}`,this.invoiceForm.patchValue({INVNumber:this.invoice.INVNumber})}addNewItem(){this.dataSource=[...this.dataSource,{INVKeyField:0,ITMKeyField:0,itemCode:"",itemName:"",barcode:"",INVDQty:1,INVDPrice:0,INVDDiscount:0,INVDDiscountType:"F",INVDTax:0,INVDTaxValue:0,lineTotal:0}],this.table.renderRows()}removeItem(t){this.dataSource.splice(t,1),this.dataSource=[...this.dataSource],this.calculateTotals()}openItemSelection(t){this.dialog.open(X,{width:"800px",data:{currentItem:this.dataSource[t]}}).afterClosed().subscribe(n=>{n&&(this.dataSource[t]={...this.dataSource[t],ITMKeyField:n.id,itemCode:n.ITMCode,itemName:n.ITMAraName||n.ITMEngName,barcode:n.ITMBarcode,INVDPrice:n.ITMPrice,INVDQty:1,lineTotal:n.ITMPrice},this.dataSource=[...this.dataSource],this.calculateTotals())})}calculateLineTotal(t){let i=t.INVDPrice,n=t.INVDDiscount;"P"===t.INVDDiscountType&&(n=i*(n/100));const a=(i-n)*t.INVDQty,r=a*(t.INVDTax/100);return t.INVDTaxValue=r,t.lineTotal=a+r,t.lineTotal}calculateTotals(){let t=0,i=0,n=0;this.dataSource.forEach(s=>{this.calculateLineTotal(s),t+=s.INVDPrice*s.INVDQty,i+=s.INVDTaxValue,n+="P"===s.INVDDiscountType?s.INVDPrice*s.INVDQty*(s.INVDDiscount/100):s.INVDDiscount*s.INVDQty});const a=this.invoiceForm.get("INVDiscount").value;let r=0;r="P"===this.invoiceForm.get("INVDIscountType").value?t*(a/100):a;const h=this.invoiceForm.get("INVTax").value/100*(t-n-r);this.invoiceForm.patchValue({INVTotalValue:t,INVTaxValue:h,INVNetValue:t-n-r+i+h})}saveInvoice(){if(this.invoiceForm.invalid)return;const t=this.invoiceForm.getRawValue();this.invoice={...this.invoice,...t,details:this.dataSource},this.invoice.id?this.invoiceService.updateInvoice(this.invoice).subscribe(i=>{},i=>{}):this.invoiceService.createInvoice(this.invoice).subscribe(i=>{},i=>{})}}Y.\u0275fac=function(t){return new(t||Y)(e.Y36(c.qu),e.Y36(O),e.Y36(v.uw),e.Y36(U.U),e.Y36(Q.C),e.Y36(x.sK),e.Y36(M.ux),e.Y36(b.gz))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["app-invoice-pos"]],viewQuery:function(t,i){if(1&t&&e.Gf(_.BZ,5),2&t){let n;e.iGM(n=e.CRH())&&(i.table=n.first)}},decls:130,vars:18,consts:[[1,"invoice-container"],[3,"formGroup","ngSubmit"],[1,"invoice-header"],[1,"invoice-number"],["appearance","outline"],["matInput","","formControlName","INVNumber","readonly",""],[1,"invoice-details-section"],[1,"invoice-dates"],["matInput","","formControlName","INVDate",3,"matDatepicker"],["matSuffix","",3,"for"],["invoiceDatePicker",""],["matInput","","formControlName","INVDueDate",3,"matDatepicker"],["dueDatePicker",""],[1,"customer-section"],["appearance","outline",1,"customer-name"],["matInput","","formControlName","customerName",1,"compact-input"],["appearance","outline",1,"status-field"],["formControlName","INVStatus"],["value","D"],["value","P"],["value","U"],[1,"notes-section"],["appearance","outline",1,"full-width"],["matInput","","formControlName","INVDescription"],[1,"invoice-items-section"],[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","itemCode"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","itemName"],["matColumnDef","barcode"],["matColumnDef","qty"],["matColumnDef","price"],["matColumnDef","discount"],["matColumnDef","tax"],["matColumnDef","lineTotal"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"add-item-button"],["mat-raised-button","","color","primary",3,"click"],[1,"invoice-summary-section"],[1,"summary-grid"],[1,"summary-row"],["type","number","formControlName","INVDiscount","min","0","step","0.01",3,"change"],["formControlName","INVDIscountType",3,"change"],["value","F"],[1,"summary-row","total-row"],[1,"actions-section"],["mat-raised-button","","color","warn"],["mat-raised-button","","color","primary","type","submit"],["mat-header-cell",""],["mat-cell",""],["type","number","min","1","step","1",3,"ngModel","ngModelOptions","ngModelChange","change"],["type","number","min","0","step","0.01",3,"ngModel","ngModelOptions","ngModelChange","change"],[3,"ngModel","ngModelOptions","ngModelChange","change"],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"form",1),e.NdJ("ngSubmit",function(){return i.saveInvoice()}),e.TgZ(2,"div",2)(3,"h1"),e._uU(4,"Create New Invoice"),e.qZA(),e.TgZ(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),e._uU(8,"Invoice Number *"),e.qZA(),e._UZ(9,"input",5),e.qZA()()(),e.TgZ(10,"div",6)(11,"h2"),e._uU(12,"Invoice Details"),e.qZA(),e.TgZ(13,"p"),e._uU(14,"Enter invoice information"),e.qZA(),e.TgZ(15,"div",7)(16,"mat-form-field",4)(17,"mat-label"),e._uU(18,"Invoice Date *"),e.qZA(),e._UZ(19,"input",8)(20,"mat-datepicker-toggle",9)(21,"mat-datepicker",null,10),e.qZA(),e.TgZ(23,"mat-form-field",4)(24,"mat-label"),e._uU(25,"Due Date"),e.qZA(),e._UZ(26,"input",11)(27,"mat-datepicker-toggle",9)(28,"mat-datepicker",null,12),e.qZA()(),e.TgZ(30,"div",13)(31,"mat-form-field",14)(32,"mat-label"),e._uU(33,"Customer Name"),e.qZA(),e._UZ(34,"input",15),e.qZA(),e.TgZ(35,"mat-form-field",16)(36,"mat-label"),e._uU(37,"Status"),e.qZA(),e.TgZ(38,"mat-select",17)(39,"mat-option",18),e._uU(40,"Draft"),e.qZA(),e.TgZ(41,"mat-option",19),e._uU(42,"Paid"),e.qZA(),e.TgZ(43,"mat-option",20),e._uU(44,"Unpaid"),e.qZA()()()(),e.TgZ(45,"div",21)(46,"mat-form-field",22)(47,"mat-label"),e._uU(48,"Notes"),e.qZA(),e._UZ(49,"textarea",23),e.qZA()()(),e.TgZ(50,"div",24)(51,"h2"),e._uU(52,"Invoice Items"),e.qZA(),e.TgZ(53,"p"),e._uU(54,"Add and manage invoice line items"),e.qZA(),e.TgZ(55,"div",25)(56,"table",26),e.ynx(57,27),e.YNc(58,Pt,2,0,"th",28),e.YNc(59,Ot,2,1,"td",29),e.BQk(),e.ynx(60,30),e.YNc(61,Ut,2,0,"th",28),e.YNc(62,Lt,2,1,"td",29),e.BQk(),e.ynx(63,31),e.YNc(64,qt,2,0,"th",28),e.YNc(65,Bt,2,1,"td",29),e.BQk(),e.ynx(66,32),e.YNc(67,kt,2,0,"th",28),e.YNc(68,Rt,2,3,"td",29),e.BQk(),e.ynx(69,33),e.YNc(70,Kt,2,0,"th",28),e.YNc(71,Et,3,3,"td",29),e.BQk(),e.ynx(72,34),e.YNc(73,Yt,2,0,"th",28),e.YNc(74,Jt,7,6,"td",29),e.BQk(),e.ynx(75,35),e.YNc(76,Ht,2,0,"th",28),e.YNc(77,Qt,2,3,"td",29),e.BQk(),e.ynx(78,36),e.YNc(79,jt,2,0,"th",28),e.YNc(80,Gt,3,3,"td",29),e.BQk(),e.ynx(81,37),e.YNc(82,Wt,2,0,"th",28),e.YNc(83,$t,7,0,"td",29),e.BQk(),e.YNc(84,Xt,1,0,"tr",38),e.YNc(85,zt,1,0,"tr",39),e.qZA()(),e.TgZ(86,"div",40)(87,"button",41),e.NdJ("click",function(){return i.addNewItem()}),e.TgZ(88,"mat-icon"),e._uU(89,"add"),e.qZA(),e._uU(90," Add Item "),e.qZA()()(),e.TgZ(91,"div",42)(92,"h2"),e._uU(93,"Invoice Summary"),e.qZA(),e.TgZ(94,"p"),e._uU(95,"Totals and final calculations"),e.qZA(),e.TgZ(96,"div",43)(97,"div",44)(98,"span"),e._uU(99,"Subtotal:"),e.qZA(),e.TgZ(100,"span"),e._uU(101),e.ALo(102,"currency"),e.qZA()(),e.TgZ(103,"div",44)(104,"span"),e._uU(105,"Invoice Discount:"),e.qZA(),e.TgZ(106,"span")(107,"input",45),e.NdJ("change",function(){return i.calculateTotals()}),e.qZA(),e.TgZ(108,"select",46),e.NdJ("change",function(){return i.calculateTotals()}),e.TgZ(109,"option",47),e._uU(110,"Fixed"),e.qZA(),e.TgZ(111,"option",19),e._uU(112,"%"),e.qZA()()()(),e.TgZ(113,"div",44)(114,"span"),e._uU(115),e.qZA(),e.TgZ(116,"span"),e._uU(117),e.ALo(118,"currency"),e.qZA()(),e.TgZ(119,"div",48)(120,"strong"),e._uU(121,"Total Amount:"),e.qZA(),e.TgZ(122,"strong"),e._uU(123),e.ALo(124,"currency"),e.qZA()()()(),e.TgZ(125,"div",49)(126,"button",50),e._uU(127,"Cancel"),e.qZA(),e.TgZ(128,"button",51),e._uU(129,"Save Invoice"),e.qZA()()()()),2&t){const n=e.MAs(22),a=e.MAs(29);e.xp6(1),e.Q6J("formGroup",i.invoiceForm),e.xp6(18),e.Q6J("matDatepicker",n),e.xp6(1),e.Q6J("for",n),e.xp6(6),e.Q6J("matDatepicker",a),e.xp6(1),e.Q6J("for",a),e.xp6(29),e.Q6J("dataSource",i.dataSource),e.xp6(28),e.Q6J("matHeaderRowDef",i.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",i.displayedColumns),e.xp6(16),e.Oqu(e.lcZ(102,12,i.invoiceForm.get("INVTotalValue").value)),e.xp6(14),e.hij("Tax Amount (",i.invoiceForm.get("INVTax").value,"%):"),e.xp6(2),e.Oqu(e.lcZ(118,14,i.invoiceForm.get("INVTaxValue").value)),e.xp6(6),e.Oqu(e.lcZ(124,16,i.invoiceForm.get("INVNetValue").value))}},dependencies:[c._Y,c.YN,c.Kr,c.Fj,c.wV,c.EJ,c.JJ,c.JL,c.qQ,c.On,c.sg,c.u,z.ey,y.lW,y.RK,A.Mq,A.hl,A.nW,q.Hw,S.Nt,T.KE,T.hX,T.R9,ee.gD,_.BZ,_.fO,_.as,_.w1,_.Dz,_.nj,_.ge,_.ev,_.XQ,_.Gk,p.H9],styles:[".invoice-container[_ngcontent-%COMP%]{padding:24px;max-width:1200px;margin:0 auto}.invoice-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.invoice-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500}.invoice-details-section[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]{margin-bottom:32px;padding:16px;border:1px solid #e0e0e0;border-radius:4px}.invoice-details-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;font-size:18px;font-weight:500}.invoice-details-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;color:#757575;font-size:14px}.invoice-details-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%]{padding-bottom:0}.invoice-details-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-infix[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-infix[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-infix[_ngcontent-%COMP%]{padding:.5em 0;border-top:.84375em solid transparent}.invoice-details-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-label-wrapper[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-label-wrapper[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-label-wrapper[_ngcontent-%COMP%]{top:-1.3em}.invoice-details-section[_ngcontent-%COMP%]   .invoice-dates[_ngcontent-%COMP%], .invoice-details-section[_ngcontent-%COMP%]   .customer-section[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%]   .invoice-dates[_ngcontent-%COMP%], .invoice-items-section[_ngcontent-%COMP%]   .customer-section[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]   .invoice-dates[_ngcontent-%COMP%], .invoice-summary-section[_ngcontent-%COMP%]   .customer-section[_ngcontent-%COMP%]{gap:8px;margin-bottom:8px}.status-field[_ngcontent-%COMP%]   .mat-form-field-flex[_ngcontent-%COMP%]{height:40px;align-items:center}.status-field[_ngcontent-%COMP%]   .mat-select-value[_ngcontent-%COMP%]{position:relative;top:-2px}.mat-datepicker-input[_ngcontent-%COMP%]{height:24px}.invoice-dates[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}.customer-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 200px;gap:16px;margin-bottom:16px}.customer-section[_ngcontent-%COMP%]   .customer-name[_ngcontent-%COMP%]{width:100%}.notes-section[_ngcontent-%COMP%]{margin-bottom:16px}.table-container[_ngcontent-%COMP%]{overflow-x:auto;margin-bottom:16px}.table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.table-container[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:500}.table-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:60px;padding:4px;border:1px solid #e0e0e0;border-radius:4px}.table-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:4px;border:1px solid #e0e0e0;border-radius:4px;margin-left:8px}.add-item-button[_ngcontent-%COMP%]{margin-top:16px}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:400px;margin-left:auto}.summary-grid[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #e0e0e0}.summary-grid[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:80px;padding:4px;border:1px solid #e0e0e0;border-radius:4px;text-align:right}.summary-grid[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:4px;border:1px solid #e0e0e0;border-radius:4px;margin-left:8px}.summary-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{font-size:16px;border-bottom:none;padding-top:16px}.actions-section[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px}.actions-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.full-width[_ngcontent-%COMP%]{width:100%}.mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:-.75rem}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{padding-bottom:0}.mat-tab-body-content[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:.25rem}"]});const Te=[{path:"",redirectTo:"invoice-list",pathMatch:"full"},{path:"invoice-list",component:B,pathMatch:"full",data:{breadcrumb:"TaxInvoice"}},{path:"invoice-add/:id",component:F,data:{breadcrumb:"EditTaxInvoice"}},{path:"invoice-add",component:k,data:{breadcrumb:"AddTaxInvoice"}},{path:"rental-invoice-list",component:R,data:{breadcrumb:"RentalInvoice",invType:"S"}},{path:"expinvoice-list",component:B,pathMatch:"full",data:{breadcrumb:"ExpensesInvoice"}},{path:"expinvoice-add/:id",component:F,data:{breadcrumb:"EditExpensesInvoice"}},{path:"expinvoice-add",component:k,data:{breadcrumb:"AddExpensesInvoice"}},{path:"request-list",component:j,pathMatch:"full",data:{breadcrumb:"RequestInvoice"}},{path:"request-add/:id",component:G,data:{breadcrumb:"EditRequestInvoice"}},{path:"expensesinv-list",component:R,data:{breadcrumb:"ExpensesInvoice",invType:"X"}},{path:"expensesinv-add/:id",component:K,data:{breadcrumb:"EditExpensesInvoice"}},{path:"expensesinv-add",component:K,data:{breadcrumb:"AddExpensesInvoice"}},{path:"invs-list",component:$,data:{breadcrumb:"InvoiceMasterDt"}},{path:"invs-add/:id",component:E,data:{breadcrumb:"EditInvoiceMaster"}},{path:"invs-add",component:E,data:{breadcrumb:"AddInvoiceMaster"}},{path:"invs-pos/:id",component:Y,data:{breadcrumb:"EditInvoiceMaster"}},{path:"invs-pos",component:Y,data:{breadcrumb:"AddInvoiceMaster"}}];class J{}J.\u0275fac=function(t){return new(t||J)},J.\u0275mod=e.oAB({type:J}),J.\u0275inj=e.cJS({imports:[p.ez,b.Bz.forChild(Te),oe.JF,c.u5,w.JX,Ne.D,c.UX,Ce.m,w.JX,D.A0]})}}]);