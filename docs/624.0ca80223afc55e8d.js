"use strict";(self.webpackChunkemporium=self.webpackChunkemporium||[]).push([[624],{6002:(P,A,r)=>{r.d(A,{Z:()=>u});var m=r(5521),U=r(2340),o=r(4650),C=r(529),O=r(7465);class u{constructor(a,i){this.http=a,this.globalServ=i,this.baseUrl=(new m.P).api_Ip,this.secondPartUrl=(new m.P).api_constant,this.curCOMId=U.N.comid}getAllBranch(a,i){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/allBranches/?M="+a+"&C="+i,this.globalServ.getAuthHeaders())}getOneBranch(a){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/"+a+"/",this.globalServ.getAuthHeaders())}getMainBranch(a,i){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/branchPerSpec/?M="+a+"&C="+i+"&Main=T",this.globalServ.getAuthHeaders())}sendSms(a,i,h){return this.http.post(a,i,this.globalServ.smsHeaders(h))}addBranch(a){return this.http.post(this.baseUrl+this.secondPartUrl+"atlas/branch/",a,this.globalServ.getAuthHeaders())}editBranch(a,i){return this.http.put(this.baseUrl+this.secondPartUrl+"atlas/branch/"+i+"/",a,this.globalServ.getAuthHeaders())}deleteBranch(a){return this.http.delete(this.baseUrl+this.secondPartUrl+"atlas/branch/"+a+"/",this.globalServ.getAuthHeaders())}softDeleteBranch(a){return this.http.put(this.baseUrl+this.secondPartUrl+"atlas/branch/"+a+"/",{RowDelete:1},this.globalServ.getAuthHeaders())}}u.\u0275fac=function(a){return new(a||u)(o.LFG(C.eN),o.LFG(O.U))},u.\u0275prov=o.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})},624:(P,A,r)=>{r.r(A),r.d(A,{SignInModule:()=>f,routes:()=>Z});var m=r(6895),U=r(9132),o=r(4006),C=r(589),O=r(5861),u=r(8955),M=r(3071),a=r(2340),i=r(5783),h=r(5412),t=r(4650),d=r(1576),L=r(4859),T=r(4144),p=r(9549),b=r(3081);function F(n,e){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"Password is required"),t.qZA())}class S{constructor(e,s,c){this.dialogRef=e,this.data=s,this.fb=c}ngOnInit(){this.form=this.fb.group({otp:[null,o.kI.required]})}onSubmit(){console.log(this.form.value),this.form.valid&&this.dialogRef.close(this.form.value)}onSave(){this.form.valid&&(this.action="Ok",this.dialogRef.close({event:this.action,data:this.form.value}))}close(){this.action="Cancel",this.dialogRef.close({event:this.action})}}S.\u0275fac=function(e){return new(e||S)(t.Y36(h.so),t.Y36(h.WI),t.Y36(o.QS))},S.\u0275cmp=t.Xpm({type:S,selectors:[["app-otp-dialog"]],decls:21,vars:16,consts:[["mat-dialog-title",""],["autocomplete","off",3,"formGroup"],["mat-dialog-content",""],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-sm","90.0",1,"px-1"],["appearance","outline",1,"w-100"],["matInput","","formControlName","otp","required",""],[4,"ngIf"],["mat-dialog-actions",""],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["mat-raised-button","","color","primary",3,"mat-dialog-close","disabled","click"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"form",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"mat-form-field",5)(8,"mat-label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._UZ(11,"input",6),t.YNc(12,F,2,0,"mat-error",7),t.qZA()()()(),t.TgZ(13,"div",8)(14,"div",9)(15,"button",10),t.NdJ("click",function(){return s.onSave()}),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"button",11),t.NdJ("click",function(){return s.close()}),t._uU(19),t.ALo(20,"translate"),t.qZA()()()()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,8,"ADMIN_NAV.OTP")),t.xp6(2),t.Q6J("formGroup",s.form),t.xp6(6),t.Oqu(t.lcZ(10,10,"HTML.PASSWORD")),t.xp6(3),t.Q6J("ngIf",null==s.form.controls.otp.errors?null:s.form.controls.otp.errors.required),t.xp6(3),t.Q6J("mat-dialog-close",s.form.value)("disabled",!s.form.valid),t.xp6(1),t.Oqu(t.lcZ(17,12,"BTN.OK")),t.xp6(3),t.Oqu(t.lcZ(20,14,"BTN.CANCEL")))},dependencies:[m.O5,o._Y,o.Fj,o.JJ,o.JL,o.Q7,o.sg,o.u,d.xw,d.Wh,d.yH,L.lW,h.ZT,h.uh,h.xY,h.H8,T.Nt,p.KE,p.hX,p.TO,b.X$]});var x=r(7009),w=r(5298),N=r(7465),y=r(2854),D=r(6002),R=r(1182),B=r(3546),Y=r(7392);function G(n,e){1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"HTML.USERNAMEREQ")))}function k(n,e){1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MESSAGE.MinLength")))}function H(n,e){1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"HTML.PasswordREQ")))}function J(n,e){1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MESSAGE.MinLength6")))}class I{constructor(e,s,c,v,E,l,g,Q,q,K,W){this.formBuilder=e,this.router=s,this.snackBar=c,this.localStore=v,this.userService=E,this.global=l,this.staff=g,this.dialog=Q,this.translateService=q,this.atlasService=K,this.appSettings=W,this.curCOMId=a.N.comid,this.curBraId=a.N.braid,this.account=new i.n,this.allowedChar="1234567890",this.lengthOfCode=6,this.settings=this.appSettings.settings}ngOnInit(){this.loginForm=this.formBuilder.group({username:["",o.kI.compose([o.kI.required,o.kI.minLength(3)])],password:["",o.kI.compose([o.kI.required,o.kI.minLength(6)])]}),this.registerForm=this.formBuilder.group({username:["",o.kI.compose([o.kI.required,o.kI.minLength(3)])],first_name:["",o.kI.compose([o.kI.required,o.kI.minLength(3)])],email:["",o.kI.compose([o.kI.required,u.L])],password:["",o.kI.required],confirmPassword:["",o.kI.required]},{validator:(0,u.z)("password","confirmPassword")}),this.prepareMsgLanguage(),this.setInitialValues()}prepareMsgLanguage(){this.translateService.get("MESSAGE.LOGGEDIN").subscribe(e=>{this.loggedInMsg=e}),this.translateService.get("MESSAGE.NOTLOGGEDIN").subscribe(e=>{this.notLoggedInMsg=e}),this.translateService.get("MESSAGE.REGISTERD").subscribe(e=>{this.registeredMsg=e}),this.translateService.get("MESSAGE.NOTREGISTERD").subscribe(e=>{this.notRegisteredMsg=e})}getOneUser(e){console.log("**** sign-in.component line 103 *****getOneUser::: "+e),this.staff.getOneUserbyId(e).subscribe(s=>{this.global.me=s,console.log(s.userPicture)})}onLoginFormSubmit(e){this.loginForm.valid&&this.userService.login(this.loginForm).subscribe(s=>{console.log("---open OTP dialog-----"),console.log(s.user.UserMobile),this.openOTPDialog(s.user,s.token,s.user.id,s.user.UserMobile),console.log("---Wait for OTP dialog-------")},s=>{this.global.userLoggedIn=!1,this.snackBar.open(this.notLoggedInMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}),this.router.navigate(["/"]).then(()=>{window.location.reload()})})}delay(e){return new Promise(s=>setTimeout(s,e))}waitAndNavigate(){var e=this;return(0,O.Z)(function*(){yield e.delay(2e3),e.router.navigate(["/"]).then(()=>{window.location.reload()})})()}onRegisterFormSubmit(e){this.registerForm.valid?this.userService.registerUser(this.registerForm).subscribe(s=>{this.snackBar.open(this.registeredMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.router.navigate(["/units/unit"])},s=>{console.log("error",s),this.snackBar.open(this.notRegisteredMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):(console.log("this.registerForm not valid"),this.snackBar.open(this.notRegisteredMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}))}setInitialValues(){this.newUser={id:null,username:"",UserCode:null,first_name:"",last_name:"",UserBirthDate:null,EntryDate:null,joinedDate:null,UserMobile:"",email:"",is_superuser:!1,is_staff:!1,is_active:!0,is_employee:"T",periorty:0,COMId:this.curCOMId,branch_KeyField:null,customer_KeyField:null,userPicture:null,gender:"",password:"",repassword:"",is_teacher:"F",RowDelete:0,LoginFrom:"N",userJobName:"",userFacebook:"",userTwitter:"",userGoogle:"",userAddress:""}}mapRegisterFormTo_UserClass(){this.newUser.username=this.registerForm.value.username,this.newUser.email=this.registerForm.value.email,this.newUser.password=this.registerForm.value.password,this.newUser.repassword=this.registerForm.value.confirmPassword}mapToOneUser(){this.oneuser.username=this.registerForm.value.username,this.oneuser.email=this.registerForm.value.email}openOTPDialog(e,s,c,v){this.localStore.setItem("token",s),this.otpCode=this.createRandomString(this.lengthOfCode,this.allowedChar),this.atlasService.getMainBranch(this.curCOMId,e.periorty).subscribe(l=>{this.smsURl=l[0].smsUrlProtocol+l[0].smsUrl+l[0].smsUrlPage,this.smsContent={bearerTokens:l[0].smsToken,sender:'"'+l[0].smsSenderName+'"',recipients:v,body:this.otpCode},this.atlasService.sendSms(this.smsURl,this.smsContent,l[0].smsToken).subscribe(g=>{console.log("MessageSent_statusCode",g.statusCode),console.log("MessageSent_message",g.message),console.log("MessageSent",g),alert("sms Sent**:: "+g.statusCode+" "+g.message)},g=>{alert("sms error**:: "+g)})}),this.dialog.open(S,{data:{cttRow:""},panelClass:["theme-dialog"],autoFocus:!1,direction:this.settings.rtl?"rtl":"ltr"}).afterClosed().subscribe(l=>{"Cancel"==l.event?(this.global.userLoggedIn=!1,this.snackBar.open(this.notLoggedInMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}),this.router.navigate(["/"]).then(()=>{window.location.reload()})):"Ok"==l.event&&(l.data.otp==this.otpCode?(localStorage.setItem("pointer","signinReload"),console.log("---EQUAL----"),this.localStore.setItem("token",s),this.global.me=e,this.global.userLoggedIn=!0,localStorage.setItem("windowCount","1"),this.localStore.setItem("smsCode","Accepted"),this.localStore.setItem("signedIn","Done"),this.userService.getUserPermission(c).subscribe(g=>{this.localStore.setItem("permissions",JSON.stringify(g.user_permissions))}),this.snackBar.open(this.loggedInMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.waitAndNavigate()):(console.log("---not EQUAL----"),this.global.userLoggedIn=!1,this.snackBar.open(this.notLoggedInMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}),this.router.navigate(["/"]).then(()=>{window.location.reload()})),console.log("---------------------------"))})}createRandomString(e,s){let c="";for(let v=0;v<e;v++)c+=s.charAt(Math.floor(Math.random()*s.length));return c}}I.\u0275fac=function(e){return new(e||I)(t.Y36(o.QS),t.Y36(U.F0),t.Y36(x.ux),t.Y36(w.C),t.Y36(M.K),t.Y36(N.U),t.Y36(y.x),t.Y36(h.uw),t.Y36(b.sK),t.Y36(D.Z),t.Y36(R.d))},I.\u0275cmp=t.Xpm({type:I,selectors:[["app-sign-in"]],features:[t._Bn([M.K])],decls:33,vars:23,consts:[[1,"p-4"],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-sm","50",1,"p-3"],[1,"text-muted","text-center","mb-3"],[3,"formGroup"],["appearance","outline",1,"w-100","mt-2"],["matInput","","formControlName","username","required","",3,"placeholder"],[4,"ngIf"],["appearance","outline",1,"w-100","mt-1"],["matInput","","formControlName","password","type","password","required","",3,"placeholder"],[1,"text-center","mt-2"],["mat-fab","","color","primary",1,"mat-elevation-z6",3,"click"],["fxLayout","row","fxLayoutAlign","space-between center",1,"mt-3"],[1,"divider","w-100"],[1,"text-muted","auth"]],template:function(e,s){1&e&&(t.TgZ(0,"mat-card",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"form",4)(7,"mat-form-field",5)(8,"mat-label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._UZ(11,"input",6),t.ALo(12,"translate"),t.YNc(13,G,3,3,"mat-error",7),t.YNc(14,k,3,3,"mat-error",7),t.qZA(),t.TgZ(15,"mat-form-field",8)(16,"mat-label"),t._uU(17),t.ALo(18,"translate"),t.qZA(),t._UZ(19,"input",9),t.ALo(20,"translate"),t.YNc(21,H,3,3,"mat-error",7),t.YNc(22,J,3,3,"mat-error",7),t.qZA(),t.TgZ(23,"div",10)(24,"button",11),t.NdJ("click",function(){return s.onLoginFormSubmit(s.loginForm.value)}),t.TgZ(25,"mat-icon"),t._uU(26,"key"),t.qZA()()(),t.TgZ(27,"div",12),t._UZ(28,"div",13),t.TgZ(29,"h3",14),t._uU(30),t.ALo(31,"translate"),t.qZA(),t._UZ(32,"div",13),t.qZA()()()()()),2&e&&(t.xp6(4),t.Oqu(t.lcZ(5,11,"HTML.SIGNIN")),t.xp6(2),t.Q6J("formGroup",s.loginForm),t.xp6(3),t.Oqu(t.lcZ(10,13,"HTML.USERNAME")),t.xp6(2),t.s9C("placeholder",t.lcZ(12,15,"HTML.USERNAME")),t.xp6(2),t.Q6J("ngIf",null==s.loginForm.controls.username.errors?null:s.loginForm.controls.username.errors.required),t.xp6(1),t.Q6J("ngIf",s.loginForm.controls.username.hasError("minlength")),t.xp6(3),t.Oqu(t.lcZ(18,17,"HTML.PASSWORD")),t.xp6(2),t.s9C("placeholder",t.lcZ(20,19,"HTML.PASSWORD")),t.xp6(2),t.Q6J("ngIf",null==s.loginForm.controls.password.errors?null:s.loginForm.controls.password.errors.required),t.xp6(1),t.Q6J("ngIf",s.loginForm.controls.password.hasError("minlength")),t.xp6(8),t.Oqu(t.lcZ(31,21,"COMPANY.NAME")))},dependencies:[m.O5,o._Y,o.Fj,o.JJ,o.JL,o.Q7,o.sg,o.u,d.xw,d.Wh,d.yH,L.cs,B.a8,Y.Hw,T.Nt,p.KE,p.hX,p.TO,b.X$],styles:[".auth[_ngcontent-%COMP%]{white-space:nowrap;padding:7px 14px;font-weight:500}"]});const Z=[{path:"",component:I,pathMatch:"full"}];class f{}f.\u0275fac=function(e){return new(e||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({imports:[m.ez,U.Bz.forChild(Z),o.UX,C.m]})}}]);