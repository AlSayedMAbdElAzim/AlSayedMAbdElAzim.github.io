"use strict";(self.webpackChunkemporium=self.webpackChunkemporium||[]).push([[91],{8091:(it,M,o)=>{o.r(M),o.d(M,{SmsModule:()=>u,routes:()=>N});var g=o(6895),x=o(2340),E=o(5783),C=o(4459),m=o(5412),r=o(4006),t=o(4650),b=o(7009),A=o(5521),L=o(2843),Z=o(529),y=o(7465);class c{constructor(e,s){this.http=e,this.globalServ=s,this.baseUrl=(new A.P).api_Ip,this.secondPartUrl=(new A.P).api_constant,this.curCOMId=x.N.comid}getSMSTemplates(e){return this.http.get(this.baseUrl+this.secondPartUrl+"sms/smstemplate/allSMSTemplates/?"+e,this.globalServ.getAuthHeaders())}editSMSTemplate(e,s){return this.http.put(this.baseUrl+this.secondPartUrl+"sms/smstemplate/"+s+"/",e,this.globalServ.getAuthHeaders())}addSMSTemplate(e){return this.http.post(this.baseUrl+this.secondPartUrl+"sms/smstemplate/",e,this.globalServ.getAuthHeaders())}deleteSMSTemplate(e){return this.http.delete(this.baseUrl+this.secondPartUrl+"sms/smstemplate/"+e,this.globalServ.getAuthHeaders())}getTemplatePerSpec(e){return this.http.get(this.baseUrl+this.secondPartUrl+"sms/smstemplate/SMSTemplatePerSpec/?"+e,this.globalServ.getAuthHeaders())}handleError(e){return 0===e.status?console.error("An error occurred:",e.error.message):console.error(`Backend returned code ${e.status}, body was: `,e.error.message),(0,L._)(()=>new Error("Something bad happened; please try again later."))}}c.\u0275fac=function(e){return new(e||c)(t.LFG(Z.eN),t.LFG(y.U))},c.\u0275prov=t.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"});var I=o(6838),d=o(1576),O=o(3238),f=o(4859),F=o(4144),U=o(9549),D=o(4385),v=o(3081);function _(a,e){if(1&a&&(t.TgZ(0,"mat-option",17)(1,"span"),t._uU(2),t.qZA()()),2&a){const s=e.$implicit;t.Q6J("value",s.id),t.xp6(2),t.Oqu(s.CTTSubjectName)}}function J(a,e){if(1&a){const s=t.EpF();t.TgZ(0,"li")(1,"button",18),t.NdJ("click",function(){const l=t.CHM(s).$implicit,T=t.oxw();return t.KtG(T.insertPlaceholder(l.value))}),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"translate"),t.qZA()()}if(2&a){const s=e.$implicit;t.xp6(2),t.AsE(" ",t.lcZ(3,2,"BTN.ADD")," ",t.lcZ(4,4,s.name)," ")}}function Y(a,e){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"BTN.SAVE")))}function w(a,e){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"BTN.EDIT")))}function H(a,e){if(1&a){const s=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(s);const n=t.oxw();return t.KtG(n.onSave())}),t.YNc(1,Y,3,3,"span",20),t.YNc(2,w,3,3,"span",20),t.qZA()}if(2&a){const s=t.oxw();t.Q6J("mat-dialog-close",s.form.value)("disabled",!s.form.valid),t.xp6(1),t.Q6J("ngIf",!s.data.smsTemplate),t.xp6(1),t.Q6J("ngIf",s.data.smsTemplate)}}class p{constructor(e,s,i,n,l,T){this.dialogRef=e,this.data=s,this.snackBar=i,this.smsService=n,this.codesService=l,this.fb=T,this.smsTypes_const=(new C.I).SMSTypes,this.placeholders=[{name:"MESSAGE.TenantName",value:"{{tenant_name}}"},{name:"MESSAGE.RentalValue",value:"{{rental_value}}"},{name:"MESSAGE.BuildName",value:"{{building_name}}"},{name:"MESSAGE.UnitNumber",value:"{{unit_number}}"},{name:"MESSAGE.DueDate",value:"{{due_date}}"}],this.SMSTypes_CTT=[]}ngOnInit(){this.form=this.fb.group({id:null,smsType_CTTKeyField:[null,r.kI.required],SMTName:[null,r.kI.required],SMTText:[null,r.kI.required]}),this.getSMSTypes(this.data.COMId,this.data.curUserData.periorty),this.data.smsTemplate?(this.action="Patch",this.form.patchValue({id:this.data.smsTemplate.id,smsType_CTTKeyField:this.data.smsTemplate.smsType_CTTKeyField,SMTName:this.data.smsTemplate.SMTName,SMTText:this.data.smsTemplate.SMTText})):this.action="Post",this.getAllSMSTemplates()}getCursorPosition(e){const s=document.querySelector("textarea");return s?s.selectionStart:0}setCursorPosition(e,s){const i=document.querySelector("textarea");i&&(i.setSelectionRange(s,s),i.focus())}insertPlaceholder(e){const s=this.form.get("SMTText"),i=s?.value||"",n=this.getCursorPosition(s),l=i.slice(0,n)+e+i.slice(n);s?.setValue(l),this.setCursorPosition(s,n+e.length)}getSMSTypes(e,s){this.codesService.getSubForParent(e,s,this.smsTypes_const).subscribe(i=>{this.SMSTypes_CTT=i},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0646\u0648\u0644\u0639 \u0627\u0644\u0631\u0633\u0627\u0626\u0644 \u0627\u0644\u0646\u0635\u064a\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onSubmit(){console.log(this.form.value),this.form.valid&&this.dialogRef.close(this.form.value)}getAllSMSTemplates(){this.smsTempFilterString="M="+this.data.COMId+"&C="+this.data.curUserData.periorty,this.smsService.getTemplatePerSpec(this.smsTempFilterString).subscribe(e=>{this.catHasSub=e})}onSave(){this.form.valid&&this.dialogRef.close({event:this.action,data:this.form.value})}onclose(){this.action="Cancel",this.dialogRef.close({event:this.action})}can(e){return!(!this.data.curUserData.is_superuser&&!this.data.userPerm.includes(e))}}p.\u0275fac=function(e){return new(e||p)(t.Y36(m.so),t.Y36(m.WI),t.Y36(b.ux),t.Y36(c),t.Y36(I.d),t.Y36(r.QS))},p.\u0275cmp=t.Xpm({type:p,selectors:[["app-sms-template-dialog"]],decls:34,vars:22,consts:[["mat-dialog-title",""],["autocomplete","off",3,"formGroup"],["mat-dialog-content",""],["fxLayout","row wrap",1,"sms-template"],["fxFlex","100"],["appearance","outline",1,"w-50"],["formControlName","smsType_CTTKeyField"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","SMTName"],["appearance","outline",1,"w-100"],["matInput","","formControlName","SMTText","rows","5",3,"placeholder"],[1,"button-grid"],[4,"ngFor","ngForOf"],["mat-dialog-actions",""],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["mat-raised-button","","color","primary",3,"mat-dialog-close","disabled","click",4,"ngIf"],["mat-raised-button","","color","warn","type","button",3,"click"],[3,"value"],["type","button","mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"mat-dialog-close","disabled","click"],[4,"ngIf"]],template:function(e,s){1&e&&(t.TgZ(0,"h2",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"form",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"mat-form-field",5)(8,"mat-label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"mat-select",6),t.YNc(12,_,3,2,"mat-option",7),t.qZA()(),t.TgZ(13,"mat-form-field",5)(14,"mat-label"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t._UZ(17,"input",8),t.qZA()(),t.TgZ(18,"div",4)(19,"mat-form-field",9)(20,"mat-label"),t._uU(21),t.ALo(22,"translate"),t.qZA(),t._UZ(23,"textarea",10),t.ALo(24,"translate"),t.qZA()(),t.TgZ(25,"div")(26,"ul",11),t.YNc(27,J,5,6,"li",12),t.qZA()()()(),t.TgZ(28,"div",13)(29,"div",14),t.YNc(30,H,3,4,"button",15),t.TgZ(31,"button",16),t.NdJ("click",function(){return s.onclose()}),t._uU(32),t.ALo(33,"translate"),t.qZA()()()()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,10,"ADMIN_NAV.SMSTemplate")),t.xp6(2),t.Q6J("formGroup",s.form),t.xp6(6),t.Oqu(t.lcZ(10,12,"HTML.SMSTemplateType")),t.xp6(3),t.Q6J("ngForOf",s.SMSTypes_CTT),t.xp6(3),t.Oqu(t.lcZ(16,14,"HTML.SMSTemplateName")),t.xp6(6),t.Oqu(t.lcZ(22,16,"HTML.SMSTemplateText")),t.xp6(2),t.s9C("placeholder",t.lcZ(24,18,"HTML.SMSTemplateText")),t.xp6(4),t.Q6J("ngForOf",s.placeholders),t.xp6(3),t.Q6J("ngIf",s.data.smsTemplate&&s.can("change_smstemplate")||!s.data.smsTemplate&&s.can("add_smstemplate")),t.xp6(2),t.Oqu(t.lcZ(33,20,"BTN.CANCEL")))},dependencies:[g.sg,g.O5,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,d.xw,d.Wh,d.yH,O.ey,f.lW,m.ZT,m.uh,m.xY,m.H8,F.Nt,U.KE,U.hX,D.gD,v.X$],styles:[".sms-template[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px;border:1px solid #ccc;border-radius:5px;background-color:#f9f9f9}textarea[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:10px}button[_ngcontent-%COMP%]{padding:10px 15px}ul[_ngcontent-%COMP%]{list-style:none;padding:0}li[_ngcontent-%COMP%]{margin:5px 0}.button-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;list-style-type:none;padding:0}"]});var B=o(2887),P=o(9132),G=o(5298),R=o(1182),S=o(4333),q=o(3546),Q=o(7392),K=o(4850),k=o(266);function $(a,e){if(1&a){const s=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(s);const n=t.oxw();return t.KtG(n.openSMSTemplateDialog(null))}),t.TgZ(1,"h2"),t._uU(2,"+"),t.qZA()()}}function V(a,e){if(1&a){const s=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(s);const n=t.oxw().$implicit,l=t.oxw();return t.KtG(l.openSMSTemplateDialog(n))}),t.ALo(1,"translate"),t.TgZ(2,"mat-icon"),t._uU(3,"visibility"),t.qZA()()}2&a&&t.s9C("matTooltip",t.lcZ(1,1,"BTN.VIEW"))}function W(a,e){if(1&a){const s=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(s);const n=t.oxw().$implicit,l=t.oxw();return t.KtG(l.onremove(n))}),t.ALo(1,"translate"),t.TgZ(2,"mat-icon"),t._uU(3,"delete"),t.qZA()()}2&a&&t.s9C("matTooltip",t.lcZ(1,1,"BTN.REMOVE"))}function X(a,e){if(1&a&&(t.TgZ(0,"div",10)(1,"div",11),t._uU(2),t.qZA(),t.TgZ(3,"div",11),t._uU(4),t.qZA(),t.TgZ(5,"div",11),t._uU(6),t.qZA(),t.TgZ(7,"div",11)(8,"div",12),t.YNc(9,V,4,3,"button",13),t.YNc(10,W,4,3,"button",14),t.qZA()()()),2&a){const s=e.$implicit,i=t.oxw();t.xp6(2),t.Oqu(s.smsTypeName),t.xp6(2),t.Oqu(s.SMTName),t.xp6(2),t.Oqu(s.SMTText),t.xp6(3),t.Q6J("ngIf",i.can("view_smstemplate")),t.xp6(1),t.Q6J("ngIf",i.can("delete_smstemplate"))}}function j(a,e){if(1&a){const s=t.EpF();t.TgZ(0,"div",17)(1,"div",18)(2,"mat-card",19)(3,"pagination-controls",20),t.NdJ("pageChange",function(n){t.CHM(s);const l=t.oxw();return t.KtG(l.onPageChanged(n))}),t.qZA()()()()}}const z=function(a,e){return{itemsPerPage:a,currentPage:e}};class h{constructor(e,s,i,n,l,T,at,ot){this.smsService=e,this.dialog=s,this.router=i,this.global=n,this.localStore=l,this.translateService=T,this.snackBar=at,this.appSettings=ot,this.smsTemplates=[],this.count=10,this.curCOMId=x.N.comid,this.account=new E.n,this.userPerm=[],this.settings=this.appSettings.settings}ngOnInit(){if(this.securityForApp=(new C.$).getSecurityType(),this.userSUb=this.global.user.subscribe(e=>{this.account=e}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let e=0;e<this.curUserPermissions.length;e++)this.userPerm[e]=this.curUserPermissions[e].codename;this.smsTemplateFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty,this.getSMSTemplates()}else this.router.navigate(["/sign-in"]);this.prepareMsgLanguage()}getSMSTemplates(){this.smsService.getSMSTemplates(this.smsTemplateFilterString).subscribe(e=>{this.smsTemplates=e})}onPageChanged(e){this.page=e,window.scrollTo(0,0)}can(e){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(e))}openSMSTemplateDialog(e){this.dialog.open(p,{data:{smsTemplate:e,periorty:this.account.periorty,curUserData:this.curUserData,userPerm:this.userPerm,COMId:this.curCOMId},panelClass:["theme-dialog"],autoFocus:!1,direction:this.settings.rtl?"rtl":"ltr"}).afterClosed().subscribe(i=>{"Cancel"==i.event||("Patch"==i.event?(console.log("---Patch----"),this.smsService.editSMSTemplate(i.data,i.data.id).subscribe(n=>{this.snackBar.open("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0646\u0645\u0648\u0630\u062c \u0627\u0644\u0631\u0633\u0627\u0644\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.getSMSTemplates()},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u062a\u0639\u062f\u064a\u0644 \u0646\u0645\u0648\u0630\u062c \u0627\u0644\u0631\u0633\u0627\u0644\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})):"Post"==i.event&&this.smsService.addSMSTemplate(i.data).subscribe(n=>{this.snackBar.open("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0646\u0645\u0648\u0630\u062c \u0631\u0633\u0627\u0644\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.getSMSTemplates()},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0625\u0636\u0627\u0641\u0629 \u0646\u0645\u0648\u0630\u062c \u0631\u0633\u0627\u0644\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}))})}onremove(e){this.dialog.open(B.$,{maxWidth:"400px",data:{title:this.deletedTitleMsg,message:this.askToDeletedMsg}}).afterClosed().subscribe(i=>{i&&this.smsService.deleteSMSTemplate(e.id).subscribe(()=>{this.snackBar.open(this.deletedMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.getSMSTemplates()})})}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(e=>{this.errorRetrieveMsg=e}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(e=>{this.askToDeletedMsg=e}),this.translateService.get("MESSAGE.DELETED").subscribe(e=>{this.deletedMsg=e}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(e=>{this.deletedTitleMsg=e})}}h.\u0275fac=function(e){return new(e||h)(t.Y36(c),t.Y36(m.uw),t.Y36(P.F0),t.Y36(y.U),t.Y36(G.C),t.Y36(v.sK),t.Y36(b.ux),t.Y36(R.d))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-sms-templates"]],decls:26,vars:21,consts:[[1,"p-2"],["fxLayout","row wrap","fxLayoutAlign","space-between center",1,"w-100","p-3"],["mat-dialog-title",""],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"mat-mdc-table","admin-table"],[1,"mat-mdc-header-row"],[1,"mat-mdc-header-cell"],["class","mat-mdc-row",4,"ngFor","ngForOf"],["fxLayout","row wrap",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],[1,"mat-mdc-row"],[1,"mat-mdc-cell"],[1,"p-2","actions"],["mat-mini-fab","","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","warn","class","mx-1",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"matTooltip","click"],["mat-mini-fab","","color","warn",1,"mx-1",3,"matTooltip","click"],["fxLayout","row wrap"],["fxFlex","100"],[1,"p-0","text-center"],["autoHide","true","maxSize","5",1,"product-pagination",3,"pageChange"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"mat-card")(2,"div",1)(3,"h2",2),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.YNc(6,$,3,0,"button",3),t.qZA(),t._UZ(7,"mat-divider"),t.TgZ(8,"div",4)(9,"div",5)(10,"div",6)(11,"h3"),t._uU(12),t.ALo(13,"translate"),t.qZA()(),t.TgZ(14,"div",6)(15,"h3"),t._uU(16),t.ALo(17,"translate"),t.qZA()(),t.TgZ(18,"div",6)(19,"h3"),t._uU(20),t.ALo(21,"translate"),t.qZA()(),t._UZ(22,"div",6),t.qZA(),t.YNc(23,X,11,5,"div",7),t.ALo(24,"paginate"),t.qZA()(),t.YNc(25,j,4,0,"div",8),t.qZA()),2&e&&(t.xp6(4),t.Oqu(t.lcZ(5,7,"ADMIN_NAV.SMSTemplate")),t.xp6(2),t.Q6J("ngIf",s.can("add_smstemplate")),t.xp6(6),t.hij("",t.lcZ(13,9,"HTML.SMSTemplateType")," "),t.xp6(4),t.hij("",t.lcZ(17,11,"HTML.SMSTemplateName")," "),t.xp6(4),t.Oqu(t.lcZ(21,13,"HTML.SMSTemplateText")),t.xp6(3),t.Q6J("ngForOf",t.xi3(24,15,s.smsTemplates,t.WLB(18,z,s.count,s.page))),t.xp6(2),t.Q6J("ngIf",s.smsTemplates.length>0))},dependencies:[g.sg,g.O5,S.LS,d.xw,d.Wh,d.yH,f.lW,f.nh,q.a8,m.uh,Q.Hw,K.d,k.gM,S._s,v.X$]});var tt=o(8865),et=o(9045),st=o(8796);const N=[{path:"",redirectTo:"smstemplate-list",pathMatch:"full"},{path:"smstemplate-list",component:h,data:{breadcrumb:"SMSTemplate"}},{path:"smstemplate-add/:id",component:p,data:{breadcrumb:"EditSMSTemplate"}},{path:"smstemplate-add",component:p,data:{breadcrumb:"AddSMSTemplate"}}];class u{}u.\u0275fac=function(e){return new(e||u)},u.\u0275mod=t.oAB({type:u}),u.\u0275inj=t.cJS({imports:[g.ez,Z.JF,r.u5,S.JX,et.D,P.Bz.forChild(N),r.UX,tt.m,S.JX,st.A0]})}}]);