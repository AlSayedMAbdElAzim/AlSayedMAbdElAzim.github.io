"use strict";(self.webpackChunkemporium=self.webpackChunkemporium||[]).push([[472],{2472:(Ze,D,s)=>{s.r(D),s.d(D,{InvoiceModule:()=>b,routes:()=>V});var A=s(6895),y=s(9132),E=s(529),c=s(4006),Z=s(4333),K=s(589),J=s(9045),Y=s(2340),q=s(5783),_=s(1008),k=s(2887),v=s(4459),d=s(5412),e=s(4650),R=s(6002),H=s(3705),j=s(6838),Q=s(8959),W=s(5726),G=s(4165),O=s(7009),T=s(1576),$=s(3238),M=s(4859),L=s(9602),w=s(4144),N=s(9549),X=s(4385),U=s(8796),F=s(3081);function z(a,t){if(1&a&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&a){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BRAArbName," ")}}function ee(a,t){if(1&a&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&a){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.BUIName," ")}}function te(a,t){if(1&a&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&a){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.UNTUnitNumber," ")}}function ie(a,t){if(1&a&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&a){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.OWNName," ")}}function ne(a,t){if(1&a&&(e.TgZ(0,"ng-option",8),e._uU(1),e.qZA()),2&a){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.CUSName,"")}}function ae(a,t){1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.SAVE")))}function oe(a,t){1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.EDIT")))}function se(a,t){if(1&a){const i=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.onSave())}),e.YNc(1,ae,3,3,"span",40),e.YNc(2,oe,3,3,"span",40),e.qZA()}if(2&a){const i=e.oxw();e.Q6J("mat-dialog-close",i.form.value)("disabled",!i.form.valid),e.xp6(1),e.Q6J("ngIf",!i.data.invoiceRow),e.xp6(1),e.Q6J("ngIf",i.data.invoiceRow)}}class f{constructor(t,i,n,o,l,h,m,p,r,u,C,g){this.dialogRef=t,this.data=i,this.atlasService=n,this.unitsService=o,this._codesService=l,this.contractService=h,this.tenantsService=m,this.settingService=p,this.invoiceService=r,this.snackBar=u,this.dialog=C,this.fb=g,this.sellInvoice_CTT=(new v.I).SellInvoice,this.AllBranches=[],this.AllBuilding=[],this.AllUnitsForBuilding=[],this.AllOwners=[],this.AllTenants=[],this.expensesInvoiceCTT=(new v.I).ExpensesInvoice,this.sellInvoiceCTT=(new v.I).SellInvoice,this.addAlarmCTT=(new v.I).AddAlarm,this.discountAlarmCTT=(new v.I).DiscountAlarm,this.requestInvoiceCTT=(new v.I).RequestInvoice}ngOnInit(){this.form=this.fb.group({id:null,BRAKeyField:null,build_KeyField:null,unit_KeyField:null,owner_KeyField:null,PayType_CTTKeyField:null,INVType_CTTKeyField:null,CUSKeyField:null,contract_KeyField:null,user_KeyField:null,INVPayType:"E",INVCode:null,INVNumber:null,INVYear:null,INVMonth:null,INVSerial:null,INVDate:null,INVTotalValue:0,INVNetValue:0,INVPayedValue:0,INVStatus:"N",INVExpenses:0,INVCost:0,INVTax:15,INVTaxValue:0,RowConfirm:0,RowDelete:0,RowStatus:0}),this.data.invoiceRow?(this.action="Patch",this.form.patchValue(this.data.invoiceRow)):(this.action="Post",this.curDate=new Date,this.yearValue=this.curDate.getFullYear().toString(),this.monthValue=(this.curDate.getMonth()+1).toString(),this.form.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue,INVDate:this.curDate})),this.getCodeTableTreePerCode(this.data.COMId,this.data.periorty),this.data.curUserData.is_superuser?this.getAllBranches(this.data.COMId,this.data.periorty):"T"==this.data.curUserData.is_employee?this.getEmpBranches(this.data.COMId,this.data.periorty,this.data.curUserData.id,this.data.curUserData.branch_KeyField??0):"T"==this.data.curUserData.is_owner&&this.getOwnerBranches(this.data.COMId,this.data.periorty,this.data.curUserData.owner_KeyField,this.data.curUserData.branch_KeyField??0),this.getAllOwnerss(this.data.COMId,this.data.periorty),this.getTenants()}readUnit(t){t.value&&this.unitsService.getOneUnit(t.value).subscribe(i=>{this.form.patchValue({CUSKeyField:i.customer_KeyField})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0648\u062d\u062f\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onSubmit(){console.log(this.form.value),this.form.valid&&this.dialogRef.close(this.form.value)}onSave(){this.createDocumentNumber("S"),this.form.valid&&this.dialogRef.close({event:this.action,data:this.form.value})}close(){this.action="Cancel",this.dialogRef.close({event:this.action})}can(t){return!(!this.data.curUserData.is_superuser&&!this.data.userPerm.includes(t))}getAllBranches(t,i){this.atlasService.getAllBranch(t,i).subscribe(n=>{this.AllBranches=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getEmpBranches(t,i,n,o){this.atlasService.getBranchPerEmp(t,i,n).subscribe(l=>{this.AllBranches=l,this.AllBranches.length>0||this.atlasService.getOneBranch(o).subscribe(h=>{this.AllBranches=h},h=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0648\u0638\u0641","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getOwnerBranches(t,i,n,o){this.atlasService.getBranchPerOwner(t,i,n).subscribe(l=>{this.AllBranches=l,this.AllBranches.length>0||this.atlasService.getOneBranch(o).subscribe(h=>{this.AllBranches=h},h=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0641\u0631\u0639 \u0627\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0641\u0631\u0648\u0639 \u0644\u0644\u0645\u0627\u0644\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getBuildings(t){this.getBuildingPerBranch(this.data.COMId,this.data.periorty,t.value)}getBuildingPerBranch(t,i,n){this.unitsService.getBuildingsPerBranch(t,i,n).subscribe(o=>{this.AllBuilding=o},o=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0639\u0642\u0627\u0631\u0627\u062a \u0644\u0644\u0641\u0631\u0639","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}onChangeDate(t){let i=t.value;this.yearValue=i.getFullYear().toString(),this.monthValue=(i.getMonth()+1).toString(),this.form.patchValue({INVYear:this.yearValue,INVMonth:this.monthValue})}readBuilding(t){this.unitsService.getOneBuilding(t.value).subscribe(i=>{this.curOwnerId=i.owner_KeyField,this.form.patchValue({owner_KeyField:this.curOwnerId})},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}),this.getUnitsPerBuilding(this.data.COMId,this.data.periorty,t.value,"A")}getUnitsPerBuilding(t,i,n,o){this.unitsService.getAllUnitsPerBuilding(t,i,n,o).subscribe(l=>{this.AllUnitsForBuilding=l},l=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0648\u062d\u062f\u0627\u062a \u0644\u0644\u0639\u0642\u0627\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getAllOwnerss(t,i){this.contractService.getAllOwners(t,i).subscribe(n=>{this.AllOwners=n},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0645\u0644\u0627\u0643","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getTenants(){this.AllTenants=null,this.tenantsService.getCustomersConfirmed(this.data.COMId,this.data.periorty).subscribe(t=>this.AllTenants=t)}readCustumer(t){this.tenantsService.getOneCustomer(t).subscribe(i=>{},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0623\u062c\u0631","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getCodeTableTreePerCode(t,i){this._codesService.getRowPerCode(t,i,this.sellInvoice_CTT).subscribe(n=>{this.cttID=n[0].id,this.form.patchValue({INVType_CTTKeyField:this.cttID})},n=>{this.snackBar.open("\u0644\u0645 \u0646\u062a\u0645\u0643\u0646 \u0645\u0646 \u0627\u062d\u0636\u0627\u0631 \u0645\u0641\u062a\u0627\u062d \u0646\u0648\u0639 \u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}searchByCode(t){this.tenantsService.getCustomerPerCode(this.data.COMId,this.data.periorty,+t).subscribe(i=>{i.length>0?(this.form.patchValue({CUSKeyField:i[0].id}),this.readCustumer(i[0].id)):(console.log("---Not---"),this.form.patchValue({CUSKeyField:null}))},i=>{console.log("----not found tenant----")})}pad(t,i){let n=t+"";for(;n.length<i;)n="0"+n;return n}onChangeTotal(t){let i=t.target.value,o=i*this.form.value.INVTax/100;this.form.patchValue({INVTaxValue:o,INVNetValue:+i+ +o})}createDocumentNumber(t){let i=this.form.value.BRAKeyField,n=this.form.value.owner_KeyField,o=this.form.value.build_KeyField,l=this.form.value.unit_KeyField,h=this.form.value.CUSKeyField,m=this.form.value.user_KeyField,p=this.form.value.contract_KeyField;var r,u;switch(t){case"X":this.curDocUsed=this.expensesInvoiceCTT;break;case"S":default:this.curDocUsed=this.sellInvoiceCTT;break;case"A":this.curDocUsed=this.addAlarmCTT;break;case"D":this.curDocUsed=this.discountAlarmCTT;break;case"R":this.curDocUsed=this.requestInvoiceCTT}this.filterString="M="+this.data.COMId+"&C="+this.data.periorty+"&usr=all",this.invoiceNumber="",this.settingService.getSerialsPerType(this.data.COMId,this.data.periorty,this.curDocUsed).subscribe(C=>{this.docserialType=C[0].DOSDocSerialType,"P"==this.docserialType?this.settingService.getAllDetaisForSerial(this.data.COMId,this.data.periorty,C[0].id).subscribe(g=>{for(let S=0;S<g.length;S++)if(this.partType=g[S].DSDPartType,this.partDigitNo=g[S].DSDNoOfDigits,this.partStartWith=g[S].DSDPartStartWith??"",this.partStartWith.length==+this.partDigitNo)this.invoiceNumber+=this.partStartWith;else if(this.partStartWith.length>+this.partDigitNo)this.invoiceNumber+=this.partStartWith.substring(0,+this.partDigitNo-1);else if(this.partStartWith.length<+this.partDigitNo)switch(this.invoiceNumber+=this.partStartWith,this.remainderLength=+this.partDigitNo-this.partStartWith.length,this.partType){case"Y":r=(new Date).getFullYear().toString(),u=r,r=r.substring(r.length-+this.remainderLength),this.invoiceNumber+=r,this.filterString+="&year="+u;break;case"M":u=((new Date).getMonth()+1).toString(),r="0"+u.slice(-2),this.invoiceNumber+=r,this.filterString+="&month="+u;break;case"B":r=i.length>=+this.remainderLength?i.toString().slice(-this.remainderLength):this.pad(i,this.remainderLength),this.invoiceNumber+=r,this.filterString+="&branch="+i;break;case"O":r=n.length>=+this.remainderLength?n.toString().slice(-this.remainderLength):this.pad(n,this.remainderLength),this.invoiceNumber+=r,this.filterString+="&owner="+n;break;case"P":r=o.length>=+this.remainderLength?o.toString().slice(-this.remainderLength):this.pad(o,this.remainderLength),this.invoiceNumber+=r,this.filterString+="&building="+o;break;case"U":r=l.length>=+this.remainderLength?l.toString().slice(-this.remainderLength):this.pad(l,this.remainderLength),this.invoiceNumber+=r,this.filterString+="&unit="+l;break;case"T":r=h.length>=+this.remainderLength?h.toString().slice(-this.remainderLength):this.pad(h,this.remainderLength),this.invoiceNumber+=r,this.filterString+="&customer="+h;break;case"C":r=p.length>=+this.remainderLength?p.toString().slice(-this.remainderLength):this.pad(p,this.remainderLength),this.invoiceNumber+=r,this.filterString+="&contract="+p;break;case"E":r=m.length>=+this.remainderLength?m.toString().slice(-this.remainderLength):this.pad(m,this.remainderLength),this.invoiceNumber+=r,this.filterString+="&user="+m;break;case"F":this.invoiceNumber+=r=this.partStartWith;break;case"S":console.log("----++++++++++-------"),console.log("this.filterString:: "+this.filterString),console.log("----++++++++++-------"),this.invoiceService.getInvoicesPerSpecOneString(this.filterString).subscribe(P=>{P.length>0?(this.maxSerial=P[0].INVSerial??0,this.maxSerial+=1,(u=this.maxSerial.toString()).length>=this.partDigitNo?this.invoiceNumber+=r=u:(r=this.pad(u.toString(),this.partDigitNo),this.invoiceNumber+=r),console.log("-------*****PartType=P*after Serial*****---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------")):(this.maxSerial=1,this.partDigitNo>1?(r=this.pad(1,this.partDigitNo),this.invoiceNumber+=r):this.invoiceNumber+="1",this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=P*after Serial new rows*****---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------"))})}}):this.contractService.getMaxContractCodeForOwner(this.data.COMId,this.data.periorty,this.curDocUsed).subscribe(g=>{this.maxSerial=g.max,this.invoiceNumber=this.maxSerial.toString(),this.form.patchValue({INVNumber:this.invoiceNumber,INVSerial:this.maxSerial}),console.log("-------*****PartType=G******---------"),console.log("this.maxSerial:: "+this.maxSerial),console.log("this.invoiceNumber:: "+this.invoiceNumber),console.log("-------***********---------")})})}}f.\u0275fac=function(t){return new(t||f)(e.Y36(d.so),e.Y36(d.WI),e.Y36(R.Z),e.Y36(H.X),e.Y36(j.d),e.Y36(Q.W),e.Y36(W.v),e.Y36(G.g),e.Y36(_.q),e.Y36(O.ux),e.Y36(d.uw),e.Y36(c.QS))},f.\u0275cmp=e.Xpm({type:f,selectors:[["app-invoice-dialog"]],decls:124,vars:72,consts:[["mat-dialog-title",""],["autocomplete","off",3,"formGroup"],["mat-dialog-content",""],["fxLayout","row wrap"],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["fxFlex","100","fxFlex.gt-sm","50.0",1,"px-1"],["appearance","outline",1,"w-100"],["formControlName","BRAKeyField","id","branchContOpSel",3,"placeholder","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-sm","29.8",1,"px-1"],["matInput","","formControlName","INVDate",3,"matDatepicker","dateChange"],["matSuffix","",3,"for"],["invDate",""],["fxFlex","100","fxFlex.gt-sm","10",1,"px-1"],["matInput","","formControlName","INVYear"],["matInput","","formControlName","INVMonth"],["formControlName","build_KeyField","id","buildOneOpSel",3,"placeholder","selectionChange"],["fxFlex","100","fxFlex.gt-sm","19.9",1,"px-1"],["formControlName","unit_KeyField","id","unitOneOpSel",3,"placeholder","selectionChange"],["fxFlex","100","fxFlex.gt-sm","30.0",1,"px-1"],["formControlName","owner_KeyField","id","oneOwnerOpSel",3,"placeholder"],["fxFlex","100","fxFlex.gt-sm","14.9",1,"px-1"],["matInput","",3,"keyup.enter"],["tenCode",""],["appearance","outline","formControlName","CUSKeyField","id","oneCustomOpSel",1,"w-100",3,"placeholder","change"],["fxFlex","100","fxFlex.gt-sm","20",1,"px-1"],["matInput","","formControlName","INVNumber"],["matInput","","formControlName","INVSerial"],["fxFlex","100","fxFlex.gt-sm","27.0",1,"px-1"],["matInput","","formControlName","INVTotalValue",3,"change"],["fxFlex","100","fxFlex.gt-sm","20.0",1,"px-1"],["matInput","","formControlName","INVTax"],["fxFlex","100","fxFlex.gt-sm","25.0",1,"px-1"],["matInput","","formControlName","INVTaxValue"],["matInput","","formControlName","INVNetValue"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"mat-dialog-close","disabled","click",4,"ngIf"],["mat-raised-button","","type","button","color","warn",3,"click"],["mat-raised-button","","color","primary",3,"mat-dialog-close","disabled","click"],[4,"ngIf"]],template:function(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"form",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"mat-form-field",6)(9,"mat-label"),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-select",7),e.NdJ("selectionChange",function(l){return i.getBuildings(l)}),e.ALo(13,"translate"),e.TgZ(14,"mat-option",8),e._uU(15,"-"),e.qZA(),e.YNc(16,z,2,2,"mat-option",9),e.qZA()()(),e.TgZ(17,"div",10)(18,"mat-form-field",6)(19,"mat-label"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"input",11),e.NdJ("dateChange",function(l){return i.onChangeDate(l)}),e.qZA(),e._UZ(23,"mat-datepicker-toggle",12)(24,"mat-datepicker",null,13),e.qZA()(),e.TgZ(26,"div",14)(27,"mat-form-field",6)(28,"mat-label"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e._UZ(31,"input",15),e.qZA()(),e.TgZ(32,"div",14)(33,"mat-form-field",6)(34,"mat-label"),e._uU(35),e.ALo(36,"translate"),e.qZA(),e._UZ(37,"input",16),e.qZA()()(),e.TgZ(38,"div",4)(39,"div",5)(40,"mat-form-field",6)(41,"mat-label"),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"mat-select",17),e.NdJ("selectionChange",function(l){return i.readBuilding(l)}),e.ALo(45,"translate"),e.TgZ(46,"mat-option",8),e._uU(47,"-"),e.qZA(),e.YNc(48,ee,2,2,"mat-option",9),e.qZA()()(),e.TgZ(49,"div",18)(50,"mat-form-field",6)(51,"mat-label"),e._uU(52),e.ALo(53,"translate"),e.qZA(),e.TgZ(54,"mat-select",19),e.NdJ("selectionChange",function(l){return i.readUnit(l)}),e.ALo(55,"translate"),e.TgZ(56,"mat-option",8),e._uU(57,"-"),e.qZA(),e.YNc(58,te,2,2,"mat-option",9),e.qZA()()(),e.TgZ(59,"div",20)(60,"mat-form-field",6)(61,"mat-label"),e._uU(62),e.ALo(63,"translate"),e.qZA(),e.TgZ(64,"mat-select",21),e.ALo(65,"translate"),e.TgZ(66,"mat-option",8),e._uU(67,"-"),e.qZA(),e.YNc(68,ie,2,2,"mat-option",9),e.qZA()()()(),e.TgZ(69,"div",4)(70,"div",22)(71,"mat-form-field",6)(72,"mat-label"),e._uU(73),e.ALo(74,"translate"),e.qZA(),e.TgZ(75,"input",23,24),e.NdJ("keyup.enter",function(){e.CHM(n);const l=e.MAs(76);return e.KtG(i.searchByCode(l.value))}),e.qZA()()(),e.TgZ(77,"div",5)(78,"ng-select",25),e.NdJ("change",function(l){return i.readCustumer(l)}),e.ALo(79,"translate"),e.YNc(80,ne,2,2,"ng-option",9),e.qZA()(),e.TgZ(81,"div",26)(82,"mat-form-field",6)(83,"mat-label"),e._uU(84),e.ALo(85,"translate"),e.qZA(),e._UZ(86,"input",27),e.qZA()(),e.TgZ(87,"div",22)(88,"mat-form-field",6)(89,"mat-label"),e._uU(90),e.ALo(91,"translate"),e.qZA(),e._UZ(92,"input",28),e.qZA()()(),e.TgZ(93,"div",4)(94,"div",29)(95,"mat-form-field",6)(96,"mat-label"),e._uU(97),e.ALo(98,"translate"),e.qZA(),e.TgZ(99,"input",30),e.NdJ("change",function(l){return i.onChangeTotal(l)}),e.qZA()()(),e.TgZ(100,"div",31)(101,"mat-form-field",6)(102,"mat-label"),e._uU(103),e.ALo(104,"translate"),e.qZA(),e._UZ(105,"input",32),e.qZA()(),e.TgZ(106,"div",33)(107,"mat-form-field",6)(108,"mat-label"),e._uU(109),e.ALo(110,"translate"),e.qZA(),e._UZ(111,"input",34),e.qZA()(),e.TgZ(112,"div",29)(113,"mat-form-field",6)(114,"mat-label"),e._uU(115),e.ALo(116,"translate"),e.qZA(),e._UZ(117,"input",35),e.qZA()()()()(),e.TgZ(118,"div",36)(119,"div",4),e.YNc(120,se,3,4,"button",37),e.TgZ(121,"button",38),e.NdJ("click",function(){return i.close()}),e._uU(122),e.ALo(123,"translate"),e.qZA()()()()}if(2&t){const n=e.MAs(25);e.xp6(1),e.Oqu(e.lcZ(2,30,"ADMIN_NAV.TaxInvoice")),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(7),e.hij(" ",e.lcZ(11,32,"HTML.BRANCH"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(13,34,"HTML.BRANCH")),e.xp6(4),e.Q6J("ngForOf",i.AllBranches),e.xp6(4),e.Oqu(e.lcZ(21,36,"HTML.ContractDate")),e.xp6(2),e.Q6J("matDatepicker",n),e.xp6(1),e.Q6J("for",n),e.xp6(6),e.hij(" ",e.lcZ(30,38,"OPTIONS.Year"),""),e.xp6(6),e.hij(" ",e.lcZ(36,40,"OPTIONS.Month"),""),e.xp6(7),e.hij(" ",e.lcZ(43,42,"HTML.BUILDING"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(45,44,"HTML.BUILDING")),e.xp6(4),e.Q6J("ngForOf",i.AllBuilding),e.xp6(4),e.hij(" ",e.lcZ(53,46,"HTML.UNIT"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(55,48,"HTML.UNIT")),e.xp6(4),e.Q6J("ngForOf",i.AllUnitsForBuilding),e.xp6(4),e.hij(" ",e.lcZ(63,50,"HTML.OWNER"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(65,52,"HTML.OWNER")),e.xp6(4),e.Q6J("ngForOf",i.AllOwners),e.xp6(5),e.Oqu(e.lcZ(74,54,"HTML.CODE_TENANT")),e.xp6(5),e.s9C("placeholder",e.lcZ(79,56,"HTML.TENANT")),e.xp6(2),e.Q6J("ngForOf",i.AllTenants),e.xp6(4),e.hij(" ",e.lcZ(85,58,"HTML.DOC_NUMBER"),""),e.xp6(6),e.hij(" ",e.lcZ(91,60,"HTML.Serial"),""),e.xp6(7),e.hij(" ",e.lcZ(98,62,"HTML.TotalValueWithoutTax"),""),e.xp6(6),e.hij(" ",e.lcZ(104,64,"HTML.TaxPercent"),""),e.xp6(6),e.hij(" ",e.lcZ(110,66,"HTML.TaxValue"),""),e.xp6(6),e.hij(" ",e.lcZ(116,68,"HTML.NetValueWithTax"),""),e.xp6(5),e.Q6J("ngIf",i.data.invoiceRow&&i.can("change_taxinvoice")||!i.data.invoiceRow&&i.can("add_taxinvoice")),e.xp6(2),e.Oqu(e.lcZ(123,70,"BTN.CANCEL"))}},dependencies:[A.sg,A.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,T.xw,T.Wh,T.yH,$.ey,M.lW,L.Mq,L.hl,L.nW,d.ZT,d.uh,d.xY,d.H8,w.Nt,N.KE,N.hX,N.R9,X.gD,U.w9,U.jq,F.X$]});var re=s(7298),le=s(5346),ce=s(1182),he=s(7465),ue=s(5298),B=s(811),de=s(3546),me=s(7392),pe=s(4850),ge=s(1572),ve=s(266),fe=s(1419);function Te(a,t){if(1&a){const i=e.EpF();e.TgZ(0,"mat-button-toggle",21),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.gotoNewInvoice(null))}),e.TgZ(1,"mat-icon"),e._uU(2,"note_add"),e.qZA()()}}function xe(a,t){if(1&a){const i=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(i);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.openDialog(o))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"edit"),e.qZA()()}2&a&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.VIEW"))}function Ie(a,t){if(1&a){const i=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(i);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.removeInvoice(o.id))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"delete"),e.qZA()()}2&a&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.REMOVE"))}function be(a,t){if(1&a&&(e.TgZ(0,"div",22)(1,"div",23),e._uU(2),e._UZ(3,"br"),e._uU(4),e.qZA(),e.TgZ(5,"div",23),e._uU(6),e.qZA(),e.TgZ(7,"div",23),e._uU(8),e.qZA(),e.TgZ(9,"div",23),e._uU(10),e.qZA(),e.TgZ(11,"div",23),e._uU(12),e.qZA(),e.TgZ(13,"div",23),e._uU(14),e.qZA(),e.TgZ(15,"div",23),e._uU(16),e.qZA(),e.TgZ(17,"div",23)(18,"div",24),e.YNc(19,xe,4,3,"button",25),e.YNc(20,Ie,4,3,"button",26),e.qZA()()()),2&a){const i=t.$implicit,n=e.oxw();e.Tol(n.statusColor[i.INVPayType]),e.xp6(2),e.Oqu(i.build_Name),e.xp6(2),e.Oqu(i.branch_ArbName),e.xp6(2),e.Oqu(i.unit_UnitNumber),e.xp6(2),e.hij(" ",i.CUSKeyField_CUSName," "),e.xp6(2),e.hij(" ",i.CUSKeyField_CUSMobile," "),e.xp6(2),e.hij(" ",i.INVDate," "),e.xp6(2),e.AsE(" (",i.INVSerial," / ",i.RCOSubCode,") "),e.xp6(2),e.hij(" ",i.owner_FullName," "),e.xp6(3),e.Q6J("ngIf",n.can("view_onetaxinvoice")||0==n.account.periorty),e.xp6(1),e.Q6J("ngIf",n.can("delete_taxinvoice"))}}function Ce(a,t){if(1&a){const i=e.EpF();e.TgZ(0,"div",29)(1,"div",30)(2,"mat-card",31)(3,"pagination-controls",32),e.NdJ("pageChange",function(o){e.CHM(i);const l=e.oxw();return e.KtG(l.onPageChanged(o))}),e.qZA()()()()}}function Ae(a,t){1&a&&(e.TgZ(0,"div",33),e._UZ(1,"mat-spinner",34),e.qZA())}const Se=function(a,t){return{itemsPerPage:a,currentPage:t}};class x{constructor(t,i,n,o,l,h,m,p,r,u,C){this.transferService=t,this.dataService=i,this.appSettings=n,this.activatedRoute=o,this.dialog=l,this.invService=h,this.router=m,this.global=p,this.localStore=r,this.translateService=u,this.snackBar=C,this.statusColor={C:"make-white",B:"make-gold",E:"make-yellowgreen",T:"make-yellow"},this.curCOMId=Y.N.comid,this.account=new q.n,this.count=4,this.userPerm=[],this.settings=this.appSettings.settings}ngOnInit(){if(this.securityForApp=(new v.$).getSecurityType(),this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.contForTenant=this.activatedRoute.params.subscribe(t=>{t.tenantid?(this.idForTenant=+t.tenantid,console.log("params['tenantid']:: "+this.idForTenant)):this.idForTenant=0}),console.log("line 93 this.idForTenant:: "+this.idForTenant),this.invFilterString="M="+this.curCOMId+"&C="+this.curUserData.periorty+"&usr=all",this.prepareMsgLanguage(),this.getInvoices()}else this.router.navigate(["/sign-in"])}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getInvoices(){this.contractsAll=null,this.curUserData.is_superuser?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.contractsAll=t):this.invService.getAllInvoices(this.curCOMId,this.account.periorty).subscribe(t=>this.contractsAll=t):"T"==this.curUserData.is_owner?this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.contractsAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&owner="+this.curUserData.owner_KeyField).subscribe(t=>this.contractsAll=t):"T"==this.curUserData.is_employee?("N"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.contractsAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&branch="+this.account.branch_KeyField).subscribe(t=>this.contractsAll=t)),"D"==this.securityForApp&&(this.idForTenant>0?this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.idForTenant).subscribe(t=>this.contractsAll=t):this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&user="+this.account.id).subscribe(t=>this.contractsAll=t))):0==this.curUserData.periorty&&(this.curCustomerID=this.account.customer_KeyField??0,this.invService.getInvoicesPerSpecOneString(this.invFilterString+"&customer="+this.curCustomerID).subscribe(t=>this.contractsAll=t))}removeInvoice(t){this.dialog.open(k.$,{maxWidth:"400px",data:{title:this.deletedTitleMsg,message:this.askToDeletedMsg}}).afterClosed().subscribe(n=>{n&&this.invService.deleteInvoice(t).subscribe(o=>this.getInvoices())})}openDialog(){}onPageChanged(t){this.page=t,this.getInvoices(),window.scrollTo(0,0)}printEInvoice(){}gotoNewInvoice(t){this.dialog.open(f,{data:{invoiceRow:t,periorty:this.account.periorty,curUserData:this.curUserData,userPerm:this.userPerm,COMId:this.curCOMId},panelClass:["theme-dialog"],autoFocus:!1,direction:this.settings.rtl?"rtl":"ltr"}).afterClosed().subscribe(n=>{"Cancel"==n.event||("Patch"==n.event?this.invService.editInvoice(n.data,n.data.id).subscribe(o=>{this.snackBar.open("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.getInvoices()},o=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):"Post"==n.event&&this.invService.addInvoice(n.data).subscribe(o=>{this.snackBar.open("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.getInvoices()},o=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}))})}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(t=>{this.deletedTitleMsg=t})}}x.\u0275fac=function(t){return new(t||x)(e.Y36(re.y),e.Y36(le.n),e.Y36(ce.d),e.Y36(y.gz),e.Y36(d.uw),e.Y36(_.q),e.Y36(y.F0),e.Y36(he.U),e.Y36(ue.C),e.Y36(F.sK),e.Y36(O.ux))},x.\u0275cmp=e.Xpm({type:x,selectors:[["app-invoice-list"]],features:[e._Bn([_.q])],decls:64,vars:43,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"p-2"],["fxLayout","row"],["appearance","legacy"],["controls","matButtonToggleGroup"],["value","add",3,"click",4,"ngIf"],["value","search"],[1,"user-search"],[1,"user-search-input"],["matInput","","name","search","autocomplete","off",3,"placeholder","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-between center"],["appearance","legacy","value","list"],["viewType","matButtonToggleGroup"],["value","list"],["value","grid"],["fxLayout","row wrap","fxLayoutAlign","space-between center",1,"w-100","p-3"],[1,"mat-mdc-table","admin-table"],[1,"mat-mdc-header-row"],[1,"mat-mdc-header-cell"],["class","mat-mdc-row",3,"class",4,"ngFor","ngForOf"],["fxLayout","row wrap",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","user-spinner",4,"ngIf"],["value","add",3,"click"],[1,"mat-mdc-row"],[1,"mat-mdc-cell"],[1,"p-2","actions"],["mat-mini-fab","","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"matTooltip","click"],["mat-mini-fab","","color","warn",3,"matTooltip","click"],["fxLayout","row wrap"],["fxFlex","100",1,"p-2"],[1,"text-center"],["autoHide","true","maxSize","5",1,"product-pagination",3,"pageChange"],["fxLayout","column","fxLayoutAlign","center center",1,"user-spinner"],["color","primary"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-button-toggle-group",2,3),e.YNc(4,Te,3,0,"mat-button-toggle",4),e.TgZ(5,"mat-button-toggle",5)(6,"mat-icon"),e._uU(7,"search"),e.qZA()()()(),e.TgZ(8,"form",6)(9,"mat-form-field",7)(10,"input",8),e.NdJ("ngModelChange",function(o){return i.searchText=o}),e.ALo(11,"translate"),e.qZA()()(),e.TgZ(12,"div",9)(13,"mat-button-toggle-group",10,11)(15,"mat-button-toggle",12)(16,"mat-icon"),e._uU(17,"view_list"),e.qZA()(),e.TgZ(18,"mat-button-toggle",13)(19,"mat-icon"),e._uU(20,"view_module"),e.qZA()()()()(),e._UZ(21,"mat-divider"),e.TgZ(22,"mat-card")(23,"div",14)(24,"h2"),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e._UZ(27,"mat-divider"),e.TgZ(28,"div",15)(29,"div",16)(30,"div",17)(31,"h3"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div",17)(35,"h3"),e._uU(36),e.ALo(37,"translate"),e.qZA()(),e.TgZ(38,"div",17)(39,"h3"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"div",17)(43,"h3"),e._uU(44),e.ALo(45,"translate"),e.qZA()(),e.TgZ(46,"div",17)(47,"h3"),e._uU(48),e.ALo(49,"translate"),e.qZA()(),e.TgZ(50,"div",17)(51,"h3"),e._uU(52),e.ALo(53,"translate"),e.qZA()(),e.TgZ(54,"div",17)(55,"h3"),e._uU(56),e.ALo(57,"translate"),e.qZA()(),e._UZ(58,"div",17),e.qZA(),e.YNc(59,be,21,13,"div",18),e.ALo(60,"paginate"),e.ALo(61,"InvoiceSearchPipe"),e.qZA()(),e.YNc(62,Ce,4,0,"div",19),e.YNc(63,Ae,2,0,"div",20)),2&t){const n=e.MAs(3);e.xp6(4),e.Q6J("ngIf",i.can("add_taxinvoice")),e.xp6(4),e.ekj("show","search"==n.value),e.xp6(2),e.s9C("placeholder",e.lcZ(11,16,"HTML.SEARCH_INVOICE")),e.Q6J("ngModel",i.searchText),e.xp6(15),e.Oqu(e.lcZ(26,18,"HTML.Invoice_List")),e.xp6(7),e.hij(" ",e.lcZ(33,20,"HTML.BUILDING")," "),e.xp6(4),e.hij(" ",e.lcZ(37,22,"HTML.UnitNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(41,24,"HTML.TENANT")," "),e.xp6(4),e.hij(" ",e.lcZ(45,26,"HTML.MOBILE")," "),e.xp6(4),e.hij(" ",e.lcZ(49,28,"HTML.Date")," "),e.xp6(4),e.hij(" ",e.lcZ(53,30,"HTML.Serial")," "),e.xp6(4),e.hij(" ",e.lcZ(57,32,"HTML.OWNER")," "),e.xp6(3),e.Q6J("ngForOf",e.xi3(60,34,e.xi3(61,37,i.contractsAll,i.searchText),e.WLB(40,Se,i.count,i.page))),e.xp6(3),e.Q6J("ngIf",i.contractsAll),e.xp6(1),e.Q6J("ngIf",!i.contractsAll)}},dependencies:[A.sg,A.O5,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F,Z.LS,T.xw,T.Wh,T.yH,M.nh,B.A9,B.Yi,de.a8,me.Hw,w.Nt,N.KE,pe.d,ge.Ou,ve.gM,Z._s,fe.s4,F.X$],styles:[".user-name{padding:0 12px;font-weight:400}.user-content{padding:10px}.user-content .user-img{position:relative}.user-content .user-img img{border-radius:50%;width:80px;height:80px}.user-content .user-img img.blocked{opacity:.5}.user-content .user-img .mat-icon{position:absolute;top:-8px;left:-8px;font-size:96px;height:96px;width:96px}.user-content .mat-mdc-slide-toggle{margin-top:15px}.user-content .user-details span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-content .user-details .mat-icon{padding:2px 10px}.user-content .user-details.blocked{opacity:.5}.user-search{width:0;overflow:hidden;transition:.3s}.user-search .mat-mdc-form-field{width:100%!important;text-align:center!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-infix{min-height:36px;padding:8px 0!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.user-search .mat-mdc-input-element{text-align:center}.user-search.show{width:100%;overflow:visible}.user-spinner{position:absolute;inset:0}.mat-mdc-card{overflow:hidden}table{width:100%}.make-gold{background-color:#fbea96}.make-yellow{background-color:#ff4500}.make-yellowgreen{background-color:#ad7020}.make-white{background-color:#fff}\n"],encapsulation:2});class I{}I.\u0275fac=function(t){return new(t||I)},I.\u0275cmp=e.Xpm({type:I,selectors:[["app-invoice-details"]],decls:2,vars:0,template:function(t,i){1&t&&(e.TgZ(0,"p"),e._uU(1,"invoice-details works!"),e.qZA())}});const V=[{path:"",redirectTo:"invoice-list",pathMatch:"full"},{path:"invoice-list",component:x,pathMatch:"full",data:{breadcrumb:"TaxInvoice"}},{path:"invoice-add/:id",component:f,data:{breadcrumb:"EditTaxInvoice"}},{path:"invoice-add",component:I,data:{breadcrumb:"AddTaxInvoice"}},{path:"expinvoice-list",component:x,pathMatch:"full",data:{breadcrumb:"ExpensesInvoice"}},{path:"expinvoice-add/:id",component:f,data:{breadcrumb:"EditExpensesInvoice"}},{path:"expinvoice-add",component:I,data:{breadcrumb:"AddExpensesInvoice"}}];class b{}b.\u0275fac=function(t){return new(t||b)},b.\u0275mod=e.oAB({type:b}),b.\u0275inj=e.cJS({imports:[A.ez,y.Bz.forChild(V),E.JF,c.u5,Z.JX,J.D,c.UX,K.m,Z.JX,U.A0]})}}]);