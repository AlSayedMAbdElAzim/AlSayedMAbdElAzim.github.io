"use strict";(self.webpackChunkemporium=self.webpackChunkemporium||[]).push([[624],{6002:(x,I,o)=>{o.d(I,{Z:()=>g});var p=o(5521),A=o(2340),r=o(4650),C=o(1182),M=o(529),O=o(7465);class g{constructor(a,n,t){this.appSettings=a,this.http=n,this.globalServ=t,this.curCOMId=A.N.comid,this.baseUrl=this.appSettings.settings.url,this.secondPartUrl=new p.P(this.baseUrl).api_constant}getAllBranch(a,n){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/allBranches/?M="+a+"&C="+n,this.globalServ.getAuthHeaders())}getOneBranch(a){return console.log(this.baseUrl+this.secondPartUrl+"atlas/branch/"+a+"/"),this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/"+a+"/",this.globalServ.getAuthHeaders())}getMainBranch(a,n){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/branchPerSpec/?M="+a+"&C="+n+"&Main=T",this.globalServ.getAuthHeaders())}getBranchPerEmp(a,n,t){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/branchPerSpec/?M="+a+"&C="+n+"&emp="+t,this.globalServ.getAuthHeaders())}getBranchPerOwner(a,n,t){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/branchPerSpec/?M="+a+"&C="+n+"&owner="+t,this.globalServ.getAuthHeaders())}sendTaqnyatSMS(a,n,t,u){return this.http.get(this.baseUrl+this.secondPartUrl+"atlas/branch/sendSMS/?M="+a+"&C="+n+"&recipients="+t+"&msg="+u,this.globalServ.getAuthHeaders())}sendSms(a,n,t){return this.http.post(a,n,this.globalServ.smsHeaders(t))}sendSmsData(a,n){const t=new FormData;return t.append("bearerTokens",n),t.append("sender","Jeddah Lake"),t.append("recipients","966503002323"),t.append("body","125478"),this.http.post(a,t,this.globalServ.smsHeaders(n))}sendSmsGet(a){return this.http.get(a)}sendSmsGetToken(a,n){return this.http.get(a,this.globalServ.smsHeaders(n))}addBranch(a){return this.http.post(this.baseUrl+this.secondPartUrl+"atlas/branch/",a,this.globalServ.getAuthHeaders())}editBranch(a,n){return this.http.put(this.baseUrl+this.secondPartUrl+"atlas/branch/"+n+"/",a,this.globalServ.getAuthHeaders())}deleteBranch(a){return this.http.delete(this.baseUrl+this.secondPartUrl+"atlas/branch/"+a+"/",this.globalServ.getAuthHeaders())}softDeleteBranch(a){return this.http.put(this.baseUrl+this.secondPartUrl+"atlas/branch/"+a+"/",{RowDelete:1},this.globalServ.getAuthHeaders())}}g.\u0275fac=function(a){return new(a||g)(r.LFG(C.d),r.LFG(M.eN),r.LFG(O.U))},g.\u0275prov=r.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"})},624:(x,I,o)=>{o.r(I),o.d(I,{SignInModule:()=>m,routes:()=>w});var p=o(6895),A=o(9132),r=o(4006),C=o(589),M=o(5861),O=o(8955),g=o(3071),b=o(2340),a=o(5783),n=o(5412),t=o(4650),u=o(1576),E=o(4859),Z=o(4144),d=o(9549),T=o(3081);function D(l,s){1&l&&(t.TgZ(0,"mat-error"),t._uU(1,"Code is required"),t.qZA())}class f{constructor(s,e,h){this.dialogRef=s,this.data=e,this.fb=h}ngOnInit(){this.form=this.fb.group({otp:[null,r.kI.required]})}onSubmit(){console.log(this.form.value),this.form.valid&&this.dialogRef.close(this.form.value)}onSave(){this.form.valid&&(this.action="Ok",this.dialogRef.close({event:this.action,data:this.form.value}))}close(){this.action="Cancel",this.dialogRef.close({event:this.action})}}f.\u0275fac=function(s){return new(s||f)(t.Y36(n.so),t.Y36(n.WI),t.Y36(r.QS))},f.\u0275cmp=t.Xpm({type:f,selectors:[["app-otp-dialog"]],decls:21,vars:16,consts:[["mat-dialog-title",""],["autocomplete","off",3,"formGroup"],["mat-dialog-content",""],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-sm","90.0",1,"px-1"],["appearance","outline",1,"w-100"],["matInput","","formControlName","otp","required",""],[4,"ngIf"],["mat-dialog-actions",""],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["mat-raised-button","","color","primary",3,"mat-dialog-close","disabled","click"],["mat-raised-button","","color","warn",3,"click"]],template:function(s,e){1&s&&(t.TgZ(0,"h4",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"form",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"mat-form-field",5)(8,"mat-label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._UZ(11,"input",6),t.YNc(12,D,2,0,"mat-error",7),t.qZA()()()(),t.TgZ(13,"div",8)(14,"div",9)(15,"button",10),t.NdJ("click",function(){return e.onSave()}),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"button",11),t.NdJ("click",function(){return e.close()}),t._uU(19),t.ALo(20,"translate"),t.qZA()()()()),2&s&&(t.xp6(1),t.Oqu(t.lcZ(2,8,e.data.cttRow)),t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(6),t.Oqu(t.lcZ(10,10,"HTML.OTPCode")),t.xp6(3),t.Q6J("ngIf",null==e.form.controls.otp.errors?null:e.form.controls.otp.errors.required),t.xp6(3),t.Q6J("mat-dialog-close",e.form.value)("disabled",!e.form.valid),t.xp6(1),t.Oqu(t.lcZ(17,12,"BTN.OK")),t.xp6(3),t.Oqu(t.lcZ(20,14,"BTN.CANCEL")))},dependencies:[p.O5,r._Y,r.Fj,r.JJ,r.JL,r.Q7,r.sg,r.u,u.xw,u.Wh,u.yH,E.lW,n.ZT,n.uh,n.xY,n.H8,Z.Nt,d.KE,d.hX,d.TO,T.X$]});var F=o(4459),N=o(7009),B=o(5298),R=o(7465),G=o(2854),H=o(4165),Y=o(6002),J=o(1182),k=o(3546),q=o(7392);function Q(l,s){1&l&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&l&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"HTML.USERNAMEREQ")))}function K(l,s){1&l&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&l&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MESSAGE.MinLength")))}function V(l,s){1&l&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&l&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"HTML.PasswordREQ")))}function W(l,s){1&l&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&l&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MESSAGE.MinLength6")))}class v{constructor(s,e,h,i,U,P,L,y,c,S,X,z){this.formBuilder=s,this.router=e,this.snackBar=h,this.localStore=i,this.userService=U,this.global=P,this.staff=L,this.settingService=y,this.dialog=c,this.translateService=S,this.atlasService=X,this.appSettings=z,this.curCOMId=b.N.comid,this.curBraId=b.N.braid,this.account=new a.n,this.codeForSendOTP=(new F.$).getisAppSendOTP(),this.codeForOTPLength=(new F.$).getlengthOfOTP(),this.allowedChar="1234567890",this.settings=this.appSettings.settings}ngOnInit(){this.getParamValueLegnthOfOTP(this.curCOMId,0,this.codeForOTPLength),this.getParamValueAppSendOTP(this.curCOMId,0,this.codeForSendOTP),this.loginForm=this.formBuilder.group({username:["",r.kI.compose([r.kI.required,r.kI.minLength(3)])],password:["",r.kI.compose([r.kI.required,r.kI.minLength(6)])]}),this.registerForm=this.formBuilder.group({username:["",r.kI.compose([r.kI.required,r.kI.minLength(3)])],first_name:["",r.kI.compose([r.kI.required,r.kI.minLength(3)])],email:["",r.kI.compose([r.kI.required,O.Le])],password:["",r.kI.required],confirmPassword:["",r.kI.required]},{validator:(0,O.zi)("password","confirmPassword")}),this.prepareMsgLanguage(),this.setInitialValues()}getParamValueLegnthOfOTP(s,e,h){this.settingService.getValueForCode(s,e,h).subscribe(i=>{if(i&&i.length>0&&i[0].APAValue)return this.lengthOfCode=i[0].APAValue,i[0].APAValue},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u062e\u064a\u0627\u0631\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getParamValueAppSendOTP(s,e,h){this.settingService.getValueForCode(s,e,h).subscribe(i=>{if(i&&i.length>0&&i[0].APAValue)return this.appSendOTP=i[0].APAValue,i[0].APAValue},i=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u062e\u064a\u0627\u0631\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}prepareMsgLanguage(){this.translateService.get("MESSAGE.LOGGEDIN").subscribe(s=>{this.loggedInMsg=s}),this.translateService.get("MESSAGE.NOTLOGGEDIN").subscribe(s=>{this.notLoggedInMsg=s}),this.translateService.get("MESSAGE.REGISTERD").subscribe(s=>{this.registeredMsg=s}),this.translateService.get("MESSAGE.NOTREGISTERD").subscribe(s=>{this.notRegisteredMsg=s}),this.translateService.get("MESSAGE.EnterMsgSentTo").subscribe(s=>{this.enterMsgSentTo=s})}getOneUser(s){console.log("**** sign-in.component line 103 *****getOneUser::: "+s),this.staff.getOneUserbyId(s).subscribe(e=>{this.global.me=e,console.log(e.userPicture)})}resetPassword(){console.log("----------------------reset Password","check for Calling"),this.router.navigate(["resetpassword"])}onLoginFormSubmit(s){this.loginForm.valid&&this.userService.login(this.loginForm).subscribe(e=>{console.log("========*-*-*-*-*-*-*-*-*-*-*-*-*======="),console.log("---open OTP dialog-----"),console.log("mobile: "+e.user.UserMobile),console.log("COMId: "+e.user.COMId),"YES"!=this.appSendOTP.toUpperCase()||e.user.is_superuser?(localStorage.setItem("pointer","signinReload"),this.localStore.setItem("token",e.token),this.global.me=e.user,this.global.userLoggedIn=!0,localStorage.setItem("windowCount","1"),this.localStore.setItem("smsCode","Accepted"),this.localStore.setItem("signedIn","Done"),this.settingService.getAppSetup(e.user.COMId,0).subscribe(h=>{this.localStore.setItem("appsetup",JSON.stringify(h[0]))}),this.userService.getUserPermission(e.user.id).subscribe(h=>{this.localStore.setItem("permissions",JSON.stringify(h.user_permissions))}),this.snackBar.open(this.loggedInMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.waitAndNavigate()):this.openOTPDialog(e.user,e.token,e.user.id,e.user.UserMobile,e.user.COMId),console.log("---Wait for OTP dialog-------")},e=>{console.log("========*-*-*-*-*-*Error not Connected-*-*-*-*-*======="),this.global.userLoggedIn=!1,this.snackBar.open(this.notLoggedInMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}),this.router.navigate(["/"]).then(()=>{window.location.reload()})})}delay(s){return new Promise(e=>setTimeout(e,s))}waitAndNavigate(){var s=this;return(0,M.Z)(function*(){yield s.delay(2e3),s.router.navigate(["/"]).then(()=>{window.location.reload()})})()}onRegisterFormSubmit(s){this.registerForm.valid?this.userService.registerUser(this.registerForm).subscribe(e=>{this.snackBar.open(this.registeredMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.router.navigate(["/units/unit"])},e=>{console.log("error",e),this.snackBar.open(this.notRegisteredMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):(console.log("this.registerForm not valid"),this.snackBar.open(this.notRegisteredMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}))}setInitialValues(){this.newUser={id:null,username:"",UserCode:null,first_name:"",last_name:"",UserBirthDate:null,EntryDate:null,joinedDate:null,UserMobile:"",email:"",is_superuser:!1,is_staff:!1,is_active:!0,is_employee:"T",periorty:0,COMId:this.curCOMId,branch_KeyField:null,customer_KeyField:null,userPicture:null,gender:"",password:"",repassword:"",is_teacher:"F",RowDelete:0,LoginFrom:"N",userJobName:"",userFacebook:"",userTwitter:"",userGoogle:"",userAddress:""}}mapRegisterFormTo_UserClass(){this.newUser.username=this.registerForm.value.username,this.newUser.email=this.registerForm.value.email,this.newUser.password=this.registerForm.value.password,this.newUser.repassword=this.registerForm.value.confirmPassword}mapToOneUser(){this.oneuser.username=this.registerForm.value.username,this.oneuser.email=this.registerForm.value.email}openOTPDialog(s,e,h,i,U){var P=i.substring(i.length-3);console.log("=====this.codeForOTPLength-*=-*=-*=-*=:: "+this.codeForOTPLength),this.localStore.setItem("token",e),this.otpCode=this.createRandomString(this.lengthOfCode,this.allowedChar),console.log("-*=-*=-*=-*=-*=-*=-*=-*=-*=-*=-*=-*="),console.log("=====this.otpCode-*=-*=-*=-*=:: "+this.otpCode),console.log("-*=-*=-*=-*=-*=-*=-*=-*=-*=-*=-*=-*="),this.atlasService.sendTaqnyatSMS(this.curCOMId,0,i,this.settings.name+" \u0623\u0631\u0633\u0644 \u0627\u0644\u064a\u0643 \u0627\u0644\u0643\u0648\u062f "+this.otpCode+" \u0641\u0636\u0644\u0627\u064b \u0627\u0633\u062a\u062e\u062f\u0645\u0647 \u0644\u0644\u062f\u062e\u0648\u0644").subscribe(c=>{console.log("-----sendTaqnyatSMS response:: ",c)},c=>{console.log("-----sendTaqnyatSMS error:: ",c)}),this.dialog.open(f,{data:{cttRow:this.enterMsgSentTo+"  "+P+"*******"},panelClass:["theme-dialog"],autoFocus:!1,direction:this.settings.rtl?"rtl":"ltr"}).afterClosed().subscribe(c=>{"Cancel"==c.event?(this.global.userLoggedIn=!1,this.snackBar.open(this.notLoggedInMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}),this.router.navigate(["/"]).then(()=>{window.location.reload()})):"Ok"==c.event&&(c.data.otp==this.otpCode?(localStorage.setItem("pointer","signinReload"),console.log("---EQUAL----"),this.localStore.setItem("token",e),this.global.me=s,this.global.userLoggedIn=!0,localStorage.setItem("windowCount","1"),this.localStore.setItem("smsCode","Accepted"),this.localStore.setItem("signedIn","Done"),this.settingService.getAppSetup(U,0).subscribe(S=>{this.localStore.setItem("appsetup",JSON.stringify(S[0]))}),this.userService.getUserPermission(h).subscribe(S=>{this.localStore.setItem("permissions",JSON.stringify(S.user_permissions))}),this.snackBar.open(this.loggedInMsg,"\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.waitAndNavigate()):(console.log("---not EQUAL----"),this.global.userLoggedIn=!1,this.snackBar.open(this.notLoggedInMsg,"\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3}),this.router.navigate(["/"]).then(()=>{window.location.reload()})),console.log("---------------------------"))})}createRandomString(s,e){let h="";for(let i=0;i<s;i++)h+=e.charAt(Math.floor(Math.random()*e.length));return h}}v.\u0275fac=function(s){return new(s||v)(t.Y36(r.QS),t.Y36(A.F0),t.Y36(N.ux),t.Y36(B.C),t.Y36(g.K),t.Y36(R.U),t.Y36(G.x),t.Y36(H.g),t.Y36(n.uw),t.Y36(T.sK),t.Y36(Y.Z),t.Y36(J.d))},v.\u0275cmp=t.Xpm({type:v,selectors:[["app-sign-in"]],features:[t._Bn([g.K])],decls:32,vars:21,consts:[[1,"p-4"],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-sm","50",1,"p-3"],[1,"text-muted","text-center","mb-3"],[3,"formGroup"],["appearance","outline",1,"w-100","mt-2"],["matInput","","formControlName","username","required","",3,"placeholder"],[4,"ngIf"],["appearance","outline",1,"w-100","mt-1"],["matInput","","formControlName","password","type","password","required","",3,"placeholder"],[1,"text-center","mt-2"],["mat-fab","","color","primary",1,"mat-elevation-z6",3,"click"],["fxLayout","row","fxLayoutAlign","space-between center",1,"mt-3"],[1,"divider","w-100"],[1,"text-muted","auth"]],template:function(s,e){1&s&&(t.TgZ(0,"mat-card",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"form",4)(7,"mat-form-field",5)(8,"mat-label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._UZ(11,"input",6),t.ALo(12,"translate"),t.YNc(13,Q,3,3,"mat-error",7),t.YNc(14,K,3,3,"mat-error",7),t.qZA(),t.TgZ(15,"mat-form-field",8)(16,"mat-label"),t._uU(17),t.ALo(18,"translate"),t.qZA(),t._UZ(19,"input",9),t.ALo(20,"translate"),t.YNc(21,V,3,3,"mat-error",7),t.YNc(22,W,3,3,"mat-error",7),t.qZA(),t.TgZ(23,"div",10)(24,"button",11),t.NdJ("click",function(){return e.onLoginFormSubmit(e.loginForm.value)}),t.TgZ(25,"mat-icon"),t._uU(26,"key"),t.qZA()()(),t.TgZ(27,"div",12),t._UZ(28,"div",13),t.TgZ(29,"h3",14),t._uU(30),t.qZA(),t._UZ(31,"div",13),t.qZA()()()()()),2&s&&(t.xp6(4),t.Oqu(t.lcZ(5,11,"HTML.SIGNIN")),t.xp6(2),t.Q6J("formGroup",e.loginForm),t.xp6(3),t.Oqu(t.lcZ(10,13,"HTML.USERNAME")),t.xp6(2),t.s9C("placeholder",t.lcZ(12,15,"HTML.USERNAME")),t.xp6(2),t.Q6J("ngIf",null==e.loginForm.controls.username.errors?null:e.loginForm.controls.username.errors.required),t.xp6(1),t.Q6J("ngIf",e.loginForm.controls.username.hasError("minlength")),t.xp6(3),t.Oqu(t.lcZ(18,17,"HTML.PASSWORD")),t.xp6(2),t.s9C("placeholder",t.lcZ(20,19,"HTML.PASSWORD")),t.xp6(2),t.Q6J("ngIf",null==e.loginForm.controls.password.errors?null:e.loginForm.controls.password.errors.required),t.xp6(1),t.Q6J("ngIf",e.loginForm.controls.password.hasError("minlength")),t.xp6(8),t.Oqu(e.settings.name))},dependencies:[p.O5,r._Y,r.Fj,r.JJ,r.JL,r.Q7,r.sg,r.u,u.xw,u.Wh,u.yH,E.cs,k.a8,q.Hw,Z.Nt,d.KE,d.hX,d.TO,T.X$],styles:[".auth[_ngcontent-%COMP%]{white-space:nowrap;padding:7px 14px;font-weight:500}"]});const w=[{path:"",component:v,pathMatch:"full"}];class m{}m.\u0275fac=function(s){return new(s||m)},m.\u0275mod=t.oAB({type:m}),m.\u0275inj=t.cJS({imports:[p.ez,A.Bz.forChild(w),r.UX,C.m]})}}]);