"use strict";(self.webpackChunkemporium=self.webpackChunkemporium||[]).push([[417],{8417:(B,A,c)=>{c.r(A),c.d(A,{PaymentsModule:()=>E,routes:()=>z});var m=c(6895),u=c(2340),P=c(5783),v=c(8910),x=c(2887),b=c(4459),e=c(4650),f=c(1182),g=c(5412),y=c(9132),D=c(7465),l=c(5298),h=c(8959),o=c(3081),i=c(7009),d=c(4006),C=c(4333),S=c(1576),N=c(4859),R=c(811),O=c(3546),j=c(7392),J=c(4144),Z=c(9549),H=c(4850),k=c(1572),Q=c(266),G=c(1419);function ee(s,t){if(1&s){const a=e.EpF();e.TgZ(0,"mat-button-toggle",21),e.NdJ("click",function(){e.CHM(a);const n=e.oxw();return e.KtG(n.gotoNewDocument())}),e.TgZ(1,"mat-icon"),e._uU(2,"note_add"),e.qZA()()}}const te=function(s){return["/payments/receivable-add/",s]};function ae(s,t){if(1&s&&(e.TgZ(0,"a",27),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"edit"),e.qZA()()),2&s){const a=e.oxw().$implicit;e.s9C("matTooltip",e.lcZ(1,2,"BTN.EDIT")),e.Q6J("routerLink",e.VKq(4,te,a.id))}}function ie(s,t){if(1&s){const a=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(a);const n=e.oxw().$implicit,p=e.oxw();return e.KtG(p.removeDocument(n.id))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"delete"),e.qZA()()}2&s&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.REMOVE"))}function oe(s,t){if(1&s&&(e.TgZ(0,"div",22)(1,"div",23),e._uU(2),e._UZ(3,"br"),e._uU(4),e.qZA(),e.TgZ(5,"div",23),e._uU(6),e.qZA(),e.TgZ(7,"div",23),e._uU(8),e.qZA(),e.TgZ(9,"div",23),e._uU(10),e.qZA(),e.TgZ(11,"div",23),e._uU(12),e.qZA(),e.TgZ(13,"div",23),e._uU(14),e.qZA(),e.TgZ(15,"div",23),e._uU(16),e.qZA(),e.TgZ(17,"div",23)(18,"div",24),e.YNc(19,ae,4,6,"a",25),e.YNc(20,ie,4,3,"button",26),e.qZA()()()),2&s){const a=t.$implicit,r=e.oxw();e.Tol(r.statusColor[a.PDOValueInAccount]),e.xp6(2),e.Oqu(a.build_Name),e.xp6(2),e.Oqu(a.branch_ArbName),e.xp6(2),e.Oqu(a.unit_UnitNumber),e.xp6(2),e.hij(" ",a.customer_Name," "),e.xp6(2),e.hij(" ",a.PDODocDate," "),e.xp6(2),e.hij(" ",a.PDOValue," "),e.xp6(2),e.hij(" ",a.PDOPrintedCode," "),e.xp6(2),e.hij(" ",a.PDOEjarCode," "),e.xp6(3),e.Q6J("ngIf",r.can("view_onereceivable")),e.xp6(1),e.Q6J("ngIf",r.can("delete_onereceivable"))}}function re(s,t){if(1&s){const a=e.EpF();e.TgZ(0,"div",29)(1,"div",30)(2,"mat-card",31)(3,"pagination-controls",32),e.NdJ("pageChange",function(n){e.CHM(a);const p=e.oxw();return e.KtG(p.onPageChanged(n))}),e.qZA()()()()}}function se(s,t){1&s&&(e.TgZ(0,"div",33),e._UZ(1,"mat-spinner",34),e.qZA())}const ne=function(s,t){return{itemsPerPage:s,currentPage:t}};class K{constructor(t,a,r,n,p,_,T,F,q){this.appSettings=t,this.dialog=a,this.paymentService=r,this.router=n,this.global=p,this.localStore=_,this.contractService=T,this.translateService=F,this.snackBar=q,this.statusColor={T:"make-white",F:"make-gold"},this.curCOMId=u.N.comid,this.account=new P.n,this.count=4,this.userPerm=[],this.settings=this.appSettings.settings}ngOnInit(){if(this.securityForApp=(new b.$).getSecurityType(),this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.prepareMsgLanguage(),this.getDocuments()}else this.router.navigate(["/sign-in"])}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getDocuments(){this.documentsAll=null,this.curUserData.is_superuser?this.paymentService.getAllReceivableDocuments(this.curCOMId,this.account.periorty).subscribe(t=>this.documentsAll=t):1==this.curUserData.periorty&&("N"==this.securityForApp&&this.paymentService.getAllReceivableDocumentsPerBranch(this.curCOMId,this.account.periorty,this.curUserData.branch_KeyField).subscribe(t=>this.documentsAll=t),"D"==this.securityForApp&&this.paymentService.getAllReceivableDocumentsPerEmp(this.curCOMId,this.account.periorty,this.curUserData.id).subscribe(t=>this.documentsAll=t))}removeDocument(t){this.dialog.open(x.$,{maxWidth:"400px",data:{title:this.deletedTitleMsg,message:this.askToDeletedMsg}}).afterClosed().subscribe(r=>{r&&(this.paymentService.getOneDocs(t).subscribe(n=>{null!=n.installment_KeyField&&(this.oneDocValue=n.PDOValue,this.contractService.getOneInstallment(n.installment_KeyField).subscribe(p=>{this.curInstallmentValue=p.INSValue,this.curInstallmentPayedValue=p.INSPayedValue,null==this.curInstallmentValue&&(this.curInstallmentValue=0),null==this.curInstallmentPayedValue&&(this.curInstallmentPayedValue=0),this.manageInstallmetPayedValue(n.installment_KeyField,this.curInstallmentValue,this.curInstallmentPayedValue,this.oneDocValue)}))}),this.paymentService.deleteDocument(t).subscribe(n=>this.getDocuments()))})}manageInstallmetPayedValue(t,a,r,n){null==r&&(r=0),null==n&&(n=0),null==a&&(a=0);let p=+r-+n;p<=0&&(p=0),this.insStatus=0==p?"N":"T";let _={id:t,INSStatus:this.insStatus,INSPayedValue:p};console.log("===installData:: "+_),this.contractService.editInstallments(_).subscribe(T=>{console.log("==installment after Update:: "+T)},T=>{console.log(T)})}onPageChanged(t){this.page=t,this.getDocuments(),window.scrollTo(0,0)}gotoNewDocument(){this.router.navigate(["/payments/receivable-add/"])}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(t=>{this.deletedTitleMsg=t})}}K.\u0275fac=function(t){return new(t||K)(e.Y36(f.d),e.Y36(g.uw),e.Y36(v.c),e.Y36(y.F0),e.Y36(D.U),e.Y36(l.C),e.Y36(h.W),e.Y36(o.sK),e.Y36(i.ux))},K.\u0275cmp=e.Xpm({type:K,selectors:[["app-receivable-doc-list"]],features:[e._Bn([v.c])],decls:64,vars:43,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"p-2"],["fxLayout","row"],["appearance","legacy"],["controls","matButtonToggleGroup"],["value","add",3,"click",4,"ngIf"],["value","search"],[1,"user-search"],[1,"user-search-input"],["matInput","","name","search","autocomplete","off",3,"placeholder","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-between center"],["appearance","legacy","value","list"],["viewType","matButtonToggleGroup"],["value","list"],["value","grid"],["fxLayout","row wrap","fxLayoutAlign","space-between center",1,"w-100","p-3"],[1,"mat-mdc-table","admin-table"],[1,"mat-mdc-header-row"],[1,"mat-mdc-header-cell"],["class","mat-mdc-row",3,"class",4,"ngFor","ngForOf"],["fxLayout","row wrap",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","user-spinner",4,"ngIf"],["value","add",3,"click"],[1,"mat-mdc-row"],[1,"mat-mdc-cell"],[1,"p-2","actions"],["mat-mini-fab","","color","primary",3,"routerLink","matTooltip",4,"ngIf"],["mat-mini-fab","","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"routerLink","matTooltip"],["mat-mini-fab","","color","warn",3,"matTooltip","click"],["fxLayout","row wrap"],["fxFlex","100",1,"p-2"],[1,"text-center"],["autoHide","true","maxSize","5",1,"product-pagination",3,"pageChange"],["fxLayout","column","fxLayoutAlign","center center",1,"user-spinner"],["color","primary"]],template:function(t,a){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-button-toggle-group",2,3),e.YNc(4,ee,3,0,"mat-button-toggle",4),e.TgZ(5,"mat-button-toggle",5)(6,"mat-icon"),e._uU(7,"search"),e.qZA()()()(),e.TgZ(8,"form",6)(9,"mat-form-field",7)(10,"input",8),e.NdJ("ngModelChange",function(n){return a.searchText=n}),e.ALo(11,"translate"),e.qZA()()(),e.TgZ(12,"div",9)(13,"mat-button-toggle-group",10,11)(15,"mat-button-toggle",12)(16,"mat-icon"),e._uU(17,"view_list"),e.qZA()(),e.TgZ(18,"mat-button-toggle",13)(19,"mat-icon"),e._uU(20,"view_module"),e.qZA()()()()(),e._UZ(21,"mat-divider"),e.TgZ(22,"mat-card")(23,"div",14)(24,"h2"),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e._UZ(27,"mat-divider"),e.TgZ(28,"div",15)(29,"div",16)(30,"div",17)(31,"h3"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div",17)(35,"h3"),e._uU(36),e.ALo(37,"translate"),e.qZA()(),e.TgZ(38,"div",17)(39,"h3"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"div",17)(43,"h3"),e._uU(44),e.ALo(45,"translate"),e.qZA()(),e.TgZ(46,"div",17)(47,"h3"),e._uU(48),e.ALo(49,"translate"),e.qZA()(),e.TgZ(50,"div",17)(51,"h3"),e._uU(52),e.ALo(53,"translate"),e.qZA()(),e.TgZ(54,"div",17)(55,"h3"),e._uU(56),e.ALo(57,"translate"),e.qZA()(),e._UZ(58,"div",17),e.qZA(),e.YNc(59,oe,21,12,"div",18),e.ALo(60,"paginate"),e.ALo(61,"PayDocumentsSearchPipe"),e.qZA()(),e.YNc(62,re,4,0,"div",19),e.YNc(63,se,2,0,"div",20)),2&t){const r=e.MAs(3);e.xp6(4),e.Q6J("ngIf",a.can("add_onereceivable")),e.xp6(4),e.ekj("show","search"==r.value),e.xp6(2),e.s9C("placeholder",e.lcZ(11,16,"HTML.SEARCH_PayDocument")),e.Q6J("ngModel",a.searchText),e.xp6(15),e.Oqu(e.lcZ(26,18,"HTML.ReceivableDoc_List")),e.xp6(7),e.hij(" ",e.lcZ(33,20,"HTML.BUILDING")," "),e.xp6(4),e.hij(" ",e.lcZ(37,22,"HTML.UnitNumber")," "),e.xp6(4),e.hij(" ",e.lcZ(41,24,"HTML.TENANT")," "),e.xp6(4),e.hij(" ",e.lcZ(45,26,"HTML.DocDate")," "),e.xp6(4),e.hij(" ",e.lcZ(49,28,"HTML.DocValue")," "),e.xp6(4),e.hij(" ",e.lcZ(53,30,"HTML.DocPrintedNo")," "),e.xp6(4),e.hij(" ",e.lcZ(57,32,"HTML.PayDocEjarCode")," "),e.xp6(3),e.Q6J("ngForOf",e.xi3(60,34,e.xi3(61,37,a.documentsAll,a.searchText),e.WLB(40,ne,a.count,a.page))),e.xp6(3),e.Q6J("ngIf",a.documentsAll),e.xp6(1),e.Q6J("ngIf",!a.documentsAll)}},dependencies:[d._Y,d.Fj,d.JJ,d.JL,d.On,d.F,C.LS,m.sg,m.O5,y.rH,S.xw,S.Wh,S.yH,N.Tq,N.nh,R.A9,R.Yi,O.a8,j.Hw,J.Nt,Z.KE,H.d,k.Ou,Q.gM,C._s,G.dg,o.X$],styles:[".user-name{padding:0 12px;font-weight:400}.user-content{padding:10px}.user-content .user-img{position:relative}.user-content .user-img img{border-radius:50%;width:80px;height:80px}.user-content .user-img img.blocked{opacity:.5}.user-content .user-img .mat-icon{position:absolute;top:-8px;left:-8px;font-size:96px;height:96px;width:96px}.user-content .mat-mdc-slide-toggle{margin-top:15px}.user-content .user-details span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-content .user-details .mat-icon{padding:2px 10px}.user-content .user-details.blocked{opacity:.5}.user-search{width:0;overflow:hidden;transition:.3s}.user-search .mat-mdc-form-field{width:100%!important;text-align:center!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-infix{min-height:36px;padding:8px 0!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.user-search .mat-mdc-input-element{text-align:center}.user-search.show{width:100%;overflow:visible}.user-spinner{position:absolute;inset:0}.mat-mdc-card{overflow:hidden}table{width:100%}.make-gold{background-color:#fbea96}.make-white{background-color:#fff}\n"],encapsulation:2});class W{}var $=c(6381),X=c(5726),le=c(3238),U=c(9602),ce=c(4385),I=c(8796);function ue(s,t){1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.ADD")))}function de(s,t){1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.EDIT")))}function pe(s,t){if(1&s&&(e.TgZ(0,"ng-option",15),e._uU(1),e.qZA()),2&s){const a=t.$implicit;e.Q6J("value",a.id),e.xp6(1),e.hij(" ",a.CUSName,"")}}function me(s,t){if(1&s&&(e.TgZ(0,"div",28)(1,"button",29),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&s){const a=e.oxw();e.xp6(1),e.Q6J("disabled",!a.docData_Form.valid),e.xp6(1),e.Oqu(e.lcZ(3,2,"BTN.SAVE"))}}class L{constructor(t,a,r,n,p,_,T,F,q,V,Y,Ae){this.activatedRoute=t,this.localStore=a,this._companyService=r,this.global=n,this.router=p,this.snackBar=_,this.docsService=T,this.tenantsService=F,this.contractService=q,this.translateService=V,this.fb=Y,this._formBuilder=Ae,this.curCOMId=u.N.comid,this.account=new P.n,this.userPerm=[],this.curDocValue=0,this.curDocPayedValue=0,this.AllNotPayedInstallments=[],this.AllTenants=[]}ngOnInit(){if(this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.getTenants(),this.sub=this.activatedRoute.params.subscribe(t=>{t.id?(this.id=+t.id,this.getDocById(this.id)):this.payDocForDisplay=new W}),this.docData_Form=this.fb.group({id:null,PDOCode:null,PDOValue:{value:null,disabled:this.id},PDODocDate:null,PDODocType:"R",PDODocClassType:"A",PDOPayType:"E",PDOPayDate:null,PDOPrintedCode:null,PDODocSecondPerson:null,PDONotes:null,contract_KeyField:null,branch_KeyField:null,owner_KeyField:null,build_KeyField:null,unit_KeyField:null,installment_KeyField:null,customer_KeyField:null,PDOEjarCode:null})}else this.router.navigate(["/sign-in"])}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getDocById(t){this.docsService.getOneDocs(t).subscribe(a=>{this.fillForm(a),this.payDocForDisplay=a})}fillForm(t){console.log("-----contract.PDODocType:: "+t.PDODocType),console.log("-----contract.PDOPayType:: "+t.PDOPayType),null!=t.PDODocDate&&(this.s_docDate=t.PDODocDate),this.docData_Form.patchValue({id:t.id,contract_KeyField:t.contract_KeyField,branch_KeyField:t.branch_KeyField,owner_KeyField:t.owner_KeyField,build_KeyField:t.build_KeyField,unit_KeyField:t.unit_KeyField,installment_KeyField:t.installment_KeyField,customer_KeyField:t.customer_KeyField,PDOCode:t.PDOCode,PDOValue:t.PDOValue,PDODocType:t.PDODocType,PDODocDate:t.PDODocDate,PDOPayType:t.PDOPayType,PDOPayDate:t.PDOPayDate,PDODocClassType:t.PDODocClassType,PDOPrintedCode:t.PDOPrintedCode,PDODocSecondPerson:t.PDODocSecondPerson,PDONotes:t.PDONotes,PDOEjarCode:t.PDOEjarCode})}readCustumer(t){console.log("====Selected readCustumer:: "+t),this.tenantsService.getOneCustomer(t).subscribe(a=>{console.log("==tenantName:: "+a.CUSName),console.log("==current_contract:: "+a.current_contract),this.docData_Form.patchValue({contract_KeyField:a.current_contract,PDODocSecondPerson:a.CUSName})}),this.getCustomerInstallmentsNotPayed(this.curCOMId,this.account.periorty,t)}getCustomerInstallmentsNotPayed(t,a,r){this.contractService.getInstallmentsPerCustomer_Payed(t,a,r,"F").subscribe(n=>{this.AllNotPayedInstallments=n,this.curOwnerId=n[0].owner_KeyField,this.curContract=n[0].contract_KeyField,this.curBranch=n[0].branch_KeyField,this.curBuild=n[0].build_KeyField,this.curUnit=n[0].unit_KeyField,this.curInstallment=n[0].id,this.curDocValue=n[0].INSValue,this.curDocPayedValue=n[0].INSPayedValue,null==this.curDocValue&&(this.curDocValue=0),null==this.curDocPayedValue&&(this.curDocPayedValue=0),this.docData_Form.patchValue({contract_KeyField:this.curContract,branch_KeyField:this.curBranch,build_KeyField:this.curBuild,unit_KeyField:this.curUnit,owner_KeyField:this.curOwnerId,installment_KeyField:this.curInstallment,PDOValue:this.curDocValue-this.curDocPayedValue})},n=>{this.snackBar.open("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u062a\u0631\u062c\u0627\u0639 \u0627\u0644\u0623\u0642\u0633\u0627\u0637","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}getTenants(){this.AllTenants=null,this.tenantsService.getCustomers(this.curCOMId,this.account.periorty).subscribe(t=>{this.AllTenants=t})}mappingFormValue_ToPayDocClass(){const t=new m.uU("en-GB").transform(this.docData_Form.value.PDODocDate,"dd/MM/yyyy"),a=new m.uU("en-GB").transform(this.docData_Form.value.PDOPayDate,"dd/MM/yyyy");this.payDocForDisplay.id=this.docData_Form.value.id,this.payDocForDisplay.contract_KeyField=this.docData_Form.value.contract_KeyField,this.payDocForDisplay.branch_KeyField=this.docData_Form.value.branch_KeyField,this.payDocForDisplay.owner_KeyField=this.docData_Form.value.owner_KeyField,this.payDocForDisplay.build_KeyField=this.docData_Form.value.build_KeyField,this.payDocForDisplay.unit_KeyField=this.docData_Form.value.unit_KeyField,this.payDocForDisplay.installment_KeyField=this.docData_Form.value.installment_KeyField,this.payDocForDisplay.customer_KeyField=this.docData_Form.value.customer_KeyField,null!=this.docData_Form.value.PDODocDate&&(this.payDocForDisplay.PDODocDate=t),this.payDocForDisplay.PDOPayType=this.docData_Form.value.PDOPayType,null!=this.docData_Form.value.PDOPayDate&&(this.payDocForDisplay.PDOPayDate=a),this.payDocForDisplay.PDOCode=this.docData_Form.value.PDOCode,this.payDocForDisplay.PDOValue=this.docData_Form.value.PDOValue,this.payDocForDisplay.PDODocType=this.docData_Form.value.PDODocType,this.payDocForDisplay.PDODocClassType=this.docData_Form.value.PDODocClassType,this.payDocForDisplay.PDOPrintedCode=this.docData_Form.value.PDOPrintedCode,this.payDocForDisplay.PDODocSecondPerson=this.docData_Form.value.PDODocSecondPerson,this.payDocForDisplay.PDONotes=this.docData_Form.value.PDONotes,this.payDocForDisplay.PDOEjarCode=this.docData_Form.value.PDOEjarCode}manageInstallmetPayedValue(t,a,r,n,p){null==r&&(r=0),null==n&&(n=0),null==a&&(a=0);let _=+r+ +n;console.log("===installmentPayedValue:: "+r),console.log("===docPayedValue:: "+n),console.log("===totalPayed:: "+_),this.insStatus=_<a?"T":"P";let T={id:t,INSStatus:this.insStatus,INSPayedValue:_,INSPayDate:p,INSPersonPayName:this.payDocForDisplay.PDODocSecondPerson};console.log("===installData:: "+T),this.contractService.editInstallments(T).subscribe(F=>{console.log("==installment after Update:: "+F)},F=>{console.log(F)})}saveEditDocData(t){const a=new m.uU("en-GB").transform(this.docData_Form.value.PDODocDate,"dd/MM/yyyy");this.mappingFormValue_ToPayDocClass(),t?this.docsService.editDoc(this.payDocForDisplay).subscribe(r=>{let n={contract_KeyField:r.contract_KeyField,branch_KeyField:r.branch_KeyField,owner_KeyField:r.owner_KeyField,build_KeyField:r.build_KeyField,unit_KeyField:r.unit_KeyField,installment_KeyField:r.installment_KeyField,customer_KeyField:r.customer_KeyField,TSTCreditValue:r.PDOValue,TSTDebitValue:0,TSTDate:r.PDODocDate,TSTDescription:"\u0642\u064a\u0645\u0629 \u0633\u0646\u062f \u0627\u0644\u0642\u0628\u0636 \u0631\u0642\u0645 "+r.PDOCode,TSTSubject:"RECEIVABLE",TSTSubjectID:r.ID};this.contractService.deleteStatementForSubjectID(this.curCOMId,this.account.periorty,"RECEIVABLE",r.id).subscribe(p=>{this.contractService.addStatement(n).subscribe(_=>{})}),this.snackBar.open("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.router.navigate(["payments/receivable-list"])},r=>{this.snackBar.open(" \u062e\u0637\u0623 \u0641\u064a \u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):this.docsService.addDoc(this.payDocForDisplay).subscribe(r=>{this.contractService.addStatement({contract_KeyField:r.contract_KeyField,branch_KeyField:r.branch_KeyField,owner_KeyField:r.owner_KeyField,build_KeyField:r.build_KeyField,unit_KeyField:r.unit_KeyField,installment_KeyField:r.installment_KeyField,customer_KeyField:r.customer_KeyField,TSTCreditValue:r.PDOValue,TSTDebitValue:0,TSTDate:r.PDODocDate,TSTDescription:"\u0642\u064a\u0645\u0629 \u0633\u0646\u062f \u0627\u0644\u0642\u0628\u0636 \u0631\u0642\u0645 "+r.PDOCode,TSTSubject:"RECEIVABLE",TSTSubjectID:r.id}).subscribe(p=>{console.log("addStatement Done")},p=>{console.log("addStatement Error:: "+p)}),this.manageInstallmetPayedValue(this.curInstallment,this.curDocValue,this.curDocPayedValue,this.payDocForDisplay.PDOValue,a),this.snackBar.open("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.router.navigate(["payments/receivable-list"])},r=>{this.snackBar.open(" \u062e\u0637\u0623 \u0641\u064a \u0627\u0636\u0627\u0641\u0647 \u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t})}}L.\u0275fac=function(t){return new(t||L)(e.Y36(y.gz),e.Y36(l.C),e.Y36($.J),e.Y36(D.U),e.Y36(y.F0),e.Y36(i.ux),e.Y36(v.c),e.Y36(X.v),e.Y36(h.W),e.Y36(o.sK),e.Y36(d.qu),e.Y36(d.qu))},L.\u0275cmp=e.Xpm({type:L,selectors:[["app-receivable-doc-dialog"]],decls:98,vars:65,consts:[[1,"p-2"],[4,"ngIf"],[1,"pt-3"],["autocomplete","off","fxLayout","row wrap",3,"formGroup","ngSubmit"],["fxFlex","100","fxFlex.gt-sm","40",1,"px-2"],["width","400","height","300","id","campanyLogo",3,"src"],["fxFlex","100","fxFlex.gt-sm","60",1,"px-2"],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-sm","25",1,"px-1"],["appearance","outline",1,"w-100"],["matInput","","formControlName","PDOCode"],["fxFlex","100","fxFlex.gt-sm","50",1,"px-1"],["appearance","outline","formControlName","customer_KeyField",1,"w-100",3,"placeholder","change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","PDOPayType","id","selfpaytypeOpSel",3,"placeholder"],[3,"value"],["matInput","","formControlName","PDODocDate","required","",3,"matDatepicker"],["matSuffix","",3,"for"],["pdoDocDate",""],["matInput","","formControlName","PDOValue","required",""],["matInput","","formControlName","PDOPrintedCode"],["matInput","","formControlName","PDOEjarCode"],["matInput","","formControlName","PDODocSecondPerson","required",""],["matInput","","formControlName","PDOPayDate",3,"matDatepicker"],["pdoPayDate",""],["fxFlex","100",1,"px-1"],["matInput","","formControlName","PDONotes","rows","3"],["fxFlex","100","class","mt-2 text-center w-100",4,"ngIf"],["fxFlex","100",1,"mt-2","text-center","w-100"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,a){if(1&t&&(e.TgZ(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"h1"),e.YNc(5,ue,3,3,"span",1),e.YNc(6,de,3,3,"span",1),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"mat-card-content",2)(10,"form",3),e.NdJ("ngSubmit",function(){return a.saveEditDocData(a.payDocForDisplay.id)}),e.TgZ(11,"div",4),e._UZ(12,"img",5),e.qZA(),e.TgZ(13,"div",6)(14,"div",7)(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),e._uU(18),e.ALo(19,"translate"),e.qZA(),e._UZ(20,"input",10),e.qZA()(),e.TgZ(21,"div",11)(22,"label"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"ng-select",12),e.NdJ("change",function(n){return a.readCustumer(n)}),e.ALo(26,"translate"),e.YNc(27,pe,2,2,"ng-option",13),e.qZA()(),e.TgZ(28,"div",8)(29,"mat-form-field",9)(30,"mat-label"),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"mat-select",14),e.ALo(34,"translate"),e.TgZ(35,"mat-option",15),e._uU(36,"-"),e.qZA(),e.TgZ(37,"mat-option",15),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.TgZ(40,"mat-option",15),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.TgZ(43,"mat-option",15),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"mat-option",15),e._uU(47),e.ALo(48,"translate"),e.qZA()()()(),e.TgZ(49,"div",8)(50,"mat-form-field",9)(51,"mat-label"),e._uU(52),e.ALo(53,"translate"),e.qZA(),e._UZ(54,"input",16)(55,"mat-datepicker-toggle",17)(56,"mat-datepicker",null,18),e.qZA()(),e.TgZ(58,"div",11)(59,"mat-form-field",9)(60,"mat-label"),e._uU(61),e.ALo(62,"translate"),e.qZA(),e._UZ(63,"input",19),e.qZA()(),e.TgZ(64,"div",8)(65,"mat-form-field",9)(66,"mat-label"),e._uU(67),e.ALo(68,"translate"),e.qZA(),e._UZ(69,"input",20),e.qZA()(),e.TgZ(70,"div",8)(71,"mat-form-field",9)(72,"mat-label"),e._uU(73),e.ALo(74,"translate"),e.qZA(),e._UZ(75,"input",21),e.qZA()(),e.TgZ(76,"div",11)(77,"mat-form-field",9)(78,"mat-label"),e._uU(79),e.ALo(80,"translate"),e.qZA(),e._UZ(81,"input",22),e.qZA()(),e.TgZ(82,"div",8)(83,"mat-form-field",9)(84,"mat-label"),e._uU(85),e.ALo(86,"translate"),e.qZA(),e._UZ(87,"input",23)(88,"mat-datepicker-toggle",17)(89,"mat-datepicker",null,24),e.qZA()(),e.TgZ(91,"div",25)(92,"mat-form-field",9)(93,"mat-label"),e._uU(94),e.ALo(95,"translate"),e.qZA(),e._UZ(96,"textarea",26),e.qZA()(),e.YNc(97,me,4,4,"div",27),e.qZA()()()()()()),2&t){const r=e.MAs(57),n=e.MAs(90);e.xp6(5),e.Q6J("ngIf",!a.payDocForDisplay.id),e.xp6(1),e.Q6J("ngIf",a.payDocForDisplay.id),e.xp6(1),e.hij(" ",e.lcZ(8,31,"HTML.ReceivableDoc"),""),e.xp6(3),e.Q6J("formGroup",a.docData_Form),e.xp6(2),e.Q6J("src","assets/images/paymentDocs/receivable.png",e.LSH),e.xp6(6),e.Oqu(e.lcZ(19,33,"HTML.CODE")),e.xp6(5),e.hij(" ",e.lcZ(24,35,"HTML.TENANT"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(26,37,"HTML.TENANT")),e.xp6(2),e.Q6J("ngForOf",a.AllTenants),e.xp6(4),e.Oqu(e.lcZ(32,39,"HTML.DocPayType")),e.xp6(2),e.s9C("placeholder",e.lcZ(34,41,"HTML.DocPayType")),e.xp6(4),e.Q6J("value","C"),e.xp6(1),e.Oqu(e.lcZ(39,43,"OPTIONS.Cash")),e.xp6(2),e.Q6J("value","B"),e.xp6(1),e.Oqu(e.lcZ(42,45,"OPTIONS.Bank")),e.xp6(2),e.Q6J("value","E"),e.xp6(1),e.Oqu(e.lcZ(45,47,"OPTIONS.Ejar")),e.xp6(2),e.Q6J("value","T"),e.xp6(1),e.Oqu(e.lcZ(48,49,"OPTIONS.Transfere")),e.xp6(5),e.Oqu(e.lcZ(53,51,"HTML.DocDate")),e.xp6(2),e.Q6J("matDatepicker",r),e.xp6(1),e.Q6J("for",r),e.xp6(6),e.Oqu(e.lcZ(62,53,"HTML.DocValue")),e.xp6(6),e.Oqu(e.lcZ(68,55,"HTML.DocPrintedNo")),e.xp6(6),e.Oqu(e.lcZ(74,57,"HTML.PayDocEjarCode")),e.xp6(6),e.Oqu(e.lcZ(80,59,"HTML.DocSecondPart_ReceivableDoc")),e.xp6(6),e.Oqu(e.lcZ(86,61,"HTML.DocPayDate")),e.xp6(2),e.Q6J("matDatepicker",n),e.xp6(1),e.Q6J("for",n),e.xp6(6),e.Oqu(e.lcZ(95,63,"HTML.Notes")),e.xp6(3),e.Q6J("ngIf",a.can("change_onereceivable"))}},dependencies:[d._Y,d.Fj,d.JJ,d.JL,d.Q7,m.sg,m.O5,d.sg,d.u,S.xw,S.yH,le.ey,N.lW,O.a8,O.dn,O.dk,O.n5,U.Mq,U.hl,U.nW,J.Nt,Z.KE,Z.hX,Z.R9,ce.gD,I.w9,I.jq,o.X$]});var he=c(529),De=c(589),ge=c(9045);function ye(s,t){if(1&s){const a=e.EpF();e.TgZ(0,"mat-button-toggle",21),e.NdJ("click",function(){e.CHM(a);const n=e.oxw();return e.KtG(n.gotoNewDocument())}),e.TgZ(1,"mat-icon"),e._uU(2,"note_add"),e.qZA()()}}const fe=function(s){return["/payments/payable-add/",s]};function _e(s,t){if(1&s&&(e.TgZ(0,"a",27),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"edit"),e.qZA()()),2&s){const a=e.oxw().$implicit;e.s9C("matTooltip",e.lcZ(1,2,"BTN.EDIT")),e.Q6J("routerLink",e.VKq(4,fe,a.id))}}function be(s,t){if(1&s){const a=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(a);const n=e.oxw().$implicit,p=e.oxw();return e.KtG(p.removeDocument(n.id))}),e.ALo(1,"translate"),e.TgZ(2,"mat-icon"),e._uU(3,"delete"),e.qZA()()}2&s&&e.s9C("matTooltip",e.lcZ(1,1,"BTN.REMOVE"))}function Te(s,t){if(1&s&&(e.TgZ(0,"div",22)(1,"div",23),e._uU(2),e.qZA(),e.TgZ(3,"div",23),e._uU(4),e.qZA(),e.TgZ(5,"div",23),e._uU(6),e.qZA(),e.TgZ(7,"div",23),e._uU(8),e.qZA(),e.TgZ(9,"div",23)(10,"div",24),e.YNc(11,_e,4,6,"a",25),e.YNc(12,be,4,3,"button",26),e.qZA()()()),2&s){const a=t.$implicit,r=e.oxw();e.xp6(2),e.hij(" ",a.customer_Name," "),e.xp6(2),e.hij(" ",a.PDODocDate," "),e.xp6(2),e.hij(" ",a.PDOValue," "),e.xp6(2),e.hij(" ",a.PDOPrintedCode," "),e.xp6(3),e.Q6J("ngIf",r.can("view_onepayable")),e.xp6(1),e.Q6J("ngIf",r.can("delete_onepayable"))}}function Pe(s,t){if(1&s){const a=e.EpF();e.TgZ(0,"div",29)(1,"div",30)(2,"mat-card",31)(3,"pagination-controls",32),e.NdJ("pageChange",function(n){e.CHM(a);const p=e.oxw();return e.KtG(p.onPageChanged(n))}),e.qZA()()()()}}function ve(s,t){1&s&&(e.TgZ(0,"div",33),e._UZ(1,"mat-spinner",34),e.qZA())}const Fe=function(s,t){return{itemsPerPage:s,currentPage:t}};class M{constructor(t,a,r,n,p,_,T,F){this.appSettings=t,this.dialog=a,this.paymentService=r,this.router=n,this.global=p,this.localStore=_,this.translateService=T,this.snackBar=F,this.curCOMId=u.N.comid,this.account=new P.n,this.count=4,this.userPerm=[],this.settings=this.appSettings.settings}ngOnInit(){if(this.securityForApp=(new b.$).getSecurityType(),this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.prepareMsgLanguage(),this.getDocuments()}else this.router.navigate(["/sign-in"])}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getDocuments(){this.documentsAll=null,this.curUserData.is_superuser?this.paymentService.getAllPayableDocuments(this.curCOMId,this.account.periorty).subscribe(t=>this.documentsAll=t):1==this.curUserData.periorty&&("N"==this.securityForApp&&this.paymentService.getAllPayableDocumentsPerBranch(this.curCOMId,this.account.periorty,this.curUserData.branch_KeyField).subscribe(t=>this.documentsAll=t),"D"==this.securityForApp&&this.paymentService.getAllPayableDocumentsPerEmp(this.curCOMId,this.account.periorty,this.curUserData.id).subscribe(t=>this.documentsAll=t))}removeDocument(t){this.dialog.open(x.$,{maxWidth:"400px",data:{title:this.deletedTitleMsg,message:this.askToDeletedMsg}}).afterClosed().subscribe(r=>{r&&this.paymentService.deleteDocument(t).subscribe(n=>this.getDocuments())})}onPageChanged(t){this.page=t,this.getDocuments(),window.scrollTo(0,0)}gotoNewDocument(){this.router.navigate(["/payments/payable-add/"])}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t}),this.translateService.get("MESSAGE.ConfirmAction").subscribe(t=>{this.deletedTitleMsg=t})}}function xe(s,t){1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.ADD")))}function Se(s,t){1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BTN.EDIT")))}function Oe(s,t){if(1&s&&(e.TgZ(0,"ng-option",25),e._uU(1),e.qZA()),2&s){const a=t.$implicit;e.Q6J("value",a.id),e.xp6(1),e.hij(" ",a.CUSName,"")}}function Ze(s,t){if(1&s&&(e.TgZ(0,"div",26)(1,"button",27),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&s){const a=e.oxw();e.xp6(1),e.Q6J("disabled",!a.docData_Form.valid),e.xp6(1),e.Oqu(e.lcZ(3,2,"BTN.SAVE"))}}M.\u0275fac=function(t){return new(t||M)(e.Y36(f.d),e.Y36(g.uw),e.Y36(v.c),e.Y36(y.F0),e.Y36(D.U),e.Y36(l.C),e.Y36(o.sK),e.Y36(i.ux))},M.\u0275cmp=e.Xpm({type:M,selectors:[["app-payable-doc-list"]],features:[e._Bn([v.c])],decls:52,vars:34,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"p-2"],["fxLayout","row"],["appearance","legacy"],["controls","matButtonToggleGroup"],["value","add",3,"click",4,"ngIf"],["value","search"],[1,"user-search"],[1,"user-search-input"],["matInput","","name","search","autocomplete","off",3,"placeholder","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-between center"],["appearance","legacy","value","list"],["viewType","matButtonToggleGroup"],["value","list"],["value","grid"],["fxLayout","row wrap","fxLayoutAlign","space-between center",1,"w-100","p-3"],[1,"mat-mdc-table","admin-table"],[1,"mat-mdc-header-row"],[1,"mat-mdc-header-cell"],["class","mat-mdc-row",4,"ngFor","ngForOf"],["fxLayout","row wrap",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","user-spinner",4,"ngIf"],["value","add",3,"click"],[1,"mat-mdc-row"],[1,"mat-mdc-cell"],[1,"p-2","actions"],["mat-mini-fab","","color","primary",3,"routerLink","matTooltip",4,"ngIf"],["mat-mini-fab","","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"routerLink","matTooltip"],["mat-mini-fab","","color","warn",3,"matTooltip","click"],["fxLayout","row wrap"],["fxFlex","100",1,"p-2"],[1,"text-center"],["autoHide","true","maxSize","5",1,"product-pagination",3,"pageChange"],["fxLayout","column","fxLayoutAlign","center center",1,"user-spinner"],["color","primary"]],template:function(t,a){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-button-toggle-group",2,3),e.YNc(4,ye,3,0,"mat-button-toggle",4),e.TgZ(5,"mat-button-toggle",5)(6,"mat-icon"),e._uU(7,"search"),e.qZA()()()(),e.TgZ(8,"form",6)(9,"mat-form-field",7)(10,"input",8),e.NdJ("ngModelChange",function(n){return a.searchText=n}),e.ALo(11,"translate"),e.qZA()()(),e.TgZ(12,"div",9)(13,"mat-button-toggle-group",10,11)(15,"mat-button-toggle",12)(16,"mat-icon"),e._uU(17,"view_list"),e.qZA()(),e.TgZ(18,"mat-button-toggle",13)(19,"mat-icon"),e._uU(20,"view_module"),e.qZA()()()()(),e._UZ(21,"mat-divider"),e.TgZ(22,"mat-card")(23,"div",14)(24,"h2"),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e._UZ(27,"mat-divider"),e.TgZ(28,"div",15)(29,"div",16)(30,"div",17)(31,"h2"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div",17)(35,"h2"),e._uU(36),e.ALo(37,"translate"),e.qZA()(),e.TgZ(38,"div",17)(39,"h2"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"div",17)(43,"h2"),e._uU(44),e.ALo(45,"translate"),e.qZA()(),e._UZ(46,"div",17),e.qZA(),e.YNc(47,Te,13,6,"div",18),e.ALo(48,"paginate"),e.ALo(49,"PayDocumentsSearchPipe"),e.qZA()(),e.YNc(50,Pe,4,0,"div",19),e.YNc(51,ve,2,0,"div",20)),2&t){const r=e.MAs(3);e.xp6(4),e.Q6J("ngIf",a.can("add_onepayable")),e.xp6(4),e.ekj("show","search"==r.value),e.xp6(2),e.s9C("placeholder",e.lcZ(11,13,"HTML.SEARCH_PayDocument")),e.Q6J("ngModel",a.searchText),e.xp6(15),e.Oqu(e.lcZ(26,15,"HTML.PayableDoc_List")),e.xp6(7),e.hij(" ",e.lcZ(33,17,"HTML.TENANT")," "),e.xp6(4),e.hij(" ",e.lcZ(37,19,"HTML.DocDate")," "),e.xp6(4),e.hij(" ",e.lcZ(41,21,"HTML.DocValue")," "),e.xp6(4),e.hij(" ",e.lcZ(45,23,"HTML.DocPrintedNo")," "),e.xp6(3),e.Q6J("ngForOf",e.xi3(48,25,e.xi3(49,28,a.documentsAll,a.searchText),e.WLB(31,Fe,a.count,a.page))),e.xp6(3),e.Q6J("ngIf",a.documentsAll),e.xp6(1),e.Q6J("ngIf",!a.documentsAll)}},dependencies:[d._Y,d.Fj,d.JJ,d.JL,d.On,d.F,C.LS,m.sg,m.O5,y.rH,S.xw,S.Wh,S.yH,N.Tq,N.nh,R.A9,R.Yi,O.a8,j.Hw,J.Nt,Z.KE,H.d,k.Ou,Q.gM,C._s,G.dg,o.X$],styles:[".user-name{padding:0 12px;font-weight:400}.user-content{padding:10px}.user-content .user-img{position:relative}.user-content .user-img img{border-radius:50%;width:80px;height:80px}.user-content .user-img img.blocked{opacity:.5}.user-content .user-img .mat-icon{position:absolute;top:-8px;left:-8px;font-size:96px;height:96px;width:96px}.user-content .mat-mdc-slide-toggle{margin-top:15px}.user-content .user-details span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-content .user-details .mat-icon{padding:2px 10px}.user-content .user-details.blocked{opacity:.5}.user-search{width:0;overflow:hidden;transition:.3s}.user-search .mat-mdc-form-field{width:100%!important;text-align:center!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-infix{min-height:36px;padding:8px 0!important}.user-search .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.user-search .mat-mdc-input-element{text-align:center}.user-search.show{width:100%;overflow:visible}.user-spinner{position:absolute;inset:0}.mat-mdc-card{overflow:hidden}\n"],encapsulation:2});class w{constructor(t,a,r,n,p,_,T,F,q,V,Y){this.activatedRoute=t,this.localStore=a,this._companyService=r,this.global=n,this.router=p,this.snackBar=_,this.docsService=T,this.tenantsService=F,this.contractService=q,this.translateService=V,this.fb=Y,this.curCOMId=u.N.comid,this.account=new P.n,this.userPerm=[],this.AllTenants=[]}ngOnInit(){if(this.userSUb=this.global.user.subscribe(t=>{this.account=t}),this.localStore.getItem("token")&&this.localStore.getItem("account")){this.curUserData=JSON.parse(this.localStore.getItem("account")),this.curUserPermissions=JSON.parse(this.localStore.getItem("permissions"));for(let t=0;t<this.curUserPermissions.length;t++)this.userPerm[t]=this.curUserPermissions[t].codename;this.getTenants(),this.sub=this.activatedRoute.params.subscribe(t=>{t.id?(this.id=+t.id,this.getDocById(this.id)):this.payDocForDisplay=new W}),this.docData_Form=this.fb.group({id:null,PDOCode:null,PDOValue:{value:null,disabled:this.id},PDODocDate:null,PDODocType:"P",PDODocClassType:"H",PDOPrintedCode:null,PDODocSecondPerson:null,PDONotes:null,contract_KeyField:null,branch_KeyField:null,owner_KeyField:null,build_KeyField:null,unit_KeyField:null,installment_KeyField:null,customer_KeyField:null})}else this.router.navigate(["/sign-in"])}can(t){return!(!this.curUserData.is_superuser&&!this.userPerm.includes(t))}getDocById(t){this.docsService.getOneDocs(t).subscribe(a=>{this.fillForm(a),this.payDocForDisplay=a})}fillForm(t){null!=t.PDODocDate&&(this.s_docDate=t.PDODocDate),this.docData_Form.patchValue({id:t.id,contract_KeyField:t.contract_KeyField,branch_KeyField:t.branch_KeyField,owner_KeyField:t.owner_KeyField,build_KeyField:t.build_KeyField,unit_KeyField:t.unit_KeyField,installment_KeyField:t.installment_KeyField,customer_KeyField:t.customer_KeyField,PDOCode:t.PDOCode,PDOValue:t.PDOValue,PDODocType:t.PDODocType,PDODocDate:t.PDODocDate,PDODocClassType:t.PDODocClassType,PDOPrintedCode:t.PDOPrintedCode,PDODocSecondPerson:t.PDODocSecondPerson,PDONotes:t.PDONotes})}readCustumer(t){this.tenantsService.getOneCustomer(t).subscribe(a=>{this.docData_Form.patchValue({PDODocSecondPerson:a.CUSName,contract_KeyField:a.current_contract,branch_KeyField:a.current_branch,build_KeyField:a.current_building,unit_KeyField:a.current_unit,owner_KeyField:a.current_owner})})}getTenants(){this.AllTenants=null,this.tenantsService.getCustomers(this.curCOMId,this.account.periorty).subscribe(t=>this.AllTenants=t)}mappingFormValue_ToPayDocClass(){const t=new m.uU("en-GB").transform(this.docData_Form.value.PDODocDate,"dd/MM/yyyy");this.payDocForDisplay.id=this.docData_Form.value.id,this.payDocForDisplay.contract_KeyField=this.docData_Form.value.contract_KeyField,this.payDocForDisplay.branch_KeyField=this.docData_Form.value.branch_KeyField,this.payDocForDisplay.owner_KeyField=this.docData_Form.value.owner_KeyField,this.payDocForDisplay.build_KeyField=this.docData_Form.value.build_KeyField,this.payDocForDisplay.unit_KeyField=this.docData_Form.value.unit_KeyField,this.payDocForDisplay.installment_KeyField=this.docData_Form.value.installment_KeyField,this.payDocForDisplay.customer_KeyField=this.docData_Form.value.customer_KeyField,null!=this.docData_Form.value.PDODocDate&&(this.payDocForDisplay.PDODocDate=t),this.payDocForDisplay.PDOCode=this.docData_Form.value.PDOCode,this.payDocForDisplay.PDOValue=this.docData_Form.value.PDOValue,this.payDocForDisplay.PDODocType=this.docData_Form.value.PDODocType,this.payDocForDisplay.PDODocClassType=this.docData_Form.value.PDODocClassType,this.payDocForDisplay.PDOPrintedCode=this.docData_Form.value.PDOPrintedCode,this.payDocForDisplay.PDODocSecondPerson=this.docData_Form.value.PDODocSecondPerson,this.payDocForDisplay.PDONotes=this.docData_Form.value.PDONotes}saveEditDocData(t){this.mappingFormValue_ToPayDocClass(),t?this.docsService.editDoc(this.payDocForDisplay).subscribe(a=>{let r={contract_KeyField:a.contract_KeyField,branch_KeyField:a.branch_KeyField,owner_KeyField:a.owner_KeyField,build_KeyField:a.build_KeyField,unit_KeyField:a.unit_KeyField,installment_KeyField:null,customer_KeyField:a.customer_KeyField,TSTCreditValue:0,TSTDebitValue:a.PDOValue,TSTDate:a.PDODocDate,TSTDescription:"\u0642\u064a\u0645\u0629 \u0633\u0646\u062f \u0627\u0644\u0635\u0631\u0641 \u0631\u0642\u0645 "+a.PDOCode,TSTSubject:"PAYABLE",TSTSubjectID:a.ID};this.contractService.deleteStatementForSubjectID(this.curCOMId,this.account.periorty,"PAYABLE",a.id).subscribe(n=>{this.contractService.addStatement(r).subscribe(p=>{})}),this.snackBar.open("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.router.navigate(["payments/payable-list"])},a=>{this.snackBar.open(" \u062e\u0637\u0623 \u0641\u064a \u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})}):this.docsService.addDoc(this.payDocForDisplay).subscribe(a=>{this.contractService.addStatement({contract_KeyField:a.contract_KeyField,branch_KeyField:a.branch_KeyField,owner_KeyField:a.owner_KeyField,build_KeyField:a.build_KeyField,unit_KeyField:a.unit_KeyField,installment_KeyField:null,customer_KeyField:a.customer_KeyField,TSTCreditValue:0,TSTDebitValue:a.PDOValue,TSTDate:a.PDODocDate,TSTDescription:"\u0642\u064a\u0645\u0629 \u0633\u0646\u062f \u0627\u0644\u0635\u0631\u0641 \u0631\u0642\u0645 "+a.PDOCode,TSTSubject:"PAYABLE",TSTSubjectID:a.ID}).subscribe(n=>{}),this.snackBar.open("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"success",verticalPosition:"top",duration:3e3}),this.router.navigate(["payments/payable-list"])},a=>{this.snackBar.open(" \u062e\u0637\u0623 \u0641\u064a \u0627\u0636\u0627\u0641\u0647 \u0645\u0633\u062a\u0646\u062f","\xd7",{panelClass:"error",verticalPosition:"top",duration:3e3})})}prepareMsgLanguage(){this.translateService.get("MESSAGE.RETRIEVE_ERROR").subscribe(t=>{this.errorRetrieveMsg=t}),this.translateService.get("MESSAGE.SURE_DELETE").subscribe(t=>{this.askToDeletedMsg=t}),this.translateService.get("MESSAGE.DELETED").subscribe(t=>{this.deletedMsg=t})}}w.\u0275fac=function(t){return new(t||w)(e.Y36(y.gz),e.Y36(l.C),e.Y36($.J),e.Y36(D.U),e.Y36(y.F0),e.Y36(i.ux),e.Y36(v.c),e.Y36(X.v),e.Y36(h.W),e.Y36(o.sK),e.Y36(d.qu))},w.\u0275cmp=e.Xpm({type:w,selectors:[["app-payable-doc-dialog"]],decls:62,vars:35,consts:[[1,"p-2"],[4,"ngIf"],[1,"pt-3"],["autocomplete","off","fxLayout","row wrap",3,"formGroup","ngSubmit"],["fxFlex","100","fxFlex.gt-sm","40",1,"px-2"],["width","400","height","300","id","campanyLogo",3,"src"],["fxFlex","100","fxFlex.gt-sm","60",1,"px-2"],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-sm","25",1,"px-1"],["appearance","outline",1,"w-100"],["matInput","","formControlName","PDOCode"],["fxFlex","100","fxFlex.gt-sm","75",1,"px-1"],["appearance","outline","formControlName","customer_KeyField",1,"w-100",3,"placeholder","change"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","PDODocDate","required","",3,"matDatepicker"],["matSuffix","",3,"for"],["pdoDocDate",""],["fxFlex","100","fxFlex.gt-sm","50",1,"px-1"],["matInput","","formControlName","PDOValue","required",""],["matInput","","formControlName","PDOPrintedCode"],["fxFlex","100","fxFlex.gt-sm","100",1,"px-1"],["matInput","","formControlName","PDODocSecondPerson","required",""],["fxFlex","100",1,"px-1"],["matInput","","formControlName","PDONotes","rows","3"],["fxFlex","100","class","mt-2 text-center w-100",4,"ngIf"],[3,"value"],["fxFlex","100",1,"mt-2","text-center","w-100"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,a){if(1&t&&(e.TgZ(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"h1"),e.YNc(5,xe,3,3,"span",1),e.YNc(6,Se,3,3,"span",1),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"mat-card-content",2)(10,"form",3),e.NdJ("ngSubmit",function(){return a.saveEditDocData(a.payDocForDisplay.id)}),e.TgZ(11,"div",4),e._UZ(12,"img",5),e.qZA(),e.TgZ(13,"div",6)(14,"div",7)(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),e._uU(18),e.ALo(19,"translate"),e.qZA(),e._UZ(20,"input",10),e.qZA()(),e.TgZ(21,"div",11)(22,"label"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"ng-select",12),e.NdJ("change",function(n){return a.readCustumer(n)}),e.ALo(26,"translate"),e.YNc(27,Oe,2,2,"ng-option",13),e.qZA()(),e.TgZ(28,"div",8)(29,"mat-form-field",9)(30,"mat-label"),e._uU(31),e.ALo(32,"translate"),e.qZA(),e._UZ(33,"input",14)(34,"mat-datepicker-toggle",15)(35,"mat-datepicker",null,16),e.qZA()(),e.TgZ(37,"div",17)(38,"mat-form-field",9)(39,"mat-label"),e._uU(40),e.ALo(41,"translate"),e.qZA(),e._UZ(42,"input",18),e.qZA()(),e.TgZ(43,"div",8)(44,"mat-form-field",9)(45,"mat-label"),e._uU(46),e.ALo(47,"translate"),e.qZA(),e._UZ(48,"input",19),e.qZA()(),e.TgZ(49,"div",20)(50,"mat-form-field",9)(51,"mat-label"),e._uU(52),e.ALo(53,"translate"),e.qZA(),e._UZ(54,"input",21),e.qZA()(),e.TgZ(55,"div",22)(56,"mat-form-field",9)(57,"mat-label"),e._uU(58),e.ALo(59,"translate"),e.qZA(),e._UZ(60,"textarea",23),e.qZA()(),e.YNc(61,Ze,4,4,"div",24),e.qZA()()()()()()),2&t){const r=e.MAs(36);e.xp6(5),e.Q6J("ngIf",!a.payDocForDisplay.id),e.xp6(1),e.Q6J("ngIf",a.payDocForDisplay.id),e.xp6(1),e.hij(" ",e.lcZ(8,17,"HTML.PayableDoc"),""),e.xp6(3),e.Q6J("formGroup",a.docData_Form),e.xp6(2),e.Q6J("src","assets/images/paymentDocs/payable.png",e.LSH),e.xp6(6),e.Oqu(e.lcZ(19,19,"HTML.CODE")),e.xp6(5),e.hij(" ",e.lcZ(24,21,"HTML.TENANT"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(26,23,"HTML.TENANT")),e.xp6(2),e.Q6J("ngForOf",a.AllTenants),e.xp6(4),e.Oqu(e.lcZ(32,25,"HTML.DocDate")),e.xp6(2),e.Q6J("matDatepicker",r),e.xp6(1),e.Q6J("for",r),e.xp6(6),e.Oqu(e.lcZ(41,27,"HTML.DocValue")),e.xp6(6),e.Oqu(e.lcZ(47,29,"HTML.DocPrintedNo")),e.xp6(6),e.Oqu(e.lcZ(53,31,"HTML.DocSecondPart_PayableDoc")),e.xp6(6),e.Oqu(e.lcZ(59,33,"HTML.Notes")),e.xp6(3),e.Q6J("ngIf",a.can("change_onepayable"))}},dependencies:[d._Y,d.Fj,d.JJ,d.JL,d.Q7,m.sg,m.O5,d.sg,d.u,S.xw,S.yH,N.lW,O.a8,O.dn,O.dk,O.n5,U.Mq,U.hl,U.nW,J.Nt,Z.KE,Z.hX,Z.R9,I.w9,I.jq,o.X$]});const z=[{path:"",redirectTo:"receivable-list",pathMatch:"full"},{path:"receivable-list",component:K,data:{breadcrumb:"ReceiptVouchers"}},{path:"receivable-add/:id",component:L,data:{breadcrumb:"EditReceiptVoucher"}},{path:"receivable-add",component:L,data:{breadcrumb:"AddReceiptVoucher"}},{path:"payable-list",component:M,data:{breadcrumb:"PaymentVouchers"}},{path:"payable-add/:id",component:w,data:{breadcrumb:"EditPaymentVoucher"}},{path:"payable-add",component:w,data:{breadcrumb:"AddPaymentVoucher"}}];class E{}E.\u0275fac=function(t){return new(t||E)},E.\u0275mod=e.oAB({type:E}),E.\u0275inj=e.cJS({imports:[he.JF,d.u5,C.JX,ge.D,m.ez,y.Bz.forChild(z),d.UX,De.m,C.JX,I.A0]})},2887:(B,A,c)=>{c.d(A,{$:()=>b});var m=c(5412),u=c(4650),P=c(1576),v=c(4859),x=c(3081);class b{constructor(f,g){this.dialogRef=f,this.data=g}ngOnInit(){}onConfirm(){this.dialogRef.close(!0)}onDismiss(){this.dialogRef.close(!1)}}b.\u0275fac=function(f){return new(f||b)(u.Y36(m.so),u.Y36(m.WI))},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-confirm-dialog"]],decls:13,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["fxLayout","row","fxLayoutAlign","space-between center",1,"w-100"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(f,g){1&f&&(u.TgZ(0,"h1",0),u._uU(1),u.qZA(),u.TgZ(2,"div",1)(3,"p"),u._uU(4),u.qZA()(),u.TgZ(5,"div",2)(6,"div",3)(7,"button",4),u.NdJ("click",function(){return g.onDismiss()}),u._uU(8),u.ALo(9,"translate"),u.qZA(),u.TgZ(10,"button",5),u.NdJ("click",function(){return g.onConfirm()}),u._uU(11),u.ALo(12,"translate"),u.qZA()()()),2&f&&(u.xp6(1),u.Oqu(null==g.data?null:g.data.title),u.xp6(3),u.Oqu(null==g.data?null:g.data.message),u.xp6(4),u.Oqu(u.lcZ(9,4,"BTN.NO")),u.xp6(3),u.Oqu(u.lcZ(12,6,"BTN.YES")))},dependencies:[P.xw,P.Wh,v.lW,m.uh,m.xY,m.H8,x.X$]})},1419:(B,A,c)=>{c.d(A,{DA:()=>g,G2:()=>x,JQ:()=>f,dg:()=>e,go:()=>u,mo:()=>P,pL:()=>b});var m=c(4650);class u{transform(l,h){let o=new RegExp(h,"ig");if(l)return l.filter(i=>i.profile.name?-1!==i.profile.name.search(o):-1!==i.username.search(o))}}u.\u0275fac=function(l){return new(l||u)},u.\u0275pipe=m.Yjl({name:"UserSearchPipe",type:u,pure:!1});class P{transform(l,h){let o=new RegExp(h,"ig");if(l)return l.filter(i=>i.first_name?-1!==i.first_name.search(o):i.last_name?-1!==i.last_name.search(o):-1!==i.username.search(o))}}P.\u0275fac=function(l){return new(l||P)},P.\u0275pipe=m.Yjl({name:"EmpSearchPipe",type:P,pure:!1});class v{transform(l,h){let o=new RegExp(h,"ig");if(l)return l.filter(i=>i.ownFirstName?-1!==i.ownFirstName.search(o):-1!==i.ownLastName.search(o))}}v.\u0275fac=function(l){return new(l||v)},v.\u0275pipe=m.Yjl({name:"OwnerSearchPipe",type:v,pure:!1});class x{transform(l,h){if(!l)return null;if(!h)return l;let o=new RegExp(h,"ig");return l?l.filter(i=>i.branch_ArbName&&-1!==i.branch_ArbName.search(o)?-1!==i.branch_ArbName.search(o):i.BUIName&&-1!==i.BUIName.search(o)?-1!==i.BUIName.search(o):i.owner_FullName&&-1!==i.owner_FullName.search(o)?-1!==i.owner_FullName.search(o):i.BUIPropertyTypeDisplay&&-1!==i.BUIPropertyTypeDisplay.search(o)?-1!==i.BUIPropertyTypeDisplay.search(o):i.BUIPropertyUsageTypeDisplay?-1!==i.BUIPropertyUsageTypeDisplay.search(o)?-1!==i.BUIPropertyUsageTypeDisplay.search(o):-1!==i.BUIName.search(o):-1!=i.BUIName.search(o)):void 0}}x.\u0275fac=function(l){return new(l||x)},x.\u0275pipe=m.Yjl({name:"BuildingSearchPipe",type:x,pure:!1});class b{transform(l,h){if(!l)return null;if(!h)return l;let o=new RegExp(h,"ig");return l?l.filter(i=>i.branch_ArbName&&-1!==i.branch_ArbName.search(o)?-1!==i.branch_ArbName.search(o):i.owner_FullName&&-1!==i.owner_FullName.search(o)?-1!==i.owner_FullName.search(o):i.build_Name&&-1!==i.build_Name.search(o)?-1!==i.build_Name.search(o):i.UNTUnitNumber&&-1!==i.UNTUnitNumber.search(o)?-1!==i.UNTUnitNumber.search(o):i.UNTHousingStatusDisplay&&-1!==i.UNTHousingStatusDisplay.search(o)?-1!==i.UNTHousingStatusDisplay.search(o):i.UNTUnitFileNumber&&-1!==i.UNTUnitFileNumber.search(o)?-1!==i.UNTUnitFileNumber.search(o):i.UNTUnitTypeDisplay&&-1!==i.UNTUnitTypeDisplay.search(o)?-1!==i.UNTUnitTypeDisplay.search(o):i.UNTFloorNumber?-1!==i.UNTFloorNumber.toString().search(o)?-1!==i.UNTFloorNumber.toString().search(o):-1!==i.UNTUnitNumber.search(o):-1!=i.UNTUnitNumber.search(o)):void 0}}b.\u0275fac=function(l){return new(l||b)},b.\u0275pipe=m.Yjl({name:"UnitsSearchPipe",type:b,pure:!1});class e{transform(l,h){if(!l)return null;if(!h)return l;let o=new RegExp(h,"ig");return l?l.filter(i=>i.branch_ArbName&&-1!==i.branch_ArbName.search(o)?-1!==i.branch_ArbName.search(o):i.unit_UnitNumber&&-1!==i.unit_UnitNumber.search(o)?-1!==i.unit_UnitNumber.search(o):i.build_Name&&-1!==i.build_Name.search(o)?-1!==i.build_Name.search(o):i.customer_Name&&-1!==i.customer_Name.search(o)?-1!==i.customer_Name.search(o):i.PDOPrintedCode&&-1!==i.PDOPrintedCode.search(o)?-1!==i.PDOPrintedCode.search(o):i.PDOEjarCode&&-1!==i.PDOEjarCode.search(o)?-1!==i.PDOEjarCode.search(o):i.PDOCode&&-1!==i.PDOCode.toString().search(o)?-1!==i.PDOCode.toString().search(o):i.contract_Code&&-1!==i.contract_Code.toString().search(o)?-1!==i.contract_Code.toString().search(o):i.contract_EjarCode?-1!==i.contract_EjarCode.toString().search(o)?-1!==i.contract_EjarCode.toString().search(o):-1!==i.build_Name.search(o):-1!=i.unit_UnitNumber.search(o)):void 0}}e.\u0275fac=function(l){return new(l||e)},e.\u0275pipe=m.Yjl({name:"PayDocumentsSearchPipe",type:e,pure:!1});class f{transform(l,h){if(!l)return null;if(!h)return l;let o=new RegExp(h,"ig");return l?l.filter(i=>i.build_Name&&-1!==i.build_Name.search(o)?-1!==i.build_Name.search(o):i.unit_UnitNumber&&-1!==i.unit_UnitNumber.search(o)?-1!==i.unit_UnitNumber.search(o):i.customer_Name&&-1!==i.customer_Name.search(o)?-1!==i.customer_Name.search(o):i.customer_Mobile&&-1!==i.customer_Mobile.search(o)?-1!==i.customer_Mobile.search(o):i.RCOCode&&-1!==i.RCOCode.toString().search(o)?-1!==i.RCOCode.toString().search(o):i.RCOEjarCode?-1!==i.RCOEjarCode.toString().search(o)?-1!==i.RCOEjarCode.toString().search(o):-1!==i.build_Name.search(o):-1!=i.unit_UnitNumber.search(o)):void 0}}f.\u0275fac=function(l){return new(l||f)},f.\u0275pipe=m.Yjl({name:"ContractSearchPipe",type:f,pure:!1});class g{transform(l,h){if(!l)return null;if(!h)return l;let o=new RegExp(h,"ig");return l?l.filter(i=>i.CUSName&&-1!==i.CUSName.search(o)?-1!==i.CUSName.search(o):i.CUSMobile&&-1!==i.CUSMobile.search(o)?-1!==i.CUSMobile.search(o):i.unit_Name&&-1!==i.unit_Name.search(o)?-1!==i.unit_Name.search(o):i.build_Name&&-1!==i.build_Name.search(o)?-1!==i.build_Name.search(o):i.job_Name&&-1!==i.job_Name.search(o)?-1!==i.job_Name.search(o):i.workplace_Name?-1!==i.workplace_Name.search(o)?-1!==i.workplace_Name.search(o):-1!==i.CUSName.search(o):-1!=i.CUSName.search(o)):void 0}}g.\u0275fac=function(l){return new(l||g)},g.\u0275pipe=m.Yjl({name:"TenantSearchPipe",type:g,pure:!1});class y{transform(l,h){let o=new RegExp(h,"ig");if(l)return l.filter(i=>i.CUSMobile?-1!==i.CUSMobile.search(o):-1!==i.CUSName.search(o))}}y.\u0275fac=function(l){return new(l||y)},y.\u0275pipe=m.Yjl({name:"TenantMobileSearchPipe",type:y,pure:!1})}}]);